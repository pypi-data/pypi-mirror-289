import{u as U}from"./D0znOYnB.js";import{a9 as fe,ac as ge,j as C,at as u,aQ as he,av as Se,ae as ve,z as a,a6 as V,O as T,R as j,d as Y,M as q,N as be,v as D,A as s,i as h,t as l,$ as ye,B as m,y,aR as De,V as z,S as Pe,az as X,W as P,x as Ve,Q as we,U as Te,T as ke,a0 as Ce}from"./83qOXOD1.js";import{O as Ae,c as _e,u as $e,V as x,b as Q,a as Be,e as Ee}from"./DgDQCLwe.js";import{S as Ie}from"./B7E3ychy.js";import{D as Le}from"./C30XVjLE.js";import{m as Oe,a as Ne,b as Re,c as Me,d as Fe,e as Ge,f as He,u as Ue,p as je,g as Ye,h as qe,i as ze,j as Xe,k as xe,l as Qe,n as R,o as M,q as F,r as G,D as We}from"./CwunnvY6.js";import{_ as W}from"./DlAUqK2U.js";import{S as Je}from"./CysyhsIQ.js";import{V as Ke}from"./1Cc5Z9dU.js";import{V as H}from"./yj3CsVEC.js";import"./C3z5vVQS.js";import"./CbzyahRt.js";const Ze=fe({itemsLength:{type:[Number,String],required:!0},...Oe(),...Ne(),...Re()},"VDataTableServer"),et=ge()({name:"VDataTableServer",props:Ze(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,n){let{attrs:p,slots:t}=n;const{groupBy:f}=Me(e),{sortBy:d,multiSort:g,mustSort:S}=Fe(e),{page:c,itemsPerPage:o}=Ge(e),r=C(()=>parseInt(e.itemsLength,10)),{columns:v,headers:A}=He(e,{groupBy:f,showSelect:u(e,"showSelect"),showExpand:u(e,"showExpand")}),{items:w}=Ue(e,v),{toggleSort:_}=je({sortBy:d,multiSort:g,mustSort:S,page:c}),{opened:J,isGroupOpen:K,toggleGroup:Z,extractRows:ee}=Ye({groupBy:f,sortBy:d}),{pageCount:te,setItemsPerPage:ae}=qe({page:c,itemsPerPage:o,itemsLength:r}),{flatItems:$}=ze(w,f,J),{isSelected:oe,select:se,selectAll:ne,toggleSelect:re,someSelected:ie,allSelected:le}=Xe(e,{allItems:w,currentPage:w}),{isExpanded:ce,toggleExpand:de}=xe(e),B=C(()=>ee(w.value));Qe({page:c,itemsPerPage:o,sortBy:d,groupBy:f,search:u(e,"search")}),he("v-data-table",{toggleSort:_,sortBy:d}),Se({VDataTableRows:{hideNoData:u(e,"hideNoData"),noDataText:u(e,"noDataText"),loading:u(e,"loading"),loadingText:u(e,"loadingText")}});const i=C(()=>({page:c.value,itemsPerPage:o.value,sortBy:d.value,pageCount:te.value,toggleSort:_,setItemsPerPage:ae,someSelected:ie.value,allSelected:le.value,isSelected:oe,select:se,selectAll:ne,toggleSelect:re,isExpanded:ce,toggleExpand:de,isGroupOpen:K,toggleGroup:Z,items:B.value.map(k=>k.raw),internalItems:B.value,groupedItems:$.value,columns:v.value,headers:A.value}));ve(()=>{const k=R.filterProps(e),ue=M.filterProps(e),me=F.filterProps(e),pe=G.filterProps(e);return a(G,T({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},pe),{top:()=>{var b;return(b=t.top)==null?void 0:b.call(t,i.value)},default:()=>{var b,E,I,L,O,N;return t.default?t.default(i.value):a(V,null,[(b=t.colgroup)==null?void 0:b.call(t,i.value),!e.hideDefaultHeader&&a("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[a(M,T(ue,{sticky:e.fixedHeader}),t)]),(E=t.thead)==null?void 0:E.call(t,i.value),!e.hideDefaultBody&&a("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(I=t["body.prepend"])==null?void 0:I.call(t,i.value),t.body?t.body(i.value):a(F,T(p,me,{items:$.value}),t),(L=t["body.append"])==null?void 0:L.call(t,i.value)]),(O=t.tbody)==null?void 0:O.call(t,i.value),(N=t.tfoot)==null?void 0:N.call(t,i.value)])},bottom:()=>t.bottom?t.bottom(i.value):!e.hideDefaultFooter&&a(V,null,[a(j,null,null),a(R,k,{prepend:t["footer.prepend"]})])})})}}),tt=[{title:"Target",align:"left",sortable:!1,key:"asset"},{title:"Title",align:"left",sortable:!1,key:"title",width:"24%"},{title:"Created time (UTC)",align:"left",sortable:!1,key:"CreatedTime",width:"14%"},{title:"Progress",align:"left",sortable:!1,key:"Progress",width:"8%"},{title:"Actions",align:"left",sortable:!1,key:"Action",width:"5%"}],at=Y({components:{OXOAssets:Ae,DfScanProgress:Le,DfConfirmationModal:We},props:{scanner:{type:Object,required:!0}},data(){return{service:new Ie(this.$axios),scans:[],deleteScanDialog:!1,loading:!0,options:{itemsPerPage:15,page:1,sortDesc:[!0],sortBy:[{key:"CreatedTime",order:"desc"}]},onActionScan:null,stopDialog:!1,headers:tt,currentPage:0}},computed:{...q(U,["scanners"]),actions(){return[{title:"Stop",action:this.stopScan,icon:"mdi-stop",disabled(e){var n,p;return!(((n=e.progress)==null?void 0:n.toLowerCase())==="in_progress"||((p=e.progress)==null?void 0:p.toLowerCase())==="not_started")}},{divider:!0},{title:"Delete",action:this.deleteScan,icon:"mdi-delete"}]}},watch:{options:{handler(){this.fetchScans()},deep:!0}},methods:{...be($e,["reportSuccess","reportError"]),goToScan(e,n){this.$router.push({name:"scan-scanner-scan",params:{scan:n.item.id,scanner:_e(this.scanner.endpoint)}})},async confirmStop(){if(!(this.onActionScan===null||this.onActionScan===void 0))try{await this.service.stopScan(this.scanner,parseInt(this.onActionScan.id)),await this.fetchScans()}catch(e){this.reportError((e==null?void 0:e.message)||"An error occurred while stoping the scan")}finally{this.onActionScan=null}},stopScan(e){this.onActionScan=e,this.stopDialog=!0},deleteScan(e){this.onActionScan=e,this.deleteScanDialog=!0},async confirmDeleteScan(){if(!(this.onActionScan===null||this.onActionScan===void 0)){try{this.loading=!0,await this.service.deleteScan(this.scanner,parseInt(this.onActionScan.id)),this.reportSuccess("Scan deleted successfully")}catch(e){this.reportError(`An error occurred while deleting the scan: ${e==null?void 0:e.message}`)}finally{this.onActionScan=null,this.loading=!1}await this.fetchScans()}},async fetchScans(){this.loading=!0;try{if(!this.scanner)return;this.scans=await this.service.getScans(this.scanner,{numberElements:this.options.itemsPerPage,page:this.options.page})}catch(e){this.reportError(`An error occurred while fetching scans from: ${this.scanner.name||this.scanner.endpoint}: ${e.message}`)}finally{this.loading=!1}}}}),ot={class:"d-flex align-center"};function st(e,n,p,t,f,d){const g=h("DfConfirmationModal"),S=h("DfScanProgress"),c=h("OXOAssets");return l(),D("div",null,[a(g,{modelValue:e.stopDialog,"onUpdate:modelValue":n[0]||(n[0]=o=>e.stopDialog=o),title:"Are you sure you would like to stop the scan?",description:"A stopped scan cannot be resumed.","cancel-button-text":"Cancel","confirm-button-text":"Stop","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-stop-circle-outline",onConfirm:e.confirmStop},null,8,["modelValue","onConfirm"]),a(g,{modelValue:e.deleteScanDialog,"onUpdate:modelValue":n[1]||(n[1]=o=>e.deleteScanDialog=o),title:"Are you sure you would like to archive this scan?","cancel-button-text":"Cancel","confirm-button-text":"Delete","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-archive-arrow-down-outline",onConfirm:e.confirmDeleteScan},null,8,["modelValue","onConfirm"]),a(x,{variant:"outlined"},{default:s(()=>[a(Q,{class:"pt-2 pl-2"},{default:s(()=>[a(ye,{label:""},{default:s(()=>[m(y(e.scanner.name||e.scanner.endpoint),1)]),_:1})]),_:1}),a(et,{options:e.options,"onUpdate:options":n[2]||(n[2]=o=>e.options=o),hover:"",headers:e.headers,items:e.scans,"items-length":e.service.totalScans,loading:e.loading,"items-per-page-options":[15,50,200,-1],"items-per-page":e.options.itemsPerPage,density:"comfortable","onClick:row":e.goToScan},{"item.Progress":s(({item:o})=>[a(S,{progress:o.progress||"unknown"},null,8,["progress"])]),"item.CreatedTime":s(({item:o})=>[m(y(e.$moment(o.createdTime).format("MMMM Do YYYY, k:mm:ss")),1)]),"item.Action":s(({item:o})=>[a(De,{bottom:"",left:"","offset-y":""},{activator:s(({props:r})=>[a(z,T({icon:"mdi-dots-vertical"},r,{variant:"flat",size:"small"}),null,16)]),default:s(()=>[a(Pe,{density:"compact"},{default:s(()=>[(l(!0),D(V,null,X(e.actions,(r,v)=>(l(),D(V,null,[r.divider!==void 0?(l(),P(j,{key:`divider-${v}`,class:"mb-2 mt-2"})):(l(),P(ke,{key:`item-${v}`,density:"compact",disabled:r.disabled?r.disabled(o):!1,onClick:A=>r.action&&r.action(o)},{default:s(()=>[Ve("div",ot,[a(we,{start:""},{default:s(()=>[m(y(r.icon),1)]),_:2},1024),a(Te,null,{default:s(()=>[m(y(r.title),1)]),_:2},1024)])]),_:2},1032,["disabled","onClick"]))],64))),256))]),_:2},1024)]),_:2},1024)]),"item.asset":s(({item:o})=>[a(c,{assets:o.assets||[]},null,8,["assets"])]),"item.title":s(({item:o})=>[m(y(o.title||"-"),1)]),_:2},1032,["options","headers","items","items-length","loading","items-per-page","onClick:row"])]),_:1})])}const nt=W(at,[["render",st]]),rt=Y({components:{ScanList:nt,DfBreadcrumbs:Be,SvgLoader:Je},data(){return{loading:!0,breadcrumbs:[{text:"Scans",to:"/scan/list",exact:!0,disabled:!0}]}},computed:{...q(U,["scanners"])},mounted(){this.loading=!1}});function it(e,n,p,t,f,d){const g=h("DfBreadcrumbs"),S=h("SvgLoader"),c=h("scan-list");return l(),D("div",null,[a(g,{breadcrumbs:e.breadcrumbs,class:"mb-5"},null,8,["breadcrumbs"]),a(Ke,{justify:"center"},{default:s(()=>[e.loading===!0?(l(),P(S,{key:0})):e.loading===!1&&e.scanners.length>0?(l(!0),D(V,{key:1},X(e.scanners,o=>(l(),P(H,{key:o.endpoint,cols:"12"},{default:s(()=>[a(c,{scanner:o},null,8,["scanner"])]),_:2},1024))),128)):e.loading===!1&&e.scanners.length===0?(l(),P(H,{key:2,content:"center","align-self":"center"},{default:s(()=>[a(x,{variant:"outlined"},{default:s(()=>[a(Q,null,{default:s(()=>[m("No scanners found")]),_:1}),a(Ee,null,{default:s(()=>[a(z,{variant:"elevated",color:"accent",to:"/scanners"},{default:s(()=>[m(" Add Scanner ")]),_:1})]),_:1})]),_:1})]),_:1})):Ce("",!0)]),_:1})])}const yt=W(rt,[["render",it]]);export{yt as default};
