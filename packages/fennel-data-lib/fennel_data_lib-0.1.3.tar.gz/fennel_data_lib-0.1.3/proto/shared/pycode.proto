syntax = "proto3";

package fennel.proto.pycode;

enum RefType {
  Dataset = 0;
  Featureset = 1;
}

message PyCode {
  string entry_point = 1;
  // This is the code that we use for logical equality, and if this code
  // changes we update/throw an error.
  string source_code = 2;
  // This is purely the code of the function/module.
  string core_code = 3;
  // This is the fully specified code apart from imports that can be used to
  // run this pycode and contains all the required dependencies. This is the
  // code that we use for physical equality. If changed, an update is pushed.
  string generated_code = 4 ;
  // These are other python functions that a fennel objects depends on to run.
  // These are already included in the generated_code.
  repeated PyCode includes = 5;
  // This contains symbolic references to other objects needed apart from the source_code.
  // The generated code already contains the actual code for these objects.
  map<string, RefType> ref_includes = 6;
  // The list of imports that are required for this code to run.
  string imports = 7;
}

message UDF {
   oneof node {
     PyCode pycode = 1;
     // Used for serializing a literal as a JSON string
     string json_literal = 2;
   }
}