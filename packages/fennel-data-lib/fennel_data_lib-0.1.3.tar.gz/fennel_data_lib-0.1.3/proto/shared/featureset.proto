syntax = "proto3";

package fennel.proto.featureset;

import "metadata.proto";
import "schema.proto";
import "pycode.proto";

message CoreFeatureset {
    string name = 1;
    fennel.proto.metadata.Metadata metadata = 2;
    fennel.proto.pycode.PyCode pycode = 3;
    repeated string tags = 4;
}

message Feature {
    string name = 1;
    fennel.proto.schema.DataType dtype = 2;
    fennel.proto.metadata.Metadata metadata = 3;
    string feature_set_name = 4;
    repeated string tags = 5;
}

enum ExtractorType {
    // user supplied python extractor function
    PY_FUNC = 0;
    LOOKUP = 1;
    ALIAS = 2;
}

message FieldLookupInfo {
    fennel.proto.schema.Field field = 1;
    // expected to be sent as json
    string default_value = 3;
}

message Extractor {
    string name = 1;
    repeated string datasets = 2;
    repeated Input inputs = 3;
    // The features that this extractor produces
    repeated string features = 4;
    fennel.proto.metadata.Metadata metadata = 5;
    int32 version = 6;
    // required iff extractor_type == PY_FUNC
    fennel.proto.pycode.PyCode pycode = 7;
    string feature_set_name = 8;
    ExtractorType extractor_type = 9;
    oneof derived_extractor_info {
        // pycode excluded from the oneof for better bwd compatibility in Rust
        // required iff extractor_type == LOOKUP
        FieldLookupInfo field_info = 10;
    }
    repeated string tags = 11;
}

message Input {
    message Feature {
        string feature_set_name = 1;
        string name = 2;
    }
    Feature feature = 1;
}

message Model {
    string name = 1;
    repeated Feature inputs = 2;
    repeated Feature outputs = 3;
    fennel.proto.metadata.Metadata metadata = 4;
}
