"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6130],{96130:function(e,t,s){s.r(t),s.d(t,{AutomationRoot:function(){return eq},default:function(){return eI}});var n=s(52322),r=s(7267),o=s(49308),l=s(74580),i=s(35292),a=s(14934),d=s(73407),c=s(79106),u=s(39268),h=s(39013),x=s(35505);let m=x.ZP.div.withConfig({componentId:"sc-4c0f5ca0-0"})(["width:10px;height:10px;border-radius:50%;background-color:",";"],e=>{let{$paused:t}=e;return!1===t?h.L$():h.md()});var p=s(71348),j=s(89918);let f=e=>{let{tab:t}=e,s=(0,p.dx)(),r=(0,u.I)();return(0,n.jsx)(a.x,{flex:{direction:"row",justifyContent:"space-between",alignItems:"flex-end"},children:(0,n.jsxs)(d.mQ,{selectedTabId:t,children:[(0,n.jsx)(j.f,{id:"schedules",title:"Schedules",to:"/automation/schedules"}),(0,n.jsx)(j.f,{id:"sensors",title:"Sensors",to:"/automation/sensors"}),"has-global-amp"===r?(0,n.jsx)(j.f,{id:"amp",title:(0,n.jsxs)(a.x,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,n.jsx)("div",{children:"Auto-materialize"}),s.loading?(0,n.jsx)(c.$,{purpose:"body-text"}):(0,n.jsx)(m,{$paused:s.paused})]}),to:"/automation/auto-materialize"}):null,(0,n.jsx)(j.f,{id:"backfills",title:"Backfills",to:"/automation/backfills"})]})})};var g=s(71406),v=s(69737),y=s(26954),S=s(20171);let b=()=>{let e=(0,u.I)();switch(e){case"unknown":return(0,n.jsx)("div",{});case"has-global-amp":return(0,n.jsx)(w,{});case"has-sensor-amp":return(0,n.jsx)(r.l_,{to:"/automation/sensors"});default:(0,g.UT)(e)}},w=()=>((0,v.Px)(),(0,S.j)("Automation | Auto-materialize"),(0,n.jsxs)(o.T,{children:[(0,n.jsx)(l.m,{title:(0,n.jsx)(i.X6,{children:"Automation"}),tabs:(0,n.jsx)(f,{tab:"amp"})}),(0,n.jsx)(y.$,{})]}));var A=s(7870);let E=()=>((0,v.Px)(),(0,S.j)("Automation | Backfills"),(0,n.jsxs)(o.T,{children:[(0,n.jsx)(l.m,{title:(0,n.jsx)(i.X6,{children:"Automation"}),tabs:(0,n.jsx)(f,{tab:"backfills"})}),(0,n.jsx)(A.A,{})]}));var N=s(6685);let k=()=>((0,v.Px)(),(0,S.j)("Automation | Schedules"),(0,n.jsxs)(a.x,{flex:{direction:"column"},style:{height:"100%",overflow:"hidden"},children:[(0,n.jsx)(l.m,{title:(0,n.jsx)(i.X6,{children:"Automation"}),tabs:(0,n.jsx)(f,{tab:"schedules"})}),(0,n.jsx)(N.z,{})]}));var C=s(80089);let T=()=>((0,v.Px)(),(0,S.j)("Automation | Sensors"),(0,n.jsxs)(a.x,{flex:{direction:"column"},style:{height:"100%",overflow:"hidden"},children:[(0,n.jsx)(l.m,{title:(0,n.jsx)(i.X6,{children:"Automation"}),tabs:(0,n.jsx)(f,{tab:"sensors"})}),(0,n.jsx)(C.n,{})]}));var M=s(45774),z=s(37483),L=s(74159),_=s(2784),q=s(35002),I=s(43212),R=s(88510),O=s(17008);let U="60px minmax(400px, 1.5fr) 220px 1fr 200px 200px",P=e=>{let{checkbox:t}=e;return(0,n.jsxs)(O.VJ,{templateColumns:U,sticky:!0,children:[(0,n.jsx)(O.qN,{children:(0,n.jsx)("div",{style:{position:"relative",top:"-1px"},children:t})}),(0,n.jsx)(O.qN,{children:"Name"}),(0,n.jsx)(O.qN,{children:"Type"}),(0,n.jsx)(O.qN,{children:"Target"}),(0,n.jsx)(O.qN,{children:"Last tick"}),(0,n.jsx)(O.qN,{children:"Last run"})]})},H=(0,x.ZP)(a.x).withConfig({componentId:"sc-825fcf49-0"})(["display:grid;grid-template-columns:",";height:100%;"],U);var $=s(3842),V=s(37504),B=s(53664),X=s(47933),Y=s(16336),Q=s(88257),W=s(60648),Z=s(34219),G=s(33847),K=s(92474),F=s(4219),D=s(73310),J=s(86269),ee=s(58905),et=s(27028),es=s(83738),en=s(100),er=s(10539);let eo=(0,_.forwardRef)((e,t)=>{let{index:s,name:r,repoAddress:o,checked:l,onToggleChecked:d}=e,c=(0,en.Ux)(o),[u,h]=(0,$.t)(et.B8,{variables:{selector:{repositoryName:o.name,repositoryLocationName:o.location,scheduleName:r}},notifyOnNetworkStatusChange:!0});(0,Z.Hu)(h,"SingleScheduleQuery"),(0,es.v5)(u),(0,Y.C4)(h,Y.dT);let{data:x}=h,m=(0,_.useMemo)(()=>(null==x?void 0:x.scheduleOrError.__typename)!=="Schedule"?null:x.scheduleOrError,[x]),p=!!(m&&(0,en.E8)(c,m.pipelineName)),j=null==m?void 0:m.scheduleState,f=(0,_.useMemo)(()=>{if(!j)return{disabled:!0};let{hasStartPermission:e,hasStopPermission:t,status:s}=j;return s!==Q.ynu.RUNNING||t?s!==Q.ynu.STOPPED||e?{disabled:!1}:{disabled:!0,message:"You do not have permission to start this schedule"}:{disabled:!0,message:"You do not have permission to stop this schedule"}},[j]),g=null==m?void 0:m.scheduleState.ticks[0];return(0,n.jsx)("div",{ref:t,"data-index":s,children:(0,n.jsxs)(H,{border:"bottom",children:[(0,n.jsx)(O.E5,{children:(0,n.jsx)(q.u,{canShow:f.disabled,content:f.message||"",placement:"top",children:(0,n.jsx)(V.X,{disabled:f.disabled,checked:l,onChange:e=>{if(d&&e.target instanceof HTMLInputElement){let{checked:t}=e.target;d({checked:t,shiftKey:e.nativeEvent instanceof MouseEvent&&e.nativeEvent.getModifierState("Shift")})}}})})}),(0,n.jsx)(O.E5,{children:(0,n.jsxs)(a.x,{flex:{direction:"row",gap:8,alignItems:"flex-start"},children:[m?(0,n.jsxs)(a.x,{flex:{direction:"column",gap:4},children:[(0,n.jsx)(F.M,{repoAddress:o,schedule:m},r),(0,D.l)(m.scheduleState.status,m.scheduleState.runningCount)]}):(0,n.jsx)("div",{style:{width:30}}),(0,n.jsx)(X.rU,{to:(0,er.$U)(o,"/schedules/".concat(r)),children:(0,n.jsx)(B.g,{text:r})})]})}),(0,n.jsx)(O.E5,{children:m?(0,n.jsxs)(a.x,{flex:{direction:"column",gap:4},children:[(0,n.jsx)(K.P,{cronSchedule:m.cronSchedule,executionTimezone:m.executionTimezone}),m.scheduleState.nextTick&&m.scheduleState.status===Q.ynu.RUNNING?(0,n.jsx)(i.YS,{children:(0,n.jsxs)("div",{style:{overflow:"hidden",whiteSpace:"nowrap",maxWidth:"100%",textOverflow:"ellipsis"},children:["Next tick:\xa0",(0,n.jsx)(J.v,{timestamp:m.scheduleState.nextTick.timestamp,timezone:m.executionTimezone,timeFormat:{showSeconds:!1,showTimezone:!0}})]})}):null]}):(0,n.jsx)(es.mq,{queryResult:h})}),(0,n.jsx)(O.E5,{children:m?(0,n.jsx)(i.YS,{children:(0,n.jsx)(G.h,{showIcon:!0,size:"small",pipelineName:m.pipelineName,pipelineHrefContext:o,isJob:p})}):null}),(0,n.jsx)(O.E5,{children:g?(0,n.jsx)("div",{children:(0,n.jsx)(ee.a,{tick:g})}):(0,n.jsx)(es.mq,{queryResult:h})}),(0,n.jsx)(O.E5,{children:(null==m?void 0:m.scheduleState)&&(null==m?void 0:m.scheduleState.runs[0])?(0,n.jsx)(W.Z,{run:m.scheduleState.runs[0],name:r,showButton:!1,showHover:!0,showSummary:!1}):(0,n.jsx)(es.mq,{queryResult:h})})]})})});var el=s(24427),ei=s(6265),ea=s(60918),ed=s(53029);let ec=(0,_.forwardRef)((e,t)=>{var s;let{index:r,name:o,repoAddress:l,checked:i,onToggleChecked:d}=e,[c,u]=(0,$.t)(ed.bL,{variables:{selector:{repositoryName:l.name,repositoryLocationName:l.location,sensorName:o}}});(0,Z.Hu)(u,"SingleSensorQuery");let[h,x]=(0,$.t)(ei.Z,{variables:{sensorSelector:{repositoryName:l.name,repositoryLocationName:l.location,sensorName:o}}});(0,Z.Hu)(x,"SensorAssetSelectionQuery"),(0,es.v5)((0,_.useCallback)(()=>{c(),h()},[c,h])),(0,Y.C4)(u,Y.dT),(0,Y.C4)(x,Y.dT);let{data:m}=u,p=(0,_.useMemo)(()=>(null==m?void 0:m.sensorOrError.__typename)!=="Sensor"?null:m.sensorOrError,[m]),j=null==p?void 0:p.sensorState,f=(0,_.useMemo)(()=>{if(!j)return{disabled:!0};let{hasStartPermission:e,hasStopPermission:t,status:s}=j;return s!==Q.ynu.RUNNING||t?s!==Q.ynu.STOPPED||e?{disabled:!1}:{disabled:!0,message:"You do not have permission to start this sensor"}:{disabled:!0,message:"You do not have permission to stop this sensor"}},[j]),g=null==p?void 0:p.sensorState.ticks[0],v=null==p?void 0:p.sensorType,y=v?ed.W_[v]:null,S=(null===(s=x.data)||void 0===s?void 0:s.sensorOrError.__typename)==="Sensor"?x.data.sensorOrError.assetSelection:null;return(0,n.jsx)("div",{ref:t,"data-index":r,children:(0,n.jsxs)(H,{border:"bottom",children:[(0,n.jsx)(O.E5,{children:(0,n.jsx)(q.u,{canShow:f.disabled,content:f.message||"",placement:"top",children:(0,n.jsx)(V.X,{disabled:f.disabled,checked:i,onChange:e=>{if(d&&e.target instanceof HTMLInputElement){let{checked:t}=e.target;d({checked:t,shiftKey:e.nativeEvent instanceof MouseEvent&&e.nativeEvent.getModifierState("Shift")})}}})})}),(0,n.jsx)(O.E5,{children:(0,n.jsxs)(a.x,{flex:{direction:"row",gap:8,alignItems:"flex-start"},children:[p?(0,n.jsx)(ea.c,{repoAddress:l,sensor:p},o):(0,n.jsx)("div",{style:{width:30}}),(0,n.jsx)(X.rU,{to:(0,er.$U)(l,"/sensors/".concat(o)),children:(0,n.jsx)(B.g,{text:o})})]})}),(0,n.jsx)(O.E5,{children:(0,n.jsx)("div",{children:y?y.description?(0,n.jsx)(q.u,{content:y.description,children:(0,n.jsx)(I.V,{icon:y.icon,children:y.name})}):(0,n.jsx)(I.V,{icon:y.icon,children:y.name}):null})}),(0,n.jsx)(O.E5,{children:(0,n.jsx)(a.x,{flex:{direction:"column",gap:4},style:{fontSize:"12px"},children:p?(0,n.jsx)(el.p,{targets:p.targets,repoAddress:l,assetSelection:S,automationType:p.sensorType}):null})}),(0,n.jsx)(O.E5,{children:g?(0,n.jsx)("div",{children:(0,n.jsx)(ee.a,{tick:g})}):(0,n.jsx)(es.mq,{queryResult:u})}),(0,n.jsx)(O.E5,{children:(null==p?void 0:p.sensorState)&&(null==p?void 0:p.sensorState.runs[0])?(0,n.jsx)(W.Z,{run:p.sensorState.runs[0],name:o,showButton:!1,showHover:!0,showSummary:!1}):(0,n.jsx)(es.mq,{queryResult:u})})]})})});var eu=s(22921),eh=s(40389),ex=s(98956),em=s(50646),ep=s(22563);let ej=e=>{var t,s;let{repos:r,headerCheckbox:o,checkedKeys:l,onToggleCheckFactory:i}=e,d=_.useRef(null),c=_.useMemo(()=>r.map(e=>{let{repoAddress:t}=e;return(0,ep.Uz)(t)}),[r]),{expandedKeys:u,onToggle:h,onToggleAll:x}=(0,em.N)(eu.y,c),m=_.useMemo(()=>{let e=[];return r.forEach(t=>{let{repoAddress:s,schedules:n,sensors:r}=t;e.push({type:"header",repoAddress:s,scheduleCount:n.length,sensorCount:r.length});let o=(0,ep.Uz)(s);if(u.includes(o)){let t=new Set(r),o=new Set(n);[...r,...n].sort((e,t)=>g.Bl.compare(e,t)).forEach(n=>{t.has(n)?e.push({type:"sensor",repoAddress:s,sensor:n}):o.has(n)&&e.push({type:"schedule",repoAddress:s,schedule:n})})}}),e},[r,u]),p=(0,ex.w)(r.map(e=>{let{repoAddress:t}=e;return t.name})),j=(0,R.MG)({count:m.length,getScrollElement:()=>d.current,estimateSize:e=>{let t=m[e];return(null==t?void 0:t.type)==="header"?32:64},overscan:15}),f=j.getTotalSize(),v=j.getVirtualItems();return(0,n.jsx)("div",{style:{overflow:"hidden"},children:(0,n.jsxs)(O.W2,{ref:d,children:[(0,n.jsx)(P,{checkbox:o}),(0,n.jsx)(O.Nh,{$totalHeight:f,children:(0,n.jsx)(O.HR,{$start:null!==(s=null===(t=v[0])||void 0===t?void 0:t.start)&&void 0!==s?s:0,children:v.map(e=>{let{index:t,key:s}=e,r=m[t],o=r.type;if("header"===o)return(0,n.jsx)(es._$,{repoAddress:r.repoAddress,ref:j.measureElement,index:t,onToggle:h,onToggleAll:x,expanded:u.includes((0,ep.Uz)(r.repoAddress)),showLocation:p.has(r.repoAddress.name),rightElement:(0,n.jsxs)(a.x,{flex:{direction:"row",gap:4},children:[(0,n.jsx)(q.u,{content:1===r.sensorCount?"1 sensor":"".concat(r.sensorCount," sensors"),placement:"top",children:(0,n.jsx)(I.V,{icon:"sensors",children:r.sensorCount})}),(0,n.jsx)(q.u,{content:1===r.scheduleCount?"1 schedule":"".concat(r.scheduleCount," schedules"),placement:"top",children:(0,n.jsx)(I.V,{icon:"schedule",children:r.scheduleCount})})]})},s);if("sensor"===o){let e=(0,eh.M)(r.repoAddress,r.sensor);return(0,n.jsx)(ec,{index:t,ref:j.measureElement,name:r.sensor,checked:l.has(e),onToggleChecked:i(e),repoAddress:r.repoAddress},s)}if("schedule"===o){let e=(0,eh.M)(r.repoAddress,r.schedule);return(0,n.jsx)(eo,{index:t,ref:j.measureElement,name:r.schedule,checked:l.has(e),onToggleChecked:i(e),repoAddress:r.repoAddress},s)}return(0,n.jsx)("div",{},s)})})})]})})};var ef=s(4378),eg=s(52154),ev=s(77044),ey=s(907),eS=s(49455),eb=s(74302),ew=s(81602),eA=s(2389),eE=s(50027),eN=s(2949),ek=s(65822);let eC={schedules:{label:"Schedules",value:{type:"schedules",label:"Schedules"},match:["schedules"]},sensors:{label:"Sensors",value:{type:"sensors",label:"Sensors"},match:["sensors"]}},eT=Object.values(eC),eM=()=>{(0,v.Px)(),(0,S.j)("Automation");let{allRepos:e,visibleRepos:t,loading:s,data:r}=(0,_.useContext)(en.C5),[o,l]=(0,ef.q)({queryKey:"search",defaults:{search:""}}),[i,d]=(0,ef.q)({encode:e=>({automationType:e.size?Array.from(e).join(","):void 0}),decode:e=>{var t;return new Set((null===(t=e.automationType)||void 0===t?void 0:t.split(","))||[])}}),c=(0,_.useMemo)(()=>new Set(Array.from(i).map(e=>eC[e].value)),[i]),u=(0,eE.A)(),h=(0,eN.g)(),x=(0,ew.im)({name:"Automation type",allValues:eT,icon:"auto_materialize_policy",getStringValue:e=>e.label,state:c,renderLabel:e=>{let{value:t}=e;return(0,n.jsx)("span",{children:t.label})},onStateChanged:e=>{d(new Set(Array.from(e).map(e=>e.type)))}}),m=(0,_.useMemo)(()=>[u,h,x],[u,h,x]),{button:p,activeFiltersJsx:j}=(0,eb.m)({filters:m}),f=(0,_.useMemo)(()=>{let e=Object.values(r).filter(e=>"WorkspaceLocationEntry"===e.__typename),s=(0,eS.S)(t);return ez(e).filter(e=>{let{repoAddress:t}=e;return s.has((0,ep.Uz)(t))})},[r,t]),{state:g}=h,y=(0,_.useMemo)(()=>f.map(e=>{let{sensors:t,schedules:s,...n}=e;return{...n,sensors:t.filter(e=>{let{sensorState:t}=e;return(!g.size||!!g.has(t.status))&&(!i.size||!!i.has("sensors"))}),schedules:s.filter(e=>{let{scheduleState:t}=e;return(!g.size||!!g.has(t.status))&&(!i.size||!!i.has("schedules"))})}}),[f,i,g]),b=o.trim().toLocaleLowerCase(),w=b.length>0,A=(0,_.useMemo)(()=>{let e=b.toLocaleLowerCase();return y.map(t=>{let{repoAddress:s,schedules:n,sensors:r}=t;return{repoAddress:s,schedules:n.filter(t=>{let{name:s}=t;return s.toLocaleLowerCase().includes(e)}).map(e=>{let{name:t}=e;return t}),sensors:r.filter(t=>{let{name:s}=t;return s.toLocaleLowerCase().includes(e)}).map(e=>{let{name:t}=e;return t})}}).filter(e=>{let{sensors:t,schedules:s}=e;return t.length>0||s.length>0})},[y,b]),E=(0,_.useMemo)(()=>y.map(e=>{let{repoAddress:t,schedules:s,sensors:n}=e;return[...n.filter(e=>{let{sensorState:t}=e;return(0,ev.i)(t)}).map(e=>{let{name:s}=e;return{repoAddress:t,name:s}}),...s.filter(e=>{let{scheduleState:t}=e;return(0,ev.i)(t)}).map(e=>{let{name:s}=e;return{repoAddress:t,name:s}})]}).flat(),[y]),N=(0,_.useMemo)(()=>E.map(e=>{let{repoAddress:t,name:s}=e;return(0,eh.M)(t,s)}),[E]),[{checkedIds:k},{onToggleFactory:C,onToggleAll:T}]=(0,eg.a)(N),q=(0,_.useMemo)(()=>{let e=new Set(A.map(e=>{let{repoAddress:t,schedules:s,sensors:n}=e;return[...s,...n].map(e=>(0,eh.M)(t,e))}).flat());return N.filter(t=>e.has(t))},[N,A]),I=(0,_.useMemo)(()=>{let e=new Set(q.filter(e=>k.has(e)));return E.filter(t=>{let{repoAddress:s,name:n}=t;return e.has((0,eh.M)(s,n))})},[q,E,k]),R=N.length>0,O=I.length;return(0,n.jsxs)(a.x,{flex:{direction:"column"},style:{height:"100%",overflow:"hidden"},children:[(0,n.jsx)(a.x,{padding:{horizontal:24,vertical:16},flex:{direction:"row",alignItems:"center",justifyContent:"space-between",gap:12,grow:0},children:(0,n.jsxs)(a.x,{flex:{direction:"row",gap:12},children:[p,(0,n.jsx)(L.oi,{icon:"search",value:o,onChange:e=>l(e.target.value),placeholder:"Filter by name…",style:{width:"340px"}})]})}),j.length?(0,n.jsx)(a.x,{padding:{vertical:8,horizontal:24},border:"top-and-bottom",flex:{direction:"row",gap:8},children:j}):null,(()=>{if(s)return(0,n.jsx)(a.x,{flex:{direction:"row",justifyContent:"center"},padding:{top:64},children:(0,n.jsx)(M.f,{label:"Loading automations…"})});let r=e.length>t.length;return A.length?(0,n.jsx)(ej,{headerCheckbox:R?(0,n.jsx)(eA.W,{checkedCount:O,totalCount:q.length,onToggleAll:T}):void 0,repos:A,checkedKeys:k,onToggleCheckFactory:C}):w?(0,n.jsx)(a.x,{padding:{top:20},children:(0,n.jsx)(z.t,{icon:"search",title:"No matching automations",description:r?(0,n.jsxs)("div",{children:["No automations matching ",(0,n.jsx)("strong",{children:o})," were found in the selected code locations"]}):(0,n.jsxs)("div",{children:["No automations matching ",(0,n.jsx)("strong",{children:o})," were found in your definitions"]})})}):(0,n.jsx)(a.x,{padding:{top:20},children:(0,n.jsx)(z.t,{icon:"search",title:"No automations",description:r?"No automations were found in the selected code locations":"No matching automations"})})})()]})},ez=e=>{let t=e.map(e=>e.locationOrLoadError),s=[];for(let e of t)if((null==e?void 0:e.__typename)==="RepositoryLocation")for(let t of e.repositories){let{name:n,schedules:r,sensors:o}=t,l=(0,ek.kQ)(n,e.name);o.length>0&&s.push({repoAddress:l,schedules:r,sensors:o})}return(0,ey.S)(s)};var eL=s(17872),e_=s(33707);let eq=()=>(0,n.jsxs)(r.rs,{children:[(0,n.jsx)(eL.A,{path:"/automation/schedules",children:(0,n.jsx)(k,{})}),(0,n.jsx)(eL.A,{path:"/automation/sensors",children:(0,n.jsx)(T,{})}),(0,n.jsx)(eL.A,{path:"/automation/backfills/:backfillId",children:(0,n.jsx)(e_.t4,{})}),(0,n.jsx)(eL.A,{path:"/automation/backfills",exact:!0,children:(0,n.jsx)(E,{})}),(0,n.jsx)(eL.A,{path:"/automation/auto-materialize",exact:!0,children:(0,n.jsx)(b,{})}),(0,n.jsx)(eL.A,{path:"/automation/merged",exact:!0,children:(0,n.jsx)(eM,{})}),(0,n.jsx)(eL.A,{path:"*",render:()=>(0,n.jsx)(r.l_,{to:"/automation/schedules"})})]});var eI=eq}}]);
//# sourceMappingURL=6130.5375adb680d5b916.js.map