export const id=85685;export const ids=[85685,92840];export const modules={72586:(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{EO:()=>y,ol:()=>l,xo:()=>c});var r=n(71460),s=n(25786),a=e([r]);r=(a.then?(await a)():a)[0];const i=(e,t,n,o)=>{const s=n((0,r.L_)(e,t),o);return s instanceof Date?(0,r.uk)(s,t):s},l=(e,t,n,o,r)=>n.time_zone===s.Wj.server?i(e,o.time_zone,t,r):t(e,r),c=(e,t,n,o,r)=>n.time_zone===s.Wj.server?i(e,o.time_zone,t,r):t(e,r),y=(e,t,n,o,a)=>c(e,n,o,a,o.time_zone===s.Wj.server?(0,r.L_)(t,a.time_zone):t);o()}catch(e){o(e)}}))},60441:(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{LW:()=>p,Xs:()=>u,fU:()=>c,ie:()=>g});var r=n(92840),s=n(45081),a=n(35163),i=n(97484),l=e([r]);r=(l.then?(await l)():l)[0];const c=(e,t,n)=>y(t,n.time_zone).format(e),y=(0,s.A)(((e,t)=>new Intl.DateTimeFormat(e.language,{hour:"numeric",minute:"2-digit",hourCycle:(0,i.J)(e)?"h12":"h23",timeZone:(0,a.w)(e.time_zone,t)}))),g=(e,t,n)=>_(t,n.time_zone).format(e),_=(0,s.A)(((e,t)=>new Intl.DateTimeFormat(e.language,{hour:(0,i.J)(e)?"numeric":"2-digit",minute:"2-digit",second:"2-digit",hourCycle:(0,i.J)(e)?"h12":"h23",timeZone:(0,a.w)(e.time_zone,t)}))),u=(e,t,n)=>d(t,n.time_zone).format(e),d=(0,s.A)(((e,t)=>new Intl.DateTimeFormat(e.language,{weekday:"long",hour:(0,i.J)(e)?"numeric":"2-digit",minute:"2-digit",hourCycle:(0,i.J)(e)?"h12":"h23",timeZone:(0,a.w)(e.time_zone,t)}))),p=(e,t,n)=>m(t,n.time_zone).format(e),m=(0,s.A)(((e,t)=>new Intl.DateTimeFormat("en-GB",{hour:"numeric",minute:"2-digit",hour12:!1,timeZone:(0,a.w)(e.time_zone,t)})));o()}catch(e){o(e)}}))},35163:(e,t,n)=>{n.d(t,{n:()=>c,w:()=>y});var o,r,s,a,i,l=n(25786);const c=null!==(o=null===(r=(s=Intl).DateTimeFormat)||void 0===r||null===(a=(i=r.call(s)).resolvedOptions)||void 0===a?void 0:a.call(i).timeZone)&&void 0!==o?o:"UTC",y=(e,t)=>e===l.Wj.local&&"UTC"!==c?c:t},97484:(e,t,n)=>{n.d(t,{J:()=>s});n(53501);var o=n(45081),r=n(25786);const s=(0,o.A)((e=>{if(e.time_format===r.Hg.language||e.time_format===r.Hg.system){const t=e.time_format===r.Hg.language?e.language:void 0;return new Date("January 1, 2023 22:00:00").toLocaleString(t).includes("10")}return e.time_format===r.Hg.am_pm}))},47186:(e,t,n)=>{n.d(t,{$:()=>o});n(21950),n(71936),n(8339);const o=(e,t)=>{const n={};for(const o of e){const e=t(o);e in n?n[e].push(o):n[e]=[o]}return n}},60280:(e,t,n)=>{n.d(t,{JW:()=>u,TC:()=>s,VN:()=>a,Vx:()=>i,XQ:()=>g,eM:()=>c,iH:()=>l,k3:()=>_,m4:()=>o,qf:()=>r,yv:()=>y});n(21950),n(14460),n(8339);const o=33524==n.j?["migration_error","setup_error","setup_retry"]:null,r=33524==n.j?["not_loaded","loaded","setup_error","setup_retry"]:null,s=(e,t,n)=>{const o={type:"config_entries/subscribe"};return n&&n.type&&(o.type_filter=n.type),e.connection.subscribeMessage((e=>t(e)),o)},a=(e,t)=>{const n={};return t&&(t.type&&(n.type_filter=t.type),t.domain&&(n.domain=t.domain)),e.callWS({type:"config_entries/get",...n})},i=(e,t)=>e.callWS({type:"config_entries/get_single",entry_id:t}),l=(e,t,n)=>e.callWS({type:"config_entries/update",entry_id:t,...n}),c=(e,t)=>e.callApi("DELETE",`config/config_entries/entry/${t}`),y=(e,t)=>e.callApi("POST",`config/config_entries/entry/${t}/reload`),g=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:"user"}),_=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:null}),u=(e,t)=>{const n=[...e],o=e=>{const n=t[e.domain];return"helper"===(null==n?void 0:n.integration_type)?-1:1};return n.sort(((e,t)=>o(t)-o(e)))}},41525:(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{AN:()=>j,B2:()=>C,BV:()=>E,E$:()=>L,GW:()=>S,KJ:()=>B,Q4:()=>W,RB:()=>k,WN:()=>A,X4:()=>V,_d:()=>F,al:()=>O,bs:()=>Z,c:()=>P,m7:()=>T,oU:()=>D,tb:()=>M,uh:()=>z,yM:()=>N});n(27934),n(53501),n(21950),n(71936),n(55888),n(66274),n(84531),n(98168),n(8339);var r=n(81438),s=n(72502),a=n(57442),i=n(39937),l=n(23177),c=n(94061),y=n(87930),g=n(93352),_=n(79113),u=n(84749),d=n(99955),p=n(72586),m=n(60441),h=n(47186),f=n(60280),w=n(74959),b=e([p,m]);[p,m]=b.then?(await b)():b;const v=[],T=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),k=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),z=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),W=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),D=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),P=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),S=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),E=e=>e.callWS({type:"energy/info"}),C=async e=>(await e.loadBackendTranslation("issues","energy"),e.callWS({type:"energy/validate"})),Z=e=>e.callWS({type:"energy/get_prefs"}),A=async(e,t)=>{const n=e.callWS({type:"energy/save_prefs",...t});return H(e),n},J=async(e,t,n,o,r,s="hour")=>e.callWS({type:"energy/fossil_energy_consumption",start_time:t.toISOString(),end_time:null==r?void 0:r.toISOString(),energy_statistic_ids:n,co2_statistic_id:o,period:s}),L=e=>(0,h.$)(e.energy_sources,(e=>e.type)),j=(e,t,n)=>{const o=[];for(const r of e.energy_sources)if(!n||n.includes(r.type))if("solar"!==r.type)if("gas"!==r.type&&"water"!==r.type)if("battery"!==r.type){for(const e of r.flow_from){o.push(e.stat_energy_from),e.stat_cost&&o.push(e.stat_cost);const n=t.cost_sensors[e.stat_energy_from];n&&o.push(n)}for(const e of r.flow_to){o.push(e.stat_energy_to),e.stat_compensation&&o.push(e.stat_compensation);const n=t.cost_sensors[e.stat_energy_to];n&&o.push(n)}}else o.push(r.stat_energy_from),o.push(r.stat_energy_to);else{o.push(r.stat_energy_from),r.stat_cost&&o.push(r.stat_cost);const e=t.cost_sensors[r.stat_energy_from];e&&o.push(e)}else o.push(r.stat_energy_from);return n&&!n.includes("device")||o.push(...e.device_consumption.map((e=>e.stat_consumption))),o},x=async(e,t,n,o,g)=>{const[_,u]=await Promise.all([(0,f.VN)(e,{domain:"co2signal"}),E(e)]),d=_.length?_[0]:void 0;let m;if(d)for(const t of Object.values(e.entities)){if("co2signal"!==t.platform)continue;const n=e.states[t.entity_id];if(n&&"%"===n.attributes.unit_of_measurement){m=n.entity_id;break}}const h=[];for(const e of t.energy_sources)if("grid"===e.type)for(const t of e.flow_from)h.push(t.stat_energy_from);const b=j(t,u,["grid","solar","battery","gas","device"]),v=j(t,u,["water"]),T=[...b,...v],k=(0,r.c)(o||new Date,n),z=k>35?"month":k>2?"day":"hour",W=e.config.unit_system.length||"",D={energy:"kWh",volume:"km"===W?"m続":"ft続"},P={volume:"km"===W?"L":"gal"},S=b.length?(0,w.sz)(e,n,o,b,z,D,["change"]):{},C=v.length?(0,w.sz)(e,n,o,v,z,P,["change"]):{};let Z,A,L,x,H,I={},M={};g&&(A=(0,p.xo)(n,s.e,e.locale,e.config)&&(0,p.xo)(o||new Date,a.c,e.locale,e.config)?(0,p.ol)(n,i.P,e.locale,e.config,-(0,p.EO)(o||new Date,n,l.W,e.locale,e.config)-1):(0,p.ol)(n,c.f,e.locale,e.config,-1*(k+1)),L=(0,y.A)(n,-1),b.length&&(I=(0,w.sz)(e,A,L,b,z,D,["change"])),v.length&&(M=(0,w.sz)(e,A,L,v,z,P,["change"]))),void 0!==m&&(x=J(e,n,h,m,o,k>35?"month":k>2?"day":"hour"),g&&(H=J(e,A,h,m,L,k>35?"month":k>2?"day":"hour")));const O={},$=T.length?(0,w.Wr)(e,T):[],[F,B,N,V,U,X,K]=await Promise.all([S,C,I,M,$,x,H]),q={...F,...B};g&&(Z={...N,...V}),T.length&&U.forEach((e=>{O[e.statistic_id]=e}));return{start:n,end:o,startCompare:A,endCompare:L,info:u,prefs:t,stats:q,statsMetadata:O,statsCompare:Z,co2SignalConfigEntry:d,co2SignalEntity:m,fossilEnergyConsumption:X,fossilEnergyConsumptionCompare:K}},H=e=>{v.forEach((t=>{const n=M(e,{key:t});n.clearPrefs(),n._active&&n.refresh()}))},I=e=>{if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){const t=new Date;t.getMinutes()>=20&&t.setHours(t.getHours()+1),t.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((()=>e.refresh()),t.getTime()-Date.now())}},M=(e,t={})=>{let n="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n=`_${t.key}`}if(e.connection[n])return e.connection[n];v.push(t.key);const o=(0,d.X)(e.connection,n,(async()=>(o.prefs||(o.prefs=await Z(e)),I(o),x(e,o.prefs,o.start,o.end,o.compare)))),r=o.subscribe;o.subscribe=e=>{const t=r(e);return o._active++,void 0===o._refreshTimeout&&I(o),()=>{o._active--,o._active<1&&(clearTimeout(o._refreshTimeout),o._refreshTimeout=void 0),t()}},o._active=0,o.prefs=t.prefs;const s=new Date,a=(0,m.LW)(s,e.locale,e.config).split(":")[0];o.start=(0,p.ol)("0"===a?(0,c.f)(s,-1):s,g.o,e.locale,e.config),o.end=(0,p.ol)("0"===a?(0,c.f)(s,-1):s,_.D,e.locale,e.config);const i=()=>{o._updatePeriodTimeout=window.setTimeout((()=>{o.start=(0,p.ol)(new Date,g.o,e.locale,e.config),o.end=(0,p.ol)(new Date,_.D,e.locale,e.config),i()}),(0,u.L)((0,p.ol)(s,_.D,e.locale,e.config),1).getTime()-Date.now())};return i(),o.clearPrefs=()=>{o.prefs=void 0},o.setPeriod=(t,n)=>{var r;o.start=t,o.end=n,o.start.getTime()!==(0,p.ol)(new Date,g.o,e.locale,e.config).getTime()||(null===(r=o.end)||void 0===r?void 0:r.getTime())!==(0,p.ol)(new Date,_.D,e.locale,e.config).getTime()||o._updatePeriodTimeout?o._updatePeriodTimeout&&(clearTimeout(o._updatePeriodTimeout),o._updatePeriodTimeout=void 0):i()},o.setCompare=e=>{o.compare=e},o},O=e=>e.callWS({type:"energy/solar_forecast"}),$=["volume","energy"],F=(e,t={},n)=>{for(const o of e.energy_sources){if("gas"!==o.type)continue;if(n&&n===o.stat_energy_from)continue;const e=t[o.stat_energy_from];if($.includes(null==e?void 0:e.unit_class))return e.unit_class}},B=(e,t,n={})=>{const o=F(t,n);if(void 0!==o)return"energy"===o?"kWh":"km"===e.config.unit_system.length?"m続":"ft続"},N=e=>"km"===e.config.unit_system.length?"L":"gal",V="/docs/energy/faq/#troubleshooting-missing-entities";o()}catch(e){o(e)}}))},85685:(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.r(t),n.d(t,{EnergyViewStrategy:()=>y});var r=n(62659),s=(n(21950),n(71936),n(55888),n(66274),n(85767),n(22836),n(8339),n(40924)),a=n(18791),i=n(41525),l=e([i]);i=(l.then?(await l)():l)[0];const c=async()=>(await Promise.all([n.e(40806),n.e(54644),n.e(2948)]).then(n.bind(n,75642)),{type:"panel",cards:[{type:"custom:energy-setup-wizard-card"}]});let y=(0,r.A)([(0,a.EM)("energy-view-strategy")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"method",static:!0,key:"generate",value:async function(e,t){const n={cards:[]};let o;try{o=await(0,i.bs)(t)}catch(e){return"not_found"===e.code?c():(n.cards.push({type:"markdown",content:`An error occurred while fetching your energy preferences: ${e.message}.`}),n)}if(0===o.device_consumption.length&&0===o.energy_sources.length)return c();n.type="sidebar";const r=o.energy_sources.find((e=>{var t,n;return"grid"===e.type&&((null===(t=e.flow_from)||void 0===t?void 0:t.length)||(null===(n=e.flow_to)||void 0===n?void 0:n.length))})),s=r&&r.flow_to.length,a=o.energy_sources.some((e=>"solar"===e.type)),l=o.energy_sources.some((e=>"gas"===e.type)),y=o.energy_sources.some((e=>"water"===e.type));return n.cards.push({type:"energy-compare",collection_key:"energy_dashboard"}),r&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_usage_graph_title"),type:"energy-usage-graph",collection_key:"energy_dashboard"}),a&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_solar_graph_title"),type:"energy-solar-graph",collection_key:"energy_dashboard"}),l&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_gas_graph_title"),type:"energy-gas-graph",collection_key:"energy_dashboard"}),y&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_water_graph_title"),type:"energy-water-graph",collection_key:"energy_dashboard"}),r&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_distribution_title"),type:"energy-distribution",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),(r||a||l||y)&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_sources_table_title"),type:"energy-sources-table",collection_key:"energy_dashboard"}),s&&n.cards.push({type:"energy-grid-neutrality-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),a&&s&&(n.cards.push({type:"energy-solar-consumed-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),n.cards.push({type:"energy-self-sufficiency-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"})),r&&n.cards.push({type:"energy-carbon-consumed-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),o.device_consumption.length&&(n.cards.push({title:t.localize("ui.panel.energy.cards.energy_devices_detail_graph_title"),type:"energy-devices-detail-graph",collection_key:"energy_dashboard"}),n.cards.push({title:t.localize("ui.panel.energy.cards.energy_devices_graph_title"),type:"energy-devices-graph",collection_key:"energy_dashboard"})),n}}]}}),s.mN);o()}catch(e){o(e)}}))},92840:(e,t,n)=>{n.a(e,(async(e,t)=>{try{n(21950),n(71936),n(55888),n(8339);var o=n(68079),r=n(11703),s=n(3444),a=n(67558),i=n(86935),l=n(39083),c=n(50644),y=n(29051),g=n(73938),_=n(88514);const e=async()=>{const e=(0,g.wb)(),t=[];(0,s.Z)()&&await Promise.all([n.e(92997),n.e(63964)]).then(n.bind(n,63964)),(0,i.Z)()&&await Promise.all([n.e(63789),n.e(92997),n.e(63833)]).then(n.bind(n,63833)),(0,o.Z)(e)&&t.push(Promise.all([n.e(63789),n.e(15105)]).then(n.bind(n,15105)).then((()=>(0,_.T)()))),(0,r.Z6)(e)&&t.push(Promise.all([n.e(63789),n.e(62713)]).then(n.bind(n,62713))),(0,a.Z)(e)&&t.push(Promise.all([n.e(63789),n.e(53506)]).then(n.bind(n,53506))),(0,l.Z)(e)&&t.push(Promise.all([n.e(63789),n.e(49693)]).then(n.bind(n,49693))),(0,c.Z)(e)&&t.push(Promise.all([n.e(63789),n.e(29596)]).then(n.bind(n,29596)).then((()=>n.e(5224).then(n.t.bind(n,5224,23))))),(0,y.Z)(e)&&t.push(Promise.all([n.e(63789),n.e(30317)]).then(n.bind(n,30317))),0!==t.length&&await Promise.all(t).then((()=>(0,_.K)(e)))};await e(),t()}catch(e){t(e)}}),1)}};
//# sourceMappingURL=85685.8KAgGPhcV-c.js.map