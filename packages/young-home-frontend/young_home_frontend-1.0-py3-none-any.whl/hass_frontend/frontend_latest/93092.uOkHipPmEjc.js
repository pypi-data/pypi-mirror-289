export const id=93092;export const ids=[93092];export const modules={89936:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.d(e,{J:()=>m,computeStateDisplay:()=>f});i(53501);var n=i(83378),o=i(25786),r=i(31798),a=i(77396),c=i(64854),u=i(60441),l=i(56601),d=i(94646),h=i(47038),_=t([a,c,u,l]);[a,c,u,l]=_.then?(await _)():_;const f=(t,e,i,s,n,o,r)=>{const a=null==o?void 0:o[e.entity_id];return m(t,i,s,n,a,e.entity_id,e.attributes,void 0!==r?r:e.state)},m=(t,e,i,s,_,f,m,y)=>{if(y===n.HV||y===n.Hh)return t(`state.default.${y}`);const g=(0,h.m)(f);if((0,l.ty)(m,"sensor"===g?i:[])){if("duration"===m.device_class&&m.unit_of_measurement&&r.Z[m.unit_of_measurement]&&void 0===(null==_?void 0:_.display_precision))try{return(0,r.a)(y,m.unit_of_measurement)}catch(t){}if("monetary"===m.device_class)try{return(0,l.ZV)(y,e,{style:"currency",currency:m.unit_of_measurement,minimumFractionDigits:2,...(0,l.ZQ)({state:y,attributes:m},_)})}catch(t){}const t=(0,l.ZV)(y,e,(0,l.ZQ)({state:y,attributes:m},_)),i=m.unit_of_measurement;return i?`${t}${(0,d.A)(i,e)}${i}`:t}if("datetime"===g){const t=new Date(y);return(0,c.r6)(t,e,s)}if(["date","input_datetime","time"].includes(g))try{const t=y.split(" ");if(2===t.length)return(0,c.r6)(new Date(t.join("T")),{...e,time_zone:o.Wj.local},s);if(1===t.length){if(y.includes("-"))return(0,a.Yq)(new Date(`${y}T00:00`),{...e,time_zone:o.Wj.local},s);if(y.includes(":")){const t=new Date;return(0,u.fU)(new Date(`${t.toISOString().split("T")[0]}T${y}`),{...e,time_zone:o.Wj.local},s)}}return y}catch(t){return y}if("counter"===g||"number"===g||"input_number"===g)return(0,l.ZV)(y,e,(0,l.ZQ)({state:y,attributes:m},_));if(["button","conversation","event","image","input_button","notify","scene","stt","tag","tts","wake_word"].includes(g)||"sensor"===g&&"timestamp"===m.device_class)try{return(0,c.r6)(new Date(y),e,s)}catch(t){return y}return(null==_?void 0:_.translation_key)&&t(`component.${_.platform}.entity.${g}.${_.translation_key}.state.${y}`)||m.device_class&&t(`component.${g}.entity_component.${m.device_class}.state.${y}`)||t(`component.${g}.entity_component._.state.${y}`)||y};s()}catch(t){s(t)}}))},11753:(t,e,i)=>{i.d(e,{A:()=>n});i(27934),i(26777),i(73842);const s=t=>{const e=parseFloat(t);if(isNaN(e))throw new Error(`${t} is not a number`);return e};function n(t){if(!t)return null;try{if(t.endsWith("%"))return{w:100,h:s(t.substr(0,t.length-1))};const e=t.replace(":","x").split("x");return 0===e.length?null:1===e.length?{w:s(e[0]),h:1}:{w:s(e[0]),h:s(e[1])}}catch(t){}return null}},62665:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.d(e,{IQ:()=>f,Jo:()=>h,Mm:()=>H,qc:()=>E});i(53501),i(21950),i(71936),i(14460),i(62859),i(66274),i(85038),i(85767),i(84531),i(98168),i(22836),i(15445),i(24483),i(13478),i(46355),i(14612),i(53691),i(48455),i(8339);var n=i(47038),o=i(89936),r=i(82931),a=t([o]);o=(a.then?(await a)():a)[0];const c=["climate","humidifier","water_heater"],u=["climate","humidifier","input_datetime","thermostat","water_heater","person","device_tracker"],l=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode","action","current_humidity"],d=(t,e)=>!t.states[e]||u.includes((0,n.m)(e)),h=(t,e,i,s,n)=>{const o={type:"history/stream",entity_ids:n,start_time:i.toISOString(),end_time:s.toISOString(),minimal_response:!0,no_attributes:!n.some((e=>d(t,e)))},r=new _(t);return t.connection.subscribeMessage((t=>e(r.processMessage(t))),o)};class _{constructor(t,e){this.hass=void 0,this.hoursToShow=void 0,this.combinedHistory=void 0,this.hass=t,this.hoursToShow=e,this.combinedHistory={}}processMessage(t){if(!this.combinedHistory||!Object.keys(this.combinedHistory).length)return this.combinedHistory=t.states,this.combinedHistory;if(!Object.keys(t.states).length)return this.combinedHistory;const e=this.hoursToShow?((new Date).getTime()-3600*this.hoursToShow*1e3)/1e3:void 0,i={};for(const t of Object.keys(this.combinedHistory))i[t]=[];for(const e of Object.keys(t.states))i[e]=[];for(const s of Object.keys(i)){if(s in this.combinedHistory&&s in t.states){const e=this.combinedHistory[s],n=e[e.length-1];i[s]=e.concat(t.states[s]),t.states[s][0].lu<n.lu&&(i[s]=i[s].sort(((t,e)=>t.lu-e.lu)))}else s in this.combinedHistory?i[s]=this.combinedHistory[s]:i[s]=t.states[s];if(e&&s in this.combinedHistory){const t=i[s].filter((t=>t.lu<e));if(!t.length)continue;if(i[s]=i[s].filter((t=>t.lu>=e)),i[s].length&&i[s][0].lu===e)continue;const n=t[t.length-1];n.lu=e,i[s].unshift(n)}}return this.combinedHistory=i,this.combinedHistory}}const f=(t,e,i,s,n=!0,o=!0,r)=>{const a={type:"history/stream",entity_ids:s,start_time:new Date((new Date).getTime()-3600*i*1e3).toISOString(),minimal_response:n,significant_changes_only:o,no_attributes:null!=r?r:!s.some((e=>d(t,e)))},c=new _(t,i);return t.connection.subscribeMessage((t=>e(c.processMessage(t))),a)},m=(t,e)=>t.state===e.state&&(!t.attributes||!e.attributes||l.every((i=>t.attributes[i]===e.attributes[i]))),y=(t,e,i,s,n,a,c)=>{const u=[],l=a[0];for(const r of a){if(u.length>0&&r.s===u[u.length-1].state)continue;const a={};null!=c&&c.attributes.device_class&&(a.device_class=null==c?void 0:c.attributes.device_class),u.push({state_localize:(0,o.J)(t,e,[],i,s[n],n,{...r.a||l.a,...a},r.s),state:r.s,last_changed:1e3*(r.lc?r.lc:r.lu)})}return{name:(0,r._)(n,(null==c?void 0:c.attributes)||l.a),entity_id:n,data:u}},g=(t,e,i,s)=>{const o=[];return Object.keys(i).forEach((t=>{const e=i[t],a=e[0],u=(0,n.m)(t),d=[];for(const t of e){let e;if(c.includes(u)){e={state:t.s,last_changed:1e3*t.lu,attributes:{}};for(const i of l)i in t.a&&(e.attributes[i]=t.a[i])}else e={state:t.s,last_changed:1e3*(t.lc?t.lc:t.lu),attributes:{}};d.length>1&&m(e,d[d.length-1])&&m(e,d[d.length-2])||d.push(e)}const h=t in s?s[t].attributes:"friendly_name"in a.a?a.a:void 0;o.push({domain:u,name:(0,r._)(t,h||{}),entity_id:t,states:d})})),{unit:t,device_class:e,identifier:Object.keys(i).join(""),data:o}},v=["counter","input_number","number"],b=t=>v.includes(t),p=t=>"unit_of_measurement"in t||"state_class"in t,k=(t,e)=>null!=t.attributes.device_class&&e.includes(t.attributes.device_class),w=" ",H=(t,e,i,s,o,r=!1,a=!1)=>{const c={},u=[],l={};if(new Set([...i,...Object.keys(e)]).forEach((i=>{i in e?l[i]=e[i]:t.states[i]&&(l[i]=[{s:t.states[i].state,a:t.states[i].attributes,lu:new Date(t.states[i].last_updated).getTime()/1e3}])})),!l)return{line:[],timeline:[]};Object.keys(l).forEach((e=>{var i;const d=l[e];if(0===d.length)return;const h=(0,n.m)(e),_=e in t.states?t.states[e]:void 0,f=_||b(h)?void 0:d.find((t=>t.a&&p(t.a)));let m;m=a||b(h)||null!=_&&p(_.attributes)||null!=_&&"sensor"===h&&k(_,o)||null!=f?(null==_?void 0:_.attributes.unit_of_measurement)||(null==f?void 0:f.a.unit_of_measurement)||w:{zone:s("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,humidifier:"%",water_heater:t.config.unit_system.temperature}[h];const g={climate:"temperature",humidifier:"humidity",water_heater:"temperature"}[h]||(null===(i=(null==_?void 0:_.attributes)||(null==f?void 0:f.a))||void 0===i?void 0:i.device_class),v=E(m,g,r);m?v&&v in c&&e in c[v]?c[v][e].push(...d):v&&(v in c||(c[v]={}),c[v][e]=d):u.push(y(s,t.locale,t.config,t.entities,e,d,_))}));return{line:Object.keys(c).map((e=>{const i=e.split("_"),s=i[0],n=i[1]||void 0;return g(s,n,c[e],t.states)})),timeline:u}},E=(t,e,i)=>i?`${t}_${e||""}`:t;s()}catch(t){s(t)}}))},24900:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.r(e),i.d(e,{DEFAULT_HOURS_TO_SHOW:()=>H,DEFAULT_ZOOM:()=>E});var n=i(62659),o=i(76504),r=i(80792),a=(i(27934),i(53501),i(21950),i(71936),i(55888),i(66274),i(85767),i(98168),i(8339),i(40924)),c=i(18791),u=i(45081),l=i(76502),d=i(6699),h=i(47038),_=i(82931),f=i(61314),m=i(11753),y=(i(54373),i(12261),i(12731),i(76474)),g=i(62665),v=i(15821),b=i(3433),p=i(67990),k=t([y,g]);[y,g]=k.then?(await k)():k;const w="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M19,19H15V21H19A2,2 0 0,0 21,19V15H19M19,3H15V5H19V9H21V5A2,2 0 0,0 19,3M5,5H9V3H5A2,2 0 0,0 3,5V9H5M5,15H3V19A2,2 0 0,0 5,21H9V19H5V15Z",H=0,E=14;(0,n.A)([(0,c.EM)("hui-map-card")],(function(t,e){class s extends e{constructor(...e){super(...e),t(this)}}return{F:s,d:[{kind:"field",decorators:[(0,c.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,c.MZ)({type:Boolean,reflect:!0})],key:"isPanel",value:()=>!1},{kind:"field",decorators:[(0,c.wk)()],key:"_stateHistory",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,c.P)("ha-map")],key:"_map",value:void 0},{kind:"field",key:"_configEntities",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_mapEntities",value:()=>[]},{kind:"field",key:"_colorDict",value:()=>({})},{kind:"field",key:"_colorIndex",value:()=>0},{kind:"field",decorators:[(0,c.wk)()],key:"_error",value:void 0},{kind:"field",key:"_subscribed",value:void 0},{kind:"method",key:"setConfig",value:function(t){var e;if(!t)throw new Error("Error in card configuration.");if(!(null!==(e=t.entities)&&void 0!==e&&e.length||t.geo_location_sources))throw new Error("Either entities or geo_location_sources must be specified");if(t.entities&&!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(t.geo_location_sources&&!Array.isArray(t.geo_location_sources))throw new Error("Parameter geo_location_sources needs to be an array");this._config=t,this._configEntities=t.entities?(0,p.L)(t.entities):[],this._mapEntities=this._getMapEntities()}},{kind:"method",key:"getCardSize",value:function(){var t;if(null===(t=this._config)||void 0===t||!t.aspect_ratio)return 7;const e=(0,m.A)(this._config.aspect_ratio),i=e&&e.w>0&&e.h>0?`${(100*e.h/e.w).toFixed(2)}`:"100";return 1+Math.floor(Number(i)/25)||3}},{kind:"method",static:!0,key:"getConfigElement",value:async function(){return await Promise.all([i.e(27311),i.e(88201),i.e(36768),i.e(23006),i.e(38696),i.e(32839),i.e(29513),i.e(83579)]).then(i.bind(i,83579)),document.createElement("hui-map-card-editor")}},{kind:"method",static:!0,key:"getStubConfig",value:function(t,e,i){return{type:"map",entities:(0,b.B)(t,2,e,i,["device_tracker"]),theme_mode:"auto"}}},{kind:"method",key:"render",value:function(){var t;if(!this._config)return a.s6;if(this._error)return a.qy`<ha-alert alert-type="error"> ${this.hass.localize("ui.components.map.error")}: ${this._error.message} (${this._error.code}) </ha-alert>`;const e=!(!this._config.dark_mode&&"dark"!==this._config.theme_mode)||"light"!==this._config.theme_mode&&this.hass.themes.darkMode,i=this._config.theme_mode||(this._config.dark_mode?"dark":"auto");return a.qy` <ha-card id="card" .header="${this._config.title}"> <div id="root"> <ha-map .hass="${this.hass}" .entities="${this._mapEntities}" .zoom="${null!==(t=this._config.default_zoom)&&void 0!==t?t:E}" .paths="${this._getHistoryPaths(this._config,this._stateHistory)}" .autoFit="${this._config.auto_fit||!1}" .fitZones="${this._config.fit_zones}" .themeMode="${i}" interactiveZones renderPassive></ha-map> <ha-icon-button .label="${this.hass.localize("ui.panel.lovelace.cards.map.reset_focus")}" .path="${w}" style="${e?"color:#ffffff":"color:#000000"}" @click="${this._fitMap}" tabindex="0"></ha-icon-button> </div> </ha-card> `}},{kind:"method",key:"shouldUpdate",value:function(t){var e,i;if(!t.has("hass")||t.size>1)return!0;const s=t.get("hass");return!s||!this._configEntities||(s.themes.darkMode!==this.hass.themes.darkMode||(!!t.has("_stateHistory")||(!(null===(e=this._config)||void 0===e||!e.geo_location_sources||s.states===this.hass.states)||(null!==(i=this._config)&&void 0!==i&&i.entities?(0,v.pY)(this,t):(0,v.xP)(this,t)))))}},{kind:"method",key:"willUpdate",value:function(t){var e,i;(0,o.A)((0,r.A)(s.prototype),"willUpdate",this).call(this,t),t.has("hass")&&null!==(e=this._config)&&void 0!==e&&e.geo_location_sources&&!(0,f.b)(this._getSourceEntities(null===(i=t.get("hass"))||void 0===i?void 0:i.states),this._getSourceEntities(this.hass.states))&&(this._mapEntities=this._getMapEntities())}},{kind:"method",key:"connectedCallback",value:function(){var t;(0,o.A)((0,r.A)(s.prototype),"connectedCallback",this).call(this),this.hasUpdated&&null!==(t=this._configEntities)&&void 0!==t&&t.length&&this._subscribeHistory()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,o.A)((0,r.A)(s.prototype),"disconnectedCallback",this).call(this),this._unsubscribeHistory()}},{kind:"method",key:"_subscribeHistory",value:function(){var t,e,i;(0,d.x)(this.hass,"history")&&!this._subscribed&&(null!==(t=null===(e=this._config)||void 0===e?void 0:e.hours_to_show)&&void 0!==t?t:H)&&(this._subscribed=(0,g.IQ)(this.hass,(t=>{this._subscribed&&(this._stateHistory=t)}),null!==(i=this._config.hours_to_show)&&void 0!==i?i:H,(this._configEntities||[]).map((t=>t.entity)),!1,!1,!1).catch((t=>{this._subscribed=void 0,this._error=t})))}},{kind:"method",key:"_unsubscribeHistory",value:function(){this._subscribed&&(this._subscribed.then((t=>null==t?void 0:t())),this._subscribed=void 0)}},{kind:"method",key:"updated",value:function(t){var e;null!==(e=this._configEntities)&&void 0!==e&&e.length?this._subscribed&&!t.has("_config")||(this._unsubscribeHistory(),this._subscribeHistory()):this._unsubscribeHistory(),t.has("_config")&&this._computePadding()}},{kind:"method",key:"_computePadding",value:function(){const t=this.shadowRoot.getElementById("root");if(!this._config||this.isPanel||!t)return;if(!this._config.aspect_ratio)return void(t.style.paddingBottom="100%");t.style.height="auto";const e=(0,m.A)(this._config.aspect_ratio);t.style.paddingBottom=e&&e.w>0&&e.h>0?`${(100*e.h/e.w).toFixed(2)}%`:t.style.paddingBottom="100%"}},{kind:"method",key:"_fitMap",value:function(){var t;null===(t=this._map)||void 0===t||t.fitMap()}},{kind:"method",key:"_getColor",value:function(t){let e=this._colorDict[t];return e||(e=(0,l.Vy)(this._colorIndex),this._colorIndex++,this._colorDict[t]=e,e)}},{kind:"method",key:"_getSourceEntities",value:function(t){var e;if(!t||null===(e=this._config)||void 0===e||!e.geo_location_sources)return[];const i=[],s=this._config.geo_location_sources.includes("all");for(const e of Object.values(t))"geo_location"===(0,h.m)(e.entity_id)&&(s||this._config.geo_location_sources.includes(e.attributes.source))&&i.push(e.entity_id);return i}},{kind:"method",key:"_getMapEntities",value:function(){var t;return[...(this._configEntities||[]).map((t=>({entity_id:t.entity,color:this._getColor(t.entity),label_mode:t.label_mode,focus:t.focus,name:t.name}))),...this._getSourceEntities(null===(t=this.hass)||void 0===t?void 0:t.states).map((t=>({entity_id:t,color:this._getColor(t)})))]}},{kind:"field",key:"_getHistoryPaths",value(){return(0,u.A)(((t,e)=>{var i;if(!e||!(null!==(i=t.hours_to_show)&&void 0!==i?i:H))return;const s=[];for(const i of Object.keys(e)){var n,o,r;if("zone"===(0,h.m)(i))continue;const a=e[i];if(null==a||!a.length)continue;const c=[];for(const t of a){const e=t.a.latitude,i=t.a.longitude;if(!e||!i)continue;const s={};s.point=[e,i],s.timestamp=new Date(1e3*t.lu),c.push(s)}const u=null===(n=this._configEntities)||void 0===n?void 0:n.find((t=>t.entity===i)),l=null!==(o=null==u?void 0:u.name)&&void 0!==o?o:i in this.hass.states?(0,_.u)(this.hass.states[i]):i;s.push({points:c,name:l,fullDatetime:(null!==(r=t.hours_to_show)&&void 0!==r?r:H)>144,color:this._getColor(i),gradualOpacity:.8})}return s}))}},{kind:"get",static:!0,key:"styles",value:function(){return a.AH`ha-card{overflow:hidden;width:100%;height:100%;display:flex;flex-direction:column}ha-map{z-index:0;border:none;position:absolute;top:0;left:0;width:100%;height:100%;background:inherit}ha-icon-button{position:absolute;top:75px;left:3px;outline:0}#root{position:relative;height:100%}`}}]}}),a.WF);s()}catch(t){s(t)}}))},86174:(t,e,i)=>{function s(t,e){return t instanceof Date?new t.constructor(e):new Date(e)}i.d(e,{w:()=>s})},51561:(t,e,i)=>{i.d(e,{r:()=>n});var s=i(93352);function n(t,e){return+(0,s.o)(t)==+(0,s.o)(e)}},79581:(t,e,i)=>{i.d(e,{c:()=>r});var s=i(86174);function n(t){return(0,s.w)(t,Date.now())}var o=i(51561);function r(t){return(0,o.r)(t,n(t))}}};
//# sourceMappingURL=93092.uOkHipPmEjc.js.map