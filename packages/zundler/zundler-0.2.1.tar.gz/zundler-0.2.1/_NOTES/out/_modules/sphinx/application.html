<!DOCTYPE html>
<html lang="en">
<head><script>/*
 * Monkeypatch URLSearchParams
 *
 * Sphinx documents that use `searchtool.js` rely on passing information via
 * GET parameters (aka search parameters). Unfortunately, this doesn't work
 * in our approach due to the same origin policy, so we have to get ...
 * creative.
 *
 * Here, we patch the `URLSearchParams` class so it returns the information
 * stored in `window.global_context.get_parameters`.
 *
 */

const originalGet = URLSearchParams.prototype.get;

var myGet = function (arg) {
    const originalResult = originalGet.apply(this, [arg]);
    // If searchtools.js of sphinx is used
    if (
        window.global_context.get_parameters &&
        (window.location.search === "") &&
        (Array.from(this.entries()).length == 0)
    ) {
        const params = new URLSearchParams('?' + window.global_context.get_parameters);
        const result = params.get(arg);
        // console.log("Return virtual get parameter:", arg, result);
        return result;
    } else {
        return originalResult;
    }
};

URLSearchParams.prototype.get = myGet;

/*
 * Monkeypatch fetch
 */

const { fetch: originalFetch } = window;

window.fetch = async (...args) => {
    let [resource, config ] = args;
    var path = normalize_path(resource);
    var response;
    if (is_virtual(path)) {
        var data = retrieve_file(path);
        response = new Response(data);

    } else {
        response = await originalFetch(resource, config);
    }
    return response;
};
//# sourceURL=inject_pre.js</script>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>sphinx.application — Sphinx documentation</title>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/basic.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/graphviz.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/sphinx13.css" rel="stylesheet" type="text/css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.13.1/underscore-min.js"></script>
<script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
<script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
<script src="../../_static/jquery.js"></script>
<script src="../../_static/underscore.js"></script>
<script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
<script src="../../_static/doctools.js"></script>
<script src="../../_static/sphinx_highlight.js"></script>
<link href="https://www.sphinx-doc.org/en/master/_modules/sphinx/application.html" rel="canonical"/>
<link href="../../_static/opensearch.xml" rel="search" title="Search within Sphinx documentation" type="application/opensearchdescription+xml"/>
<link href="../../_static/favicon.svg" rel="shortcut icon"/>
<link href="../../genindex.html" rel="index" title="Index"/>
<link href="../../search.html" rel="search" title="Search"/>
</head><body>
<div class="pageheader">
<a href="../../index.html">
<img alt="SPHINX" src="../../_static/sphinxheader.png"/>
</a>
</div>
<div aria-label="related navigation" class="related" role="navigation">
<h3>Navigation</h3>
<ul>
<li><a href="../../index.html">Documentation</a> »</li>
<li class="nav-item nav-item-1"><a accesskey="U" href="../index.html">Module code</a> »</li>
<li class="nav-item nav-item-this"><a href="">sphinx.application</a></li>
</ul>
</div>
<div class="document">
<div aria-label="main navigation" class="sphinxsidebar" role="navigation">
<div id="searchbox" role="search" style="display: none">
<h3 id="searchlabel">Quick search</h3>
<div class="searchformwrapper">
<form action="../../search.html" class="search" method="get">
<input aria-labelledby="searchlabel" autocapitalize="off" autocomplete="off" autocorrect="off" name="q" spellcheck="false" type="text"/>
<input type="submit" value="Go"/>
</form>
</div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
<div class="sphinxsidebar-navigation__contents">
<h3>On this page</h3>
</div>
<div class="sphinxsidebar-navigation__pages">
<h3>Site navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Get started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/quickstart.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/installation.html">Installing Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorial: Build your first project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/index.html">Using Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Extending Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templating.html">Templating</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../latex.html">LaTeX customization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extdev/index.html">Developing extensions for Sphinx</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Get support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internals/index.html">Contribute to Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Sphinx FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../man/index.html">Command-Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Projects using Sphinx</a></li>
</ul>
</div>
</div>
<div class="body" role="main">
<h1>Source code for sphinx.application</h1><div class="highlight"><pre>
<span></span><span class="sd">"""Sphinx application class and extensibility interface.</span>

<span class="sd">Gracefully adapted from the TextPress system by Armin.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">IO</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">docutils</span> <span class="kn">import</span> <span class="n">nodes</span>
<span class="kn">from</span> <span class="nn">docutils.nodes</span> <span class="kn">import</span> <span class="n">Element</span><span class="p">,</span> <span class="n">TextElement</span>
<span class="kn">from</span> <span class="nn">docutils.parsers</span> <span class="kn">import</span> <span class="n">Parser</span>
<span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="kn">import</span> <span class="n">Directive</span><span class="p">,</span> <span class="n">roles</span>
<span class="kn">from</span> <span class="nn">docutils.transforms</span> <span class="kn">import</span> <span class="n">Transform</span>
<span class="kn">from</span> <span class="nn">pygments.lexer</span> <span class="kn">import</span> <span class="n">Lexer</span>

<span class="kn">import</span> <span class="nn">sphinx</span>
<span class="kn">from</span> <span class="nn">sphinx</span> <span class="kn">import</span> <span class="n">locale</span><span class="p">,</span> <span class="n">package_dir</span>
<span class="kn">from</span> <span class="nn">sphinx.config</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">sphinx.deprecation</span> <span class="kn">import</span> <span class="n">RemovedInSphinx60Warning</span>
<span class="kn">from</span> <span class="nn">sphinx.domains</span> <span class="kn">import</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">Index</span>
<span class="kn">from</span> <span class="nn">sphinx.environment</span> <span class="kn">import</span> <span class="n">BuildEnvironment</span>
<span class="kn">from</span> <span class="nn">sphinx.environment.collectors</span> <span class="kn">import</span> <span class="n">EnvironmentCollector</span>
<span class="kn">from</span> <span class="nn">sphinx.errors</span> <span class="kn">import</span> <span class="n">ApplicationError</span><span class="p">,</span> <span class="n">ConfigError</span><span class="p">,</span> <span class="n">VersionRequirementError</span>
<span class="kn">from</span> <span class="nn">sphinx.events</span> <span class="kn">import</span> <span class="n">EventManager</span>
<span class="kn">from</span> <span class="nn">sphinx.extension</span> <span class="kn">import</span> <span class="n">Extension</span>
<span class="kn">from</span> <span class="nn">sphinx.highlighting</span> <span class="kn">import</span> <span class="n">lexer_classes</span>
<span class="kn">from</span> <span class="nn">sphinx.locale</span> <span class="kn">import</span> <span class="n">__</span>
<span class="kn">from</span> <span class="nn">sphinx.project</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">sphinx.registry</span> <span class="kn">import</span> <span class="n">SphinxComponentRegistry</span>
<span class="kn">from</span> <span class="nn">sphinx.roles</span> <span class="kn">import</span> <span class="n">XRefRole</span>
<span class="kn">from</span> <span class="nn">sphinx.theming</span> <span class="kn">import</span> <span class="n">Theme</span>
<span class="kn">from</span> <span class="nn">sphinx.util</span> <span class="kn">import</span> <span class="n">docutils</span><span class="p">,</span> <span class="n">logging</span><span class="p">,</span> <span class="n">progress_message</span>
<span class="kn">from</span> <span class="nn">sphinx.util.build_phase</span> <span class="kn">import</span> <span class="n">BuildPhase</span>
<span class="kn">from</span> <span class="nn">sphinx.util.console</span> <span class="kn">import</span> <span class="n">bold</span>  <span class="c1"># type: ignore</span>
<span class="kn">from</span> <span class="nn">sphinx.util.i18n</span> <span class="kn">import</span> <span class="n">CatalogRepository</span>
<span class="kn">from</span> <span class="nn">sphinx.util.logging</span> <span class="kn">import</span> <span class="n">prefixed_warnings</span>
<span class="kn">from</span> <span class="nn">sphinx.util.osutil</span> <span class="kn">import</span> <span class="n">abspath</span><span class="p">,</span> <span class="n">ensuredir</span><span class="p">,</span> <span class="n">relpath</span>
<span class="kn">from</span> <span class="nn">sphinx.util.tags</span> <span class="kn">import</span> <span class="n">Tags</span>
<span class="kn">from</span> <span class="nn">sphinx.util.typing</span> <span class="kn">import</span> <span class="n">RoleFunction</span><span class="p">,</span> <span class="n">TitleGetter</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">docutils.nodes</span> <span class="kn">import</span> <span class="n">Node</span>  <span class="c1"># NOQA</span>

    <span class="kn">from</span> <span class="nn">sphinx.builders</span> <span class="kn">import</span> <span class="n">Builder</span>


<span class="n">builtin_extensions</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">'sphinx.addnodes'</span><span class="p">,</span>
    <span class="s1">'sphinx.builders.changes'</span><span class="p">,</span>
    <span class="s1">'sphinx.builders.epub3'</span><span class="p">,</span>
    <span class="s1">'sphinx.builders.dirhtml'</span><span class="p">,</span>
    <span class="s1">'sphinx.builders.dummy'</span><span class="p">,</span>
    <span class="s1">'sphinx.builders.gettext'</span><span class="p">,</span>
    <span class="s1">'sphinx.builders.html'</span><span class="p">,</span>
    <span class="s1">'sphinx.builders.latex'</span><span class="p">,</span>
    <span class="s1">'sphinx.builders.linkcheck'</span><span class="p">,</span>
    <span class="s1">'sphinx.builders.manpage'</span><span class="p">,</span>
    <span class="s1">'sphinx.builders.singlehtml'</span><span class="p">,</span>
    <span class="s1">'sphinx.builders.texinfo'</span><span class="p">,</span>
    <span class="s1">'sphinx.builders.text'</span><span class="p">,</span>
    <span class="s1">'sphinx.builders.xml'</span><span class="p">,</span>
    <span class="s1">'sphinx.config'</span><span class="p">,</span>
    <span class="s1">'sphinx.domains.c'</span><span class="p">,</span>
    <span class="s1">'sphinx.domains.changeset'</span><span class="p">,</span>
    <span class="s1">'sphinx.domains.citation'</span><span class="p">,</span>
    <span class="s1">'sphinx.domains.cpp'</span><span class="p">,</span>
    <span class="s1">'sphinx.domains.index'</span><span class="p">,</span>
    <span class="s1">'sphinx.domains.javascript'</span><span class="p">,</span>
    <span class="s1">'sphinx.domains.math'</span><span class="p">,</span>
    <span class="s1">'sphinx.domains.python'</span><span class="p">,</span>
    <span class="s1">'sphinx.domains.rst'</span><span class="p">,</span>
    <span class="s1">'sphinx.domains.std'</span><span class="p">,</span>
    <span class="s1">'sphinx.directives'</span><span class="p">,</span>
    <span class="s1">'sphinx.directives.code'</span><span class="p">,</span>
    <span class="s1">'sphinx.directives.other'</span><span class="p">,</span>
    <span class="s1">'sphinx.directives.patches'</span><span class="p">,</span>
    <span class="s1">'sphinx.extension'</span><span class="p">,</span>
    <span class="s1">'sphinx.parsers'</span><span class="p">,</span>
    <span class="s1">'sphinx.registry'</span><span class="p">,</span>
    <span class="s1">'sphinx.roles'</span><span class="p">,</span>
    <span class="s1">'sphinx.transforms'</span><span class="p">,</span>
    <span class="s1">'sphinx.transforms.compact_bullet_list'</span><span class="p">,</span>
    <span class="s1">'sphinx.transforms.i18n'</span><span class="p">,</span>
    <span class="s1">'sphinx.transforms.references'</span><span class="p">,</span>
    <span class="s1">'sphinx.transforms.post_transforms'</span><span class="p">,</span>
    <span class="s1">'sphinx.transforms.post_transforms.code'</span><span class="p">,</span>
    <span class="s1">'sphinx.transforms.post_transforms.images'</span><span class="p">,</span>
    <span class="s1">'sphinx.util.compat'</span><span class="p">,</span>
    <span class="s1">'sphinx.versioning'</span><span class="p">,</span>
    <span class="c1"># collectors should be loaded by specific order</span>
    <span class="s1">'sphinx.environment.collectors.dependencies'</span><span class="p">,</span>
    <span class="s1">'sphinx.environment.collectors.asset'</span><span class="p">,</span>
    <span class="s1">'sphinx.environment.collectors.metadata'</span><span class="p">,</span>
    <span class="s1">'sphinx.environment.collectors.title'</span><span class="p">,</span>
    <span class="s1">'sphinx.environment.collectors.toctree'</span><span class="p">,</span>
    <span class="c1"># 1st party extensions</span>
    <span class="s1">'sphinxcontrib.applehelp'</span><span class="p">,</span>
    <span class="s1">'sphinxcontrib.devhelp'</span><span class="p">,</span>
    <span class="s1">'sphinxcontrib.htmlhelp'</span><span class="p">,</span>
    <span class="s1">'sphinxcontrib.serializinghtml'</span><span class="p">,</span>
    <span class="s1">'sphinxcontrib.qthelp'</span><span class="p">,</span>
    <span class="c1"># Strictly, alabaster theme is not a builtin extension,</span>
    <span class="c1"># but it is loaded automatically to use it as default theme.</span>
    <span class="s1">'alabaster'</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ENV_PICKLE_FILENAME</span> <span class="o">=</span> <span class="s1">'environment.pickle'</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="Sphinx"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx">[docs]</a><span class="k">class</span> <span class="nc">Sphinx</span><span class="p">:</span>
    <span class="sd">"""The main application class and extensibility interface.</span>

<span class="sd">    :ivar srcdir: Directory containing source.</span>
<span class="sd">    :ivar confdir: Directory containing ``conf.py``.</span>
<span class="sd">    :ivar doctreedir: Directory for storing pickled doctrees.</span>
<span class="sd">    :ivar outdir: Directory for storing build documents.</span>
<span class="sd">    """</span>

    <span class="n">warningiserror</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">_warncount</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srcdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">confdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">outdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">doctreedir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">buildername</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">confoverrides</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IO</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">warning</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IO</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
                 <span class="n">freshenv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">warningiserror</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">verbosity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">parallel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">keep_going</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">pdb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">BuildPhase</span><span class="o">.</span><span class="n">INITIALIZATION</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extensions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Extension</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span> <span class="o">=</span> <span class="n">SphinxComponentRegistry</span><span class="p">()</span>

        <span class="c1"># validate provided directories</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">srcdir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doctreedir</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">doctreedir</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ApplicationError</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'Cannot find source directory (</span><span class="si">%s</span><span class="s1">)'</span><span class="p">)</span> <span class="o">%</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ApplicationError</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'Output directory (</span><span class="si">%s</span><span class="s1">) is not a directory'</span><span class="p">)</span> <span class="o">%</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ApplicationError</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'Source directory and destination '</span>
                                      <span class="s1">'directory cannot be identical'</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parallel</span> <span class="o">=</span> <span class="n">parallel</span>

        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">:</span> <span class="n">IO</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">status</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quiet</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">warning</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">:</span> <span class="n">IO</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span> <span class="o">=</span> <span class="n">warning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warncount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_going</span> <span class="o">=</span> <span class="n">warningiserror</span> <span class="ow">and</span> <span class="n">keep_going</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_going</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warningiserror</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warningiserror</span> <span class="o">=</span> <span class="n">warningiserror</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span> <span class="o">=</span> <span class="n">pdb</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warning</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">EventManager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># keep last few messages for traceback</span>
        <span class="c1"># This will be filled by sphinx.util.logging.LastMessagesWriter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messagelog</span><span class="p">:</span> <span class="n">deque</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># say hello to the world</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'Running Sphinx v</span><span class="si">%s</span><span class="s1">'</span><span class="p">)</span> <span class="o">%</span> <span class="n">sphinx</span><span class="o">.</span><span class="n">__display_version__</span><span class="p">))</span>

        <span class="c1"># status code for command-line application</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statuscode</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># read config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="n">Tags</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">confdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># set confdir to srcdir if -C given (!= no confdir); a few pieces</span>
            <span class="c1"># of code expect a confdir to be set</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">confdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">({},</span> <span class="n">confoverrides</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">confdir</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">confdir</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">confdir</span><span class="p">,</span> <span class="n">confoverrides</span> <span class="ow">or</span> <span class="p">{},</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>

        <span class="c1"># initialize some limited config variables before initialize i18n and loading</span>
        <span class="c1"># extensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pre_init_values</span><span class="p">()</span>

        <span class="c1"># set up translation infrastructure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_i18n</span><span class="p">()</span>

        <span class="c1"># check the Sphinx version if requested</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">needs_sphinx</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">needs_sphinx</span> <span class="o">&gt;</span> <span class="n">sphinx</span><span class="o">.</span><span class="n">__display_version__</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VersionRequirementError</span><span class="p">(</span>
                <span class="n">__</span><span class="p">(</span><span class="s1">'This project needs at least Sphinx v</span><span class="si">%s</span><span class="s1"> and therefore cannot '</span>
                   <span class="s1">'be built with this version.'</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">needs_sphinx</span><span class="p">)</span>

        <span class="c1"># load all built-in extension modules</span>
        <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">builtin_extensions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_extension</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>

        <span class="c1"># load all user-given extension modules</span>
        <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">extensions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_extension</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>

        <span class="c1"># preload builder module (before init config values)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preload_builder</span><span class="p">(</span><span class="n">buildername</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">progress_message</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'making output directory'</span><span class="p">)):</span>
                <span class="n">ensuredir</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>

        <span class="c1"># the config file itself can be an extension</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setup</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">__</span><span class="p">(</span><span class="s1">'while setting up extension </span><span class="si">%s</span><span class="s1">:'</span><span class="p">)</span> <span class="o">%</span> <span class="s2">"conf.py"</span>
            <span class="k">with</span> <span class="n">prefixed_warnings</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setup</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ConfigError</span><span class="p">(</span>
                        <span class="n">__</span><span class="p">(</span><span class="s2">"'setup' as currently defined in conf.py isn't a Python callable. "</span>
                           <span class="s2">"Please modify its definition to make it a callable function. "</span>
                           <span class="s2">"This is needed for conf.py to behave as a Sphinx extension."</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="c1"># now that we know all config values, collect them from conf.py</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">init_values</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">'config-inited'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

        <span class="c1"># create the project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">source_suffix</span><span class="p">)</span>

        <span class="c1"># set up the build environment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_env</span><span class="p">(</span><span class="n">freshenv</span><span class="p">)</span>

        <span class="c1"># create the builder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">builder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_builder</span><span class="p">(</span><span class="n">buildername</span><span class="p">)</span>

        <span class="c1"># build environment post-initialisation, after creating the builder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post_init_env</span><span class="p">()</span>

        <span class="c1"># set up the builder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_builder</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_init_i18n</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Load translated strings from the configured localedirs if enabled in</span>
<span class="sd">        the configuration.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">language</span> <span class="o">==</span> <span class="s1">'en'</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="p">,</span> <span class="n">has_translation</span> <span class="o">=</span> <span class="n">locale</span><span class="o">.</span><span class="n">init</span><span class="p">([],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'loading translations [</span><span class="si">%s</span><span class="s1">]... '</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">language</span><span class="p">),</span>
                        <span class="n">nonl</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># compile mo files if sphinx.po file in user locale directories are updated</span>
            <span class="n">repo</span> <span class="o">=</span> <span class="n">CatalogRepository</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">locale_dirs</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">source_encoding</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">catalog</span> <span class="ow">in</span> <span class="n">repo</span><span class="o">.</span><span class="n">catalogs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">catalog</span><span class="o">.</span><span class="n">domain</span> <span class="o">==</span> <span class="s1">'sphinx'</span> <span class="ow">and</span> <span class="n">catalog</span><span class="o">.</span><span class="n">is_outdated</span><span class="p">():</span>
                    <span class="n">catalog</span><span class="o">.</span><span class="n">write_mo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gettext_allow_fuzzy_translations</span><span class="p">)</span>

            <span class="n">locale_dirs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">repo</span><span class="o">.</span><span class="n">locale_dirs</span><span class="p">)</span>
            <span class="n">locale_dirs</span> <span class="o">+=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">locale_dirs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">package_dir</span><span class="p">,</span> <span class="s1">'locale'</span><span class="p">)]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="p">,</span> <span class="n">has_translation</span> <span class="o">=</span> <span class="n">locale</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">locale_dirs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">has_translation</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'done'</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'not available for built-in messages'</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_init_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freshenv</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BuildEnvironment</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doctreedir</span><span class="p">,</span> <span class="n">ENV_PICKLE_FILENAME</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">freshenv</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_fresh_env</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_existing_env</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_fresh_env</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BuildEnvironment</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">BuildEnvironment</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fresh_env_used</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">env</span>

    <span class="k">def</span> <span class="nf">_load_existing_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BuildEnvironment</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">progress_message</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'loading pickled environment'</span><span class="p">)):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">env</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="n">env</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fresh_env_used</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'failed: </span><span class="si">%s</span><span class="s1">'</span><span class="p">),</span> <span class="n">err</span><span class="p">)</span>
            <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_fresh_env</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">env</span>

    <span class="k">def</span> <span class="nf">_post_init_env</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fresh_env_used</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">find_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fresh_env_used</span>

    <span class="k">def</span> <span class="nf">preload_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">preload_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Builder"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'No builder selected, using default: html'</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">'html'</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">create_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="p">,</span> <span class="s2">"env"</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">set_environment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">'builder-inited'</span><span class="p">)</span>

    <span class="c1"># ---- main "build" method -------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">filenames</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">BuildPhase</span><span class="o">.</span><span class="n">READING</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">force_all</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">build_all</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">build_specific</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">build_update</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">'build-finished'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="c1"># delete the saved env to force a fresh build next time</span>
            <span class="n">envfile</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doctreedir</span><span class="p">,</span> <span class="n">ENV_PICKLE_FILENAME</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">envfile</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">envfile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">'build-finished'</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warncount</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_going</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statuscode</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">status</span> <span class="o">=</span> <span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'succeeded'</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">statuscode</span> <span class="o">==</span> <span class="mi">0</span>
                  <span class="k">else</span> <span class="n">__</span><span class="p">(</span><span class="s1">'finished with problems'</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warncount</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warningiserror</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warncount</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">__</span><span class="p">(</span><span class="s1">'build </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1"> warning (with warnings treated as errors).'</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">__</span><span class="p">(</span><span class="s1">'build </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1"> warnings (with warnings treated as errors).'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warncount</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">__</span><span class="p">(</span><span class="s1">'build </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1"> warning.'</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">__</span><span class="p">(</span><span class="s1">'build </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1"> warnings.'</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warncount</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'build </span><span class="si">%s</span><span class="s1">.'</span><span class="p">)</span> <span class="o">%</span> <span class="n">status</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">statuscode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">epilog</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">epilog</span> <span class="o">%</span> <span class="p">{</span>
                <span class="s1">'outdir'</span><span class="p">:</span> <span class="n">relpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">),</span>
                <span class="s1">'project'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">project</span>
            <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>

    <span class="c1"># ---- general extensibility interface -------------------------------------</span>

<div class="viewcode-block" id="Sphinx.setup_extension"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.setup_extension">[docs]</a>    <span class="k">def</span> <span class="nf">setup_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Import and setup a Sphinx extension module.</span>

<span class="sd">        Load the extension given by the module *name*.  Use this if your</span>
<span class="sd">        extension needs the features provided by another extension.  No-op if</span>
<span class="sd">        called twice.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] setting up extension: </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="n">extname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extname</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.require_sphinx"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.require_sphinx">[docs]</a>    <span class="k">def</span> <span class="nf">require_sphinx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Check the Sphinx version if requested.</span>

<span class="sd">        Compare *version* with the version of the running Sphinx, and abort the</span>
<span class="sd">        build when it is too old.</span>

<span class="sd">        :param version: The required version in the form of ``major.minor``.</span>

<span class="sd">        .. versionadded:: 1.0</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">&gt;</span> <span class="n">sphinx</span><span class="o">.</span><span class="n">__display_version__</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">VersionRequirementError</span><span class="p">(</span><span class="n">version</span><span class="p">)</span></div>

    <span class="c1"># event interface</span>
<div class="viewcode-block" id="Sphinx.connect"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""Register *callback* to be called when *event* is emitted.</span>

<span class="sd">        For details on available core events and the arguments of callback</span>
<span class="sd">        functions, please see :ref:`events`.</span>

<span class="sd">        :param event: The name of target event</span>
<span class="sd">        :param callback: Callback function for the event</span>
<span class="sd">        :param priority: The priority of the callback.  The callbacks will be invoked</span>
<span class="sd">                         in order of *priority* (ascending).</span>
<span class="sd">        :return: A listener ID.  It can be used for :meth:`disconnect`.</span>

<span class="sd">        .. versionchanged:: 3.0</span>

<span class="sd">           Support *priority*</span>
<span class="sd">        """</span>
        <span class="n">listener_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">priority</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] connecting event </span><span class="si">%r</span><span class="s1"> (</span><span class="si">%d</span><span class="s1">): </span><span class="si">%r</span><span class="s1"> [id=</span><span class="si">%s</span><span class="s1">]'</span><span class="p">,</span>
                     <span class="n">event</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">listener_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">listener_id</span></div>

<div class="viewcode-block" id="Sphinx.disconnect"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listener_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Unregister callback by *listener_id*.</span>

<span class="sd">        :param listener_id: A listener_id that :meth:`connect` returns</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] disconnecting event: [id=</span><span class="si">%s</span><span class="s1">]'</span><span class="p">,</span> <span class="n">listener_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">listener_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.emit"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.emit">[docs]</a>    <span class="k">def</span> <span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
             <span class="n">allowed_exceptions</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">Exception</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
        <span class="sd">"""Emit *event* and pass *arguments* to the callback functions.</span>

<span class="sd">        Return the return values of all callbacks as a list.  Do not emit core</span>
<span class="sd">        Sphinx events in extensions!</span>

<span class="sd">        :param event: The name of event that will be emitted</span>
<span class="sd">        :param args: The arguments for the event</span>
<span class="sd">        :param allowed_exceptions: The list of exceptions that are allowed in the callbacks</span>

<span class="sd">        .. versionchanged:: 3.1</span>

<span class="sd">           Added *allowed_exceptions* to specify path-through exceptions</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">allowed_exceptions</span><span class="o">=</span><span class="n">allowed_exceptions</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.emit_firstresult"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.emit_firstresult">[docs]</a>    <span class="k">def</span> <span class="nf">emit_firstresult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
                         <span class="n">allowed_exceptions</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">Exception</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">"""Emit *event* and pass *arguments* to the callback functions.</span>

<span class="sd">        Return the result of the first callback that doesn't return ``None``.</span>

<span class="sd">        :param event: The name of event that will be emitted</span>
<span class="sd">        :param args: The arguments for the event</span>
<span class="sd">        :param allowed_exceptions: The list of exceptions that are allowed in the callbacks</span>

<span class="sd">        .. versionadded:: 0.5</span>
<span class="sd">        .. versionchanged:: 3.1</span>

<span class="sd">           Added *allowed_exceptions* to specify path-through exceptions</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">emit_firstresult</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                                            <span class="n">allowed_exceptions</span><span class="o">=</span><span class="n">allowed_exceptions</span><span class="p">)</span></div>

    <span class="c1"># registering addon parts</span>

<div class="viewcode-block" id="Sphinx.add_builder"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_builder">[docs]</a>    <span class="k">def</span> <span class="nf">add_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">builder</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">"Builder"</span><span class="p">],</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a new builder.</span>

<span class="sd">        :param builder: A builder class</span>
<span class="sd">        :param override: If true, install the builder forcedly even if another builder</span>
<span class="sd">                         is already installed as the same name</span>

<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Add *override* keyword.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_builder</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">)</span></div>

    <span class="c1"># TODO(stephenfin): Describe 'types' parameter</span>
<div class="viewcode-block" id="Sphinx.add_config_value"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_config_value">[docs]</a>    <span class="k">def</span> <span class="nf">add_config_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">rebuild</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                         <span class="n">types</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a configuration value.</span>

<span class="sd">        This is necessary for Sphinx to recognize new values and set default</span>
<span class="sd">        values accordingly.</span>


<span class="sd">        :param name: The name of the configuration value.  It is recommended to be prefixed</span>
<span class="sd">                     with the extension name (ex. ``html_logo``, ``epub_title``)</span>
<span class="sd">        :param default: The default value of the configuration.</span>
<span class="sd">        :param rebuild: The condition of rebuild.  It must be one of those values:</span>

<span class="sd">                        * ``'env'`` if a change in the setting only takes effect when a</span>
<span class="sd">                          document is parsed -- this means that the whole environment must be</span>
<span class="sd">                          rebuilt.</span>
<span class="sd">                        * ``'html'`` if a change in the setting needs a full rebuild of HTML</span>
<span class="sd">                          documents.</span>
<span class="sd">                        * ``''`` if a change in the setting will not need any special rebuild.</span>
<span class="sd">        :param types: The type of configuration value.  A list of types can be specified.  For</span>
<span class="sd">                      example, ``[str]`` is used to describe a configuration that takes string</span>
<span class="sd">                      value.</span>

<span class="sd">        .. versionchanged:: 0.4</span>
<span class="sd">           If the *default* value is a callable, it will be called with the</span>
<span class="sd">           config object as its argument in order to get the default value.</span>
<span class="sd">           This can be used to implement config values whose default depends on</span>
<span class="sd">           other values.</span>

<span class="sd">        .. versionchanged:: 0.6</span>
<span class="sd">           Changed *rebuild* from a simple boolean (equivalent to ``''`` or</span>
<span class="sd">           ``'env'``) to a string.  However, booleans are still accepted and</span>
<span class="sd">           converted internally.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] adding config value: </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">rebuild</span><span class="p">,</span> <span class="n">types</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">rebuild</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">rebuild</span> <span class="o">=</span> <span class="s1">'env'</span> <span class="k">if</span> <span class="n">rebuild</span> <span class="k">else</span> <span class="s1">''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">rebuild</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_event"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_event">[docs]</a>    <span class="k">def</span> <span class="nf">add_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register an event called *name*.</span>

<span class="sd">        This is needed to be able to emit it.</span>

<span class="sd">        :param name: The name of the event</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] adding event: </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.set_translator"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.set_translator">[docs]</a>    <span class="k">def</span> <span class="nf">set_translator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">translator_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">NodeVisitor</span><span class="p">],</span>
                       <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register or override a Docutils translator class.</span>

<span class="sd">        This is used to register a custom output translator or to replace a</span>
<span class="sd">        builtin translator.  This allows extensions to use a custom translator</span>
<span class="sd">        and define custom nodes for the translator (see :meth:`add_node`).</span>

<span class="sd">        :param name: The name of the builder for the translator</span>
<span class="sd">        :param translator_class: A translator class</span>
<span class="sd">        :param override: If true, install the translator forcedly even if another translator</span>
<span class="sd">                         is already installed as the same name</span>

<span class="sd">        .. versionadded:: 1.3</span>
<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Add *override* keyword.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_translator</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">translator_class</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_node"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_node">[docs]</a>    <span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Element</span><span class="p">],</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a Docutils node class.</span>

<span class="sd">        This is necessary for Docutils internals.  It may also be used in the</span>
<span class="sd">        future to validate nodes in the parsed documents.</span>

<span class="sd">        :param node: A node class</span>
<span class="sd">        :param kwargs: Visitor functions for each builder (see below)</span>
<span class="sd">        :param override: If true, install the node forcedly even if another node is already</span>
<span class="sd">                         installed as the same name</span>

<span class="sd">        Node visitor functions for the Sphinx HTML, LaTeX, text and manpage</span>
<span class="sd">        writers can be given as keyword arguments: the keyword should be one or</span>
<span class="sd">        more of ``'html'``, ``'latex'``, ``'text'``, ``'man'``, ``'texinfo'``</span>
<span class="sd">        or any other supported translators, the value a 2-tuple of ``(visit,</span>
<span class="sd">        depart)`` methods.  ``depart`` can be ``None`` if the ``visit``</span>
<span class="sd">        function raises :exc:`docutils.nodes.SkipNode`.  Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           class math(docutils.nodes.Element): pass</span>

<span class="sd">           def visit_math_html(self, node):</span>
<span class="sd">               self.body.append(self.starttag(node, 'math'))</span>
<span class="sd">           def depart_math_html(self, node):</span>
<span class="sd">               self.body.append('&lt;/math&gt;')</span>

<span class="sd">           app.add_node(math, html=(visit_math_html, depart_math_html))</span>

<span class="sd">        Obviously, translators for which you don't specify visitor methods will</span>
<span class="sd">        choke on the node when encountered in a document to translate.</span>

<span class="sd">        .. versionchanged:: 0.5</span>
<span class="sd">           Added the support for keyword arguments giving visit functions.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] adding node: </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">override</span> <span class="ow">and</span> <span class="n">docutils</span><span class="o">.</span><span class="n">is_node_registered</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'node class </span><span class="si">%r</span><span class="s1"> is already registered, '</span>
                              <span class="s1">'its visitors will be overridden'</span><span class="p">),</span>
                           <span class="n">node</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">'app'</span><span class="p">,</span> <span class="n">subtype</span><span class="o">=</span><span class="s1">'add_node'</span><span class="p">)</span>
        <span class="n">docutils</span><span class="o">.</span><span class="n">register_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_translation_handlers</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_enumerable_node"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_enumerable_node">[docs]</a>    <span class="k">def</span> <span class="nf">add_enumerable_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Element</span><span class="p">],</span> <span class="n">figtype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">title_getter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TitleGetter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a Docutils node class as a numfig target.</span>

<span class="sd">        Sphinx numbers the node automatically. And then the users can refer it</span>
<span class="sd">        using :rst:role:`numref`.</span>

<span class="sd">        :param node: A node class</span>
<span class="sd">        :param figtype: The type of enumerable nodes.  Each figtype has individual numbering</span>
<span class="sd">                        sequences.  As system figtypes, ``figure``, ``table`` and</span>
<span class="sd">                        ``code-block`` are defined.  It is possible to add custom nodes to</span>
<span class="sd">                        these default figtypes.  It is also possible to define new custom</span>
<span class="sd">                        figtype if a new figtype is given.</span>
<span class="sd">        :param title_getter: A getter function to obtain the title of node.  It takes an</span>
<span class="sd">                             instance of the enumerable node, and it must return its title as</span>
<span class="sd">                             string.  The title is used to the default title of references for</span>
<span class="sd">                             :rst:role:`ref`.  By default, Sphinx searches</span>
<span class="sd">                             ``docutils.nodes.caption`` or ``docutils.nodes.title`` from the</span>
<span class="sd">                             node as a title.</span>
<span class="sd">        :param kwargs: Visitor functions for each builder (same as :meth:`add_node`)</span>
<span class="sd">        :param override: If true, install the node forcedly even if another node is already</span>
<span class="sd">                         installed as the same name</span>

<span class="sd">        .. versionadded:: 1.4</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_enumerable_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">figtype</span><span class="p">,</span> <span class="n">title_getter</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_directive"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_directive">[docs]</a>    <span class="k">def</span> <span class="nf">add_directive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Directive</span><span class="p">],</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a Docutils directive.</span>

<span class="sd">        :param name: The name of the directive</span>
<span class="sd">        :param cls: A directive class</span>
<span class="sd">        :param override: If false, do not install it if another directive</span>
<span class="sd">                         is already installed as the same name</span>
<span class="sd">                         If true, unconditionally install the directive.</span>

<span class="sd">        For example, a custom directive named ``my-directive`` would be added</span>
<span class="sd">        like this:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           from docutils.parsers.rst import Directive, directives</span>

<span class="sd">           class MyDirective(Directive):</span>
<span class="sd">               has_content = True</span>
<span class="sd">               required_arguments = 1</span>
<span class="sd">               optional_arguments = 0</span>
<span class="sd">               final_argument_whitespace = True</span>
<span class="sd">               option_spec = {</span>
<span class="sd">                   'class': directives.class_option,</span>
<span class="sd">                   'name': directives.unchanged,</span>
<span class="sd">               }</span>

<span class="sd">               def run(self):</span>
<span class="sd">                   ...</span>

<span class="sd">           def setup(app):</span>
<span class="sd">               app.add_directive('my-directive', MyDirective)</span>

<span class="sd">        For more details, see `the Docutils docs</span>
<span class="sd">        &lt;https://docutils.sourceforge.io/docs/howto/rst-directives.html&gt;`__ .</span>

<span class="sd">        .. versionchanged:: 0.6</span>
<span class="sd">           Docutils 0.5-style directive classes are now supported.</span>
<span class="sd">        .. deprecated:: 1.8</span>
<span class="sd">           Docutils 0.4-style (function based) directives support is deprecated.</span>
<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Add *override* keyword.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] adding directive: </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">cls</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">override</span> <span class="ow">and</span> <span class="n">docutils</span><span class="o">.</span><span class="n">is_directive_registered</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'directive </span><span class="si">%r</span><span class="s1"> is already registered, it will be overridden'</span><span class="p">),</span>
                           <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">'app'</span><span class="p">,</span> <span class="n">subtype</span><span class="o">=</span><span class="s1">'add_directive'</span><span class="p">)</span>

        <span class="n">docutils</span><span class="o">.</span><span class="n">register_directive</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_role"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_role">[docs]</a>    <span class="k">def</span> <span class="nf">add_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a Docutils role.</span>

<span class="sd">        :param name: The name of role</span>
<span class="sd">        :param role: A role function</span>
<span class="sd">        :param override: If false, do not install it if another role</span>
<span class="sd">                         is already installed as the same name</span>
<span class="sd">                         If true, unconditionally install the role.</span>

<span class="sd">        For more details about role functions, see `the Docutils docs</span>
<span class="sd">        &lt;https://docutils.sourceforge.io/docs/howto/rst-roles.html&gt;`__ .</span>

<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Add *override* keyword.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] adding role: </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">role</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">override</span> <span class="ow">and</span> <span class="n">docutils</span><span class="o">.</span><span class="n">is_role_registered</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'role </span><span class="si">%r</span><span class="s1"> is already registered, it will be overridden'</span><span class="p">),</span>
                           <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">'app'</span><span class="p">,</span> <span class="n">subtype</span><span class="o">=</span><span class="s1">'add_role'</span><span class="p">)</span>
        <span class="n">docutils</span><span class="o">.</span><span class="n">register_role</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_generic_role"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_generic_role">[docs]</a>    <span class="k">def</span> <span class="nf">add_generic_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nodeclass</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a generic Docutils role.</span>

<span class="sd">        Register a Docutils role that does nothing but wrap its contents in the</span>
<span class="sd">        node given by *nodeclass*.</span>

<span class="sd">        :param override: If false, do not install it if another role</span>
<span class="sd">                         is already installed as the same name</span>
<span class="sd">                         If true, unconditionally install the role.</span>

<span class="sd">        .. versionadded:: 0.6</span>
<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Add *override* keyword.</span>
<span class="sd">        """</span>
        <span class="c1"># Don't use ``roles.register_generic_role`` because it uses</span>
        <span class="c1"># ``register_canonical_role``.</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] adding generic role: </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">nodeclass</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">override</span> <span class="ow">and</span> <span class="n">docutils</span><span class="o">.</span><span class="n">is_role_registered</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'role </span><span class="si">%r</span><span class="s1"> is already registered, it will be overridden'</span><span class="p">),</span>
                           <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">'app'</span><span class="p">,</span> <span class="n">subtype</span><span class="o">=</span><span class="s1">'add_generic_role'</span><span class="p">)</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">roles</span><span class="o">.</span><span class="n">GenericRole</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">nodeclass</span><span class="p">)</span>
        <span class="n">docutils</span><span class="o">.</span><span class="n">register_role</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_domain"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_domain">[docs]</a>    <span class="k">def</span> <span class="nf">add_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Domain</span><span class="p">],</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a domain.</span>

<span class="sd">        :param domain: A domain class</span>
<span class="sd">        :param override: If false, do not install it if another domain</span>
<span class="sd">                         is already installed as the same name</span>
<span class="sd">                         If true, unconditionally install the domain.</span>

<span class="sd">        .. versionadded:: 1.0</span>
<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Add *override* keyword.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_directive_to_domain"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_directive_to_domain">[docs]</a>    <span class="k">def</span> <span class="nf">add_directive_to_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Directive</span><span class="p">],</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a Docutils directive in a domain.</span>

<span class="sd">        Like :meth:`add_directive`, but the directive is added to the domain</span>
<span class="sd">        named *domain*.</span>

<span class="sd">        :param domain: The name of target domain</span>
<span class="sd">        :param name: A name of directive</span>
<span class="sd">        :param cls: A directive class</span>
<span class="sd">        :param override: If false, do not install it if another directive</span>
<span class="sd">                         is already installed as the same name</span>
<span class="sd">                         If true, unconditionally install the directive.</span>

<span class="sd">        .. versionadded:: 1.0</span>
<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Add *override* keyword.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_directive_to_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_role_to_domain"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_role_to_domain">[docs]</a>    <span class="k">def</span> <span class="nf">add_role_to_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">RoleFunction</span><span class="p">,</span> <span class="n">XRefRole</span><span class="p">],</span>
                           <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a Docutils role in a domain.</span>

<span class="sd">        Like :meth:`add_role`, but the role is added to the domain named</span>
<span class="sd">        *domain*.</span>

<span class="sd">        :param domain: The name of the target domain</span>
<span class="sd">        :param name: The name of the role</span>
<span class="sd">        :param role: The role function</span>
<span class="sd">        :param override: If false, do not install it if another role</span>
<span class="sd">                         is already installed as the same name</span>
<span class="sd">                         If true, unconditionally install the role.</span>

<span class="sd">        .. versionadded:: 1.0</span>
<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Add *override* keyword.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_role_to_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_index_to_domain"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_index_to_domain">[docs]</a>    <span class="k">def</span> <span class="nf">add_index_to_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Index</span><span class="p">],</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a custom index for a domain.</span>

<span class="sd">        Add a custom *index* class to the domain named *domain*.</span>

<span class="sd">        :param domain: The name of the target domain</span>
<span class="sd">        :param index: The index class</span>
<span class="sd">        :param override: If false, do not install it if another index</span>
<span class="sd">                         is already installed as the same name</span>
<span class="sd">                         If true, unconditionally install the index.</span>

<span class="sd">        .. versionadded:: 1.0</span>
<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Add *override* keyword.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_index_to_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_object_type"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_object_type">[docs]</a>    <span class="k">def</span> <span class="nf">add_object_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directivename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rolename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indextemplate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span>
                        <span class="n">parse_node</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">ref_nodeclass</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">TextElement</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">objname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="n">doc_field_types</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a new object type.</span>

<span class="sd">        This method is a very convenient way to add a new :term:`object` type</span>
<span class="sd">        that can be cross-referenced.  It will do this:</span>

<span class="sd">        - Create a new directive (called *directivename*) for documenting an</span>
<span class="sd">          object.  It will automatically add index entries if *indextemplate*</span>
<span class="sd">          is nonempty; if given, it must contain exactly one instance of</span>
<span class="sd">          ``%s``.  See the example below for how the template will be</span>
<span class="sd">          interpreted.</span>
<span class="sd">        - Create a new role (called *rolename*) to cross-reference to these</span>
<span class="sd">          object descriptions.</span>
<span class="sd">        - If you provide *parse_node*, it must be a function that takes a</span>
<span class="sd">          string and a docutils node, and it must populate the node with</span>
<span class="sd">          children parsed from the string.  It must then return the name of the</span>
<span class="sd">          item to be used in cross-referencing and index entries.  See the</span>
<span class="sd">          :file:`conf.py` file in the source for this documentation for an</span>
<span class="sd">          example.</span>
<span class="sd">        - The *objname* (if not given, will default to *directivename*) names</span>
<span class="sd">          the type of object.  It is used when listing objects, e.g. in search</span>
<span class="sd">          results.</span>

<span class="sd">        For example, if you have this call in a custom Sphinx extension::</span>

<span class="sd">           app.add_object_type('directive', 'dir', 'pair: %s; directive')</span>

<span class="sd">        you can use this markup in your documents::</span>

<span class="sd">           .. rst:directive:: function</span>

<span class="sd">              Document a function.</span>

<span class="sd">           &lt;...&gt;</span>

<span class="sd">           See also the :rst:dir:`function` directive.</span>

<span class="sd">        For the directive, an index entry will be generated as if you had prepended ::</span>

<span class="sd">           .. index:: pair: function; directive</span>

<span class="sd">        The reference node will be of class ``literal`` (so it will be rendered</span>
<span class="sd">        in a proportional font, as appropriate for code) unless you give the</span>
<span class="sd">        *ref_nodeclass* argument, which must be a docutils node class.  Most</span>
<span class="sd">        useful are ``docutils.nodes.emphasis`` or ``docutils.nodes.strong`` --</span>
<span class="sd">        you can also use ``docutils.nodes.generated`` if you want no further</span>
<span class="sd">        text decoration.  If the text should be treated as literal (e.g. no</span>
<span class="sd">        smart quote replacement), but not have typewriter styling, use</span>
<span class="sd">        ``sphinx.addnodes.literal_emphasis`` or</span>
<span class="sd">        ``sphinx.addnodes.literal_strong``.</span>

<span class="sd">        For the role content, you have the same syntactical possibilities as</span>
<span class="sd">        for standard Sphinx roles (see :ref:`xref-syntax`).</span>

<span class="sd">        If *override* is True, the given object_type is forcedly installed even if</span>
<span class="sd">        an object_type having the same name is already installed.</span>

<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Add *override* keyword.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_object_type</span><span class="p">(</span><span class="n">directivename</span><span class="p">,</span> <span class="n">rolename</span><span class="p">,</span> <span class="n">indextemplate</span><span class="p">,</span> <span class="n">parse_node</span><span class="p">,</span>
                                      <span class="n">ref_nodeclass</span><span class="p">,</span> <span class="n">objname</span><span class="p">,</span> <span class="n">doc_field_types</span><span class="p">,</span>
                                      <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_crossref_type"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_crossref_type">[docs]</a>    <span class="k">def</span> <span class="nf">add_crossref_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directivename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rolename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indextemplate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span>
                          <span class="n">ref_nodeclass</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">TextElement</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">objname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span>
                          <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a new crossref object type.</span>

<span class="sd">        This method is very similar to :meth:`add_object_type` except that the</span>
<span class="sd">        directive it generates must be empty, and will produce no output.</span>

<span class="sd">        That means that you can add semantic targets to your sources, and refer</span>
<span class="sd">        to them using custom roles instead of generic ones (like</span>
<span class="sd">        :rst:role:`ref`).  Example call::</span>

<span class="sd">           app.add_crossref_type('topic', 'topic', 'single: %s',</span>
<span class="sd">                                 docutils.nodes.emphasis)</span>

<span class="sd">        Example usage::</span>

<span class="sd">           .. topic:: application API</span>

<span class="sd">           The application API</span>
<span class="sd">           -------------------</span>

<span class="sd">           Some random text here.</span>

<span class="sd">           See also :topic:`this section &lt;application API&gt;`.</span>

<span class="sd">        (Of course, the element following the ``topic`` directive needn't be a</span>
<span class="sd">        section.)</span>


<span class="sd">        :param override: If false, do not install it if another cross-reference type</span>
<span class="sd">                         is already installed as the same name</span>
<span class="sd">                         If true, unconditionally install the cross-reference type.</span>

<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Add *override* keyword.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_crossref_type</span><span class="p">(</span><span class="n">directivename</span><span class="p">,</span> <span class="n">rolename</span><span class="p">,</span>
                                        <span class="n">indextemplate</span><span class="p">,</span> <span class="n">ref_nodeclass</span><span class="p">,</span> <span class="n">objname</span><span class="p">,</span>
                                        <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_transform"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_transform">[docs]</a>    <span class="k">def</span> <span class="nf">add_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transform</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Transform</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a Docutils transform to be applied after parsing.</span>

<span class="sd">        Add the standard docutils :class:`Transform` subclass *transform* to</span>
<span class="sd">        the list of transforms that are applied after Sphinx parses a reST</span>
<span class="sd">        document.</span>

<span class="sd">        :param transform: A transform class</span>

<span class="sd">        .. list-table:: priority range categories for Sphinx transforms</span>
<span class="sd">           :widths: 20,80</span>

<span class="sd">           * - Priority</span>
<span class="sd">             - Main purpose in Sphinx</span>
<span class="sd">           * - 0-99</span>
<span class="sd">             - Fix invalid nodes by docutils. Translate a doctree.</span>
<span class="sd">           * - 100-299</span>
<span class="sd">             - Preparation</span>
<span class="sd">           * - 300-399</span>
<span class="sd">             - early</span>
<span class="sd">           * - 400-699</span>
<span class="sd">             - main</span>
<span class="sd">           * - 700-799</span>
<span class="sd">             - Post processing. Deadline to modify text and referencing.</span>
<span class="sd">           * - 800-899</span>
<span class="sd">             - Collect referencing and referenced nodes. Domain processing.</span>
<span class="sd">           * - 900-999</span>
<span class="sd">             - Finalize and clean up.</span>

<span class="sd">        refs: `Transform Priority Range Categories`__</span>

<span class="sd">        __ https://docutils.sourceforge.io/docs/ref/transforms.html#transform-priority-range-categories</span>
<span class="sd">        """</span>  <span class="c1"># NOQA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_transform</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_post_transform"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_post_transform">[docs]</a>    <span class="k">def</span> <span class="nf">add_post_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transform</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Transform</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a Docutils transform to be applied before writing.</span>

<span class="sd">        Add the standard docutils :class:`Transform` subclass *transform* to</span>
<span class="sd">        the list of transforms that are applied before Sphinx writes a</span>
<span class="sd">        document.</span>

<span class="sd">        :param transform: A transform class</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_post_transform</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_js_file"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_js_file">[docs]</a>    <span class="k">def</span> <span class="nf">add_js_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
                    <span class="n">loading_method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a JavaScript file to include in the HTML output.</span>

<span class="sd">        :param filename: The name of a JavaScript file that the default HTML</span>
<span class="sd">                         template will include. It must be relative to the HTML</span>
<span class="sd">                         static path, or a full URI with scheme, or ``None`` .</span>
<span class="sd">                         The ``None`` value is used to create an inline</span>
<span class="sd">                         ``&lt;script&gt;`` tag.  See the description of *kwargs*</span>
<span class="sd">                         below.</span>
<span class="sd">        :param priority: Files are included in ascending order of priority. If</span>
<span class="sd">                         multiple JavaScript files have the same priority,</span>
<span class="sd">                         those files will be included in order of registration.</span>
<span class="sd">                         See list of "prority range for JavaScript files" below.</span>
<span class="sd">        :param loading_method: The loading method for the JavaScript file.</span>
<span class="sd">                               Either ``'async'`` or ``'defer'`` are allowed.</span>
<span class="sd">        :param kwargs: Extra keyword arguments are included as attributes of the</span>
<span class="sd">                       ``&lt;script&gt;`` tag.  If the special keyword argument</span>
<span class="sd">                       ``body`` is given, its value will be added as the content</span>
<span class="sd">                       of the  ``&lt;script&gt;`` tag.</span>

<span class="sd">        Example::</span>

<span class="sd">            app.add_js_file('example.js')</span>
<span class="sd">            # =&gt; &lt;script src="_static/example.js"&gt;&lt;/script&gt;</span>

<span class="sd">            app.add_js_file('example.js', loading_method="async")</span>
<span class="sd">            # =&gt; &lt;script src="_static/example.js" async="async"&gt;&lt;/script&gt;</span>

<span class="sd">            app.add_js_file(None, body="var myVariable = 'foo';")</span>
<span class="sd">            # =&gt; &lt;script&gt;var myVariable = 'foo';&lt;/script&gt;</span>

<span class="sd">        .. list-table:: priority range for JavaScript files</span>
<span class="sd">           :widths: 20,80</span>

<span class="sd">           * - Priority</span>
<span class="sd">             - Main purpose in Sphinx</span>
<span class="sd">           * - 200</span>
<span class="sd">             - default priority for built-in JavaScript files</span>
<span class="sd">           * - 500</span>
<span class="sd">             - default priority for extensions</span>
<span class="sd">           * - 800</span>
<span class="sd">             - default priority for :confval:`html_js_files`</span>

<span class="sd">        A JavaScript file can be added to the specific HTML page when an extension</span>
<span class="sd">        calls this method on :event:`html-page-context` event.</span>

<span class="sd">        .. versionadded:: 0.5</span>

<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Renamed from ``app.add_javascript()``.</span>
<span class="sd">           And it allows keyword arguments as attributes of script tag.</span>

<span class="sd">        .. versionchanged:: 3.5</span>
<span class="sd">           Take priority argument.  Allow to add a JavaScript file to the specific page.</span>
<span class="sd">        .. versionchanged:: 4.4</span>
<span class="sd">           Take loading_method argument.  Allow to change the loading method of the</span>
<span class="sd">           JavaScript file.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">loading_method</span> <span class="o">==</span> <span class="s1">'async'</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">'async'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'async'</span>
        <span class="k">elif</span> <span class="n">loading_method</span> <span class="o">==</span> <span class="s1">'defer'</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">'defer'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'defer'</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_js_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'builder'</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="p">,</span> <span class="s1">'add_js_file'</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">add_js_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined]</span>
                                     <span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_css_file"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_css_file">[docs]</a>    <span class="k">def</span> <span class="nf">add_css_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a stylesheet to include in the HTML output.</span>

<span class="sd">        :param filename: The name of a CSS file that the default HTML</span>
<span class="sd">                         template will include. It must be relative to the HTML</span>
<span class="sd">                         static path, or a full URI with scheme.</span>
<span class="sd">        :param priority: Files are included in ascending order of priority. If</span>
<span class="sd">                         multiple CSS files have the same priority,</span>
<span class="sd">                         those files will be included in order of registration.</span>
<span class="sd">                         See list of "prority range for CSS files" below.</span>
<span class="sd">        :param kwargs: Extra keyword arguments are included as attributes of the</span>
<span class="sd">                       ``&lt;link&gt;`` tag.</span>

<span class="sd">        Example::</span>

<span class="sd">            app.add_css_file('custom.css')</span>
<span class="sd">            # =&gt; &lt;link rel="stylesheet" href="_static/custom.css" type="text/css" /&gt;</span>

<span class="sd">            app.add_css_file('print.css', media='print')</span>
<span class="sd">            # =&gt; &lt;link rel="stylesheet" href="_static/print.css"</span>
<span class="sd">            #          type="text/css" media="print" /&gt;</span>

<span class="sd">            app.add_css_file('fancy.css', rel='alternate stylesheet', title='fancy')</span>
<span class="sd">            # =&gt; &lt;link rel="alternate stylesheet" href="_static/fancy.css"</span>
<span class="sd">            #          type="text/css" title="fancy" /&gt;</span>

<span class="sd">        .. list-table:: priority range for CSS files</span>
<span class="sd">           :widths: 20,80</span>

<span class="sd">           * - Priority</span>
<span class="sd">             - Main purpose in Sphinx</span>
<span class="sd">           * - 200</span>
<span class="sd">             - default priority for built-in CSS files</span>
<span class="sd">           * - 500</span>
<span class="sd">             - default priority for extensions</span>
<span class="sd">           * - 800</span>
<span class="sd">             - default priority for :confval:`html_css_files`</span>

<span class="sd">        A CSS file can be added to the specific HTML page when an extension calls</span>
<span class="sd">        this method on :event:`html-page-context` event.</span>

<span class="sd">        .. versionadded:: 1.0</span>

<span class="sd">        .. versionchanged:: 1.6</span>
<span class="sd">           Optional ``alternate`` and/or ``title`` attributes can be supplied</span>
<span class="sd">           with the arguments *alternate* (a Boolean) and *title* (a string).</span>
<span class="sd">           The default is no title and *alternate* = ``False``. For</span>
<span class="sd">           more information, refer to the `documentation</span>
<span class="sd">           &lt;https://mdn.io/Web/CSS/Alternative_style_sheets&gt;`__.</span>

<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Renamed from ``app.add_stylesheet()``.</span>
<span class="sd">           And it allows keyword arguments as attributes of link tag.</span>

<span class="sd">        .. versionchanged:: 3.5</span>
<span class="sd">           Take priority argument.  Allow to add a CSS file to the specific page.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] adding stylesheet: </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_css_files</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'builder'</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="p">,</span> <span class="s1">'add_css_file'</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">add_css_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined]</span>
                                      <span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">add_stylesheet</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">alternate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""An alias of :meth:`add_css_file`.</span>

<span class="sd">        .. deprecated:: 1.8</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'The app.add_stylesheet() is deprecated. '</span>
                       <span class="s1">'Please use app.add_css_file() instead.'</span><span class="p">)</span>

        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, Any]</span>
        <span class="k">if</span> <span class="n">alternate</span><span class="p">:</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s1">'rel'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'alternate stylesheet'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s1">'rel'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'stylesheet'</span>

        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_css_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>

<div class="viewcode-block" id="Sphinx.add_latex_package"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_latex_package">[docs]</a>    <span class="k">def</span> <span class="nf">add_latex_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">packagename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">after_hyperref</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">"""Register a package to include in the LaTeX source code.</span>

<span class="sd">        Add *packagename* to the list of packages that LaTeX source code will</span>
<span class="sd">        include.  If you provide *options*, it will be taken to the `\usepackage`</span>
<span class="sd">        declaration.  If you set *after_hyperref* truthy, the package will be</span>
<span class="sd">        loaded after ``hyperref`` package.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           app.add_latex_package('mypackage')</span>
<span class="sd">           # =&gt; \usepackage{mypackage}</span>
<span class="sd">           app.add_latex_package('mypackage', 'foo,bar')</span>
<span class="sd">           # =&gt; \usepackage[foo,bar]{mypackage}</span>

<span class="sd">        .. versionadded:: 1.3</span>
<span class="sd">        .. versionadded:: 3.1</span>

<span class="sd">           *after_hyperref* option.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_latex_package</span><span class="p">(</span><span class="n">packagename</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">after_hyperref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_lexer"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_lexer">[docs]</a>    <span class="k">def</span> <span class="nf">add_lexer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lexer</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Lexer</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a new lexer for source code.</span>

<span class="sd">        Use *lexer* to highlight code blocks with the given language *alias*.</span>

<span class="sd">        .. versionadded:: 0.6</span>
<span class="sd">        .. versionchanged:: 2.1</span>
<span class="sd">           Take a lexer class as an argument.  An instance of lexers are</span>
<span class="sd">           still supported until Sphinx-3.x.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] adding lexer: </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">lexer</span><span class="p">))</span>
        <span class="n">lexer_classes</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">lexer</span></div>

<div class="viewcode-block" id="Sphinx.add_autodocumenter"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_autodocumenter">[docs]</a>    <span class="k">def</span> <span class="nf">add_autodocumenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a new documenter class for the autodoc extension.</span>

<span class="sd">        Add *cls* as a new documenter class for the :mod:`sphinx.ext.autodoc`</span>
<span class="sd">        extension.  It must be a subclass of</span>
<span class="sd">        :class:`sphinx.ext.autodoc.Documenter`.  This allows auto-documenting</span>
<span class="sd">        new types of objects.  See the source of the autodoc module for</span>
<span class="sd">        examples on how to subclass :class:`Documenter`.</span>

<span class="sd">        If *override* is True, the given *cls* is forcedly installed even if</span>
<span class="sd">        a documenter having the same name is already installed.</span>

<span class="sd">        See :ref:`autodoc_ext_tutorial`.</span>

<span class="sd">        .. versionadded:: 0.6</span>
<span class="sd">        .. versionchanged:: 2.2</span>
<span class="sd">           Add *override* keyword.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] adding autodocumenter: </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">sphinx.ext.autodoc.directive</span> <span class="kn">import</span> <span class="n">AutodocDirective</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_documenter</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">objtype</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_directive</span><span class="p">(</span><span class="s1">'auto'</span> <span class="o">+</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objtype</span><span class="p">,</span> <span class="n">AutodocDirective</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_autodoc_attrgetter"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_autodoc_attrgetter">[docs]</a>    <span class="k">def</span> <span class="nf">add_autodoc_attrgetter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">:</span> <span class="n">Type</span><span class="p">,</span> <span class="n">getter</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span>
                               <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a new ``getattr``-like function for the autodoc extension.</span>

<span class="sd">        Add *getter*, which must be a function with an interface compatible to</span>
<span class="sd">        the :func:`getattr` builtin, as the autodoc attribute getter for</span>
<span class="sd">        objects that are instances of *typ*.  All cases where autodoc needs to</span>
<span class="sd">        get an attribute of a type are then handled by this function instead of</span>
<span class="sd">        :func:`getattr`.</span>

<span class="sd">        .. versionadded:: 0.6</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] adding autodoc attrgetter: </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">getter</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_autodoc_attrgetter</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">getter</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_search_language"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_search_language">[docs]</a>    <span class="k">def</span> <span class="nf">add_search_language</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a new language for the HTML search index.</span>

<span class="sd">        Add *cls*, which must be a subclass of</span>
<span class="sd">        :class:`sphinx.search.SearchLanguage`, as a support language for</span>
<span class="sd">        building the HTML full-text search index.  The class must have a *lang*</span>
<span class="sd">        attribute that indicates the language it should be used for.  See</span>
<span class="sd">        :confval:`html_search_language`.</span>

<span class="sd">        .. versionadded:: 1.1</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] adding search language: </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">sphinx.search</span> <span class="kn">import</span> <span class="n">SearchLanguage</span><span class="p">,</span> <span class="n">languages</span>
        <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">SearchLanguage</span><span class="p">)</span>
        <span class="n">languages</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span></div>

<div class="viewcode-block" id="Sphinx.add_source_suffix"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_source_suffix">[docs]</a>    <span class="k">def</span> <span class="nf">add_source_suffix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filetype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a suffix of source files.</span>

<span class="sd">        Same as :confval:`source_suffix`.  The users can override this</span>
<span class="sd">        using the config setting.</span>

<span class="sd">        :param override: If false, do not install it the same suffix</span>
<span class="sd">                         is already installed.</span>
<span class="sd">                         If true, unconditionally install the suffix.</span>

<span class="sd">        .. versionadded:: 1.8</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_source_suffix</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="n">filetype</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_source_parser"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_source_parser">[docs]</a>    <span class="k">def</span> <span class="nf">add_source_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Parser</span><span class="p">],</span> <span class="n">override</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a parser class.</span>

<span class="sd">        :param override: If false, do not install it if another parser</span>
<span class="sd">                         is already installed for the same suffix.</span>
<span class="sd">                         If true, unconditionally install the parser.</span>

<span class="sd">        .. versionadded:: 1.4</span>
<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           *suffix* argument is deprecated.  It only accepts *parser* argument.</span>
<span class="sd">           Use :meth:`add_source_suffix` API to register suffix instead.</span>
<span class="sd">        .. versionchanged:: 1.8</span>
<span class="sd">           Add *override* keyword.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_source_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="n">override</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_env_collector"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_env_collector">[docs]</a>    <span class="k">def</span> <span class="nf">add_env_collector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collector</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">EnvironmentCollector</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register an environment collector class.</span>

<span class="sd">        Refer to :ref:`collector-api`.</span>

<span class="sd">        .. versionadded:: 1.6</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] adding environment collector: </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="n">collector</span><span class="p">)</span>
        <span class="n">collector</span><span class="p">()</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_html_theme"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_html_theme">[docs]</a>    <span class="k">def</span> <span class="nf">add_html_theme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">theme_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a HTML Theme.</span>

<span class="sd">        The *name* is a name of theme, and *theme_path* is a full path to the</span>
<span class="sd">        theme (refs: :ref:`distribute-your-theme`).</span>

<span class="sd">        .. versionadded:: 1.6</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'[app] adding HTML theme: </span><span class="si">%r</span><span class="s1">, </span><span class="si">%r</span><span class="s1">'</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">theme_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_html_theme</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">theme_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_html_math_renderer"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_html_math_renderer">[docs]</a>    <span class="k">def</span> <span class="nf">add_html_math_renderer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                               <span class="n">inline_renderers</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                               <span class="n">block_renderers</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a math renderer for HTML.</span>

<span class="sd">        The *name* is a name of math renderer.  Both *inline_renderers* and</span>
<span class="sd">        *block_renderers* are used as visitor functions for the HTML writer:</span>
<span class="sd">        the former for inline math node (``nodes.math``), the latter for</span>
<span class="sd">        block math node (``nodes.math_block``).  Regarding visitor functions,</span>
<span class="sd">        see :meth:`add_node` for details.</span>

<span class="sd">        .. versionadded:: 1.8</span>

<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">add_html_math_renderer</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">inline_renderers</span><span class="p">,</span> <span class="n">block_renderers</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sphinx.add_message_catalog"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.add_message_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">add_message_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catalog</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">locale_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Register a message catalog.</span>

<span class="sd">        :param catalog: The name of the catalog</span>
<span class="sd">        :param locale_dir: The base path of the message catalog</span>

<span class="sd">        For more details, see :func:`sphinx.locale.get_translation()`.</span>

<span class="sd">        .. versionadded:: 1.8</span>
<span class="sd">        """</span>
        <span class="n">locale</span><span class="o">.</span><span class="n">init</span><span class="p">([</span><span class="n">locale_dir</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">catalog</span><span class="p">)</span>
        <span class="n">locale</span><span class="o">.</span><span class="n">init_console</span><span class="p">(</span><span class="n">locale_dir</span><span class="p">,</span> <span class="n">catalog</span><span class="p">)</span></div>

    <span class="c1"># ---- other methods -------------------------------------------------</span>
<div class="viewcode-block" id="Sphinx.is_parallel_allowed"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.Sphinx.is_parallel_allowed">[docs]</a>    <span class="k">def</span> <span class="nf">is_parallel_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">"""Check whether parallel processing is allowed or not.</span>

<span class="sd">        :param typ: A type of processing; ``'read'`` or ``'write'``.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">'read'</span><span class="p">:</span>
            <span class="n">attrname</span> <span class="o">=</span> <span class="s1">'parallel_read_safe'</span>
            <span class="n">message_not_declared</span> <span class="o">=</span> <span class="n">__</span><span class="p">(</span><span class="s2">"the </span><span class="si">%s</span><span class="s2"> extension does not declare if it "</span>
                                      <span class="s2">"is safe for parallel reading, assuming "</span>
                                      <span class="s2">"it isn't - please ask the extension author "</span>
                                      <span class="s2">"to check and make it explicit"</span><span class="p">)</span>
            <span class="n">message_not_safe</span> <span class="o">=</span> <span class="n">__</span><span class="p">(</span><span class="s2">"the </span><span class="si">%s</span><span class="s2"> extension is not safe for parallel reading"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">'write'</span><span class="p">:</span>
            <span class="n">attrname</span> <span class="o">=</span> <span class="s1">'parallel_write_safe'</span>
            <span class="n">message_not_declared</span> <span class="o">=</span> <span class="n">__</span><span class="p">(</span><span class="s2">"the </span><span class="si">%s</span><span class="s2"> extension does not declare if it "</span>
                                      <span class="s2">"is safe for parallel writing, assuming "</span>
                                      <span class="s2">"it isn't - please ask the extension author "</span>
                                      <span class="s2">"to check and make it explicit"</span><span class="p">)</span>
            <span class="n">message_not_safe</span> <span class="o">=</span> <span class="n">__</span><span class="p">(</span><span class="s2">"the </span><span class="si">%s</span><span class="s2"> extension is not safe for parallel writing"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'parallel type </span><span class="si">%s</span><span class="s1"> is not supported'</span> <span class="o">%</span> <span class="n">typ</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">allowed</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">allowed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">message_not_declared</span><span class="p">,</span> <span class="n">ext</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'doing serial </span><span class="si">%s</span><span class="s1">'</span><span class="p">),</span> <span class="n">typ</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">allowed</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">message_not_safe</span><span class="p">,</span> <span class="n">ext</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">'doing serial </span><span class="si">%s</span><span class="s1">'</span><span class="p">),</span> <span class="n">typ</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">set_html_assets_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span>
        <span class="sd">"""Set the policy to include assets in HTML pages.</span>

<span class="sd">        - always: include the assets in all the pages</span>
<span class="sd">        - per_page: include the assets only in pages where they are used</span>

<span class="sd">        .. versionadded: 4.1</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">policy</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'always'</span><span class="p">,</span> <span class="s1">'per_page'</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'policy </span><span class="si">%s</span><span class="s1"> is not supported'</span> <span class="o">%</span> <span class="n">policy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">html_assets_policy</span> <span class="o">=</span> <span class="n">policy</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">html_themes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">'app.html_themes is deprecated.'</span><span class="p">,</span>
                      <span class="n">RemovedInSphinx60Warning</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">html_themes</span></div>


<div class="viewcode-block" id="TemplateBridge"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.TemplateBridge">[docs]</a><span class="k">class</span> <span class="nc">TemplateBridge</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    This class defines the interface for a "template bridge", that is, a class</span>
<span class="sd">    that renders templates given a template name and a context.</span>
<span class="sd">    """</span>

<div class="viewcode-block" id="TemplateBridge.init"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.TemplateBridge.init">[docs]</a>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">builder</span><span class="p">:</span> <span class="s2">"Builder"</span><span class="p">,</span>
        <span class="n">theme</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Theme</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dirs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Called by the builder to initialize the template system.</span>

<span class="sd">        *builder* is the builder object; you'll probably want to look at the</span>
<span class="sd">        value of ``builder.config.templates_path``.</span>

<span class="sd">        *theme* is a :class:`sphinx.theming.Theme` object or None; in the latter</span>
<span class="sd">        case, *dirs* can be list of fixed directories to look for templates.</span>
<span class="sd">        """</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'must be implemented in subclasses'</span><span class="p">)</span></div>

<div class="viewcode-block" id="TemplateBridge.newest_template_mtime"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.TemplateBridge.newest_template_mtime">[docs]</a>    <span class="k">def</span> <span class="nf">newest_template_mtime</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">"""Called by the builder to determine if output files are outdated</span>
<span class="sd">        because of template changes.  Return the mtime of the newest template</span>
<span class="sd">        file that was changed.  The default implementation returns ``0``.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="TemplateBridge.render"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.TemplateBridge.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Called by the builder to render a template given as a filename with</span>
<span class="sd">        a specified context (a Python dictionary).</span>
<span class="sd">        """</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'must be implemented in subclasses'</span><span class="p">)</span></div>

<div class="viewcode-block" id="TemplateBridge.render_string"><a class="viewcode-back" href="../../extdev/appapi.html#sphinx.application.TemplateBridge.render_string">[docs]</a>    <span class="k">def</span> <span class="nf">render_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">"""Called by the builder to render a template given as a string with a</span>
<span class="sd">        specified context (a Python dictionary).</span>
<span class="sd">        """</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'must be implemented in subclasses'</span><span class="p">)</span></div></div>
</pre></div>
</div>
</div>
<div class="footer" role="contentinfo">
  © <a href="../../copyright.html">Copyright</a> 2007-2022, the Sphinx developers.
  Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
</div>
<script>var embed_css = function() {
    Array.from(document.querySelectorAll("link")).forEach( link => {
        if (link.getAttribute('rel') == 'stylesheet') {
            const style = document.createElement("style");
            var href = link.getAttribute('href');
            let [path, get_parameters, anchor] = split_url(href);
            path = normalize_path(path);
            style.innerText = retrieve_file(path);
            link.replaceWith(style);
        };
    });
};


var embed_js = function() {
    Array.from(document.querySelectorAll("script")).forEach( oldScript => {
        const newScript = document.createElement("script");
        Array.from(oldScript.attributes).forEach( attr => {
            newScript.setAttribute(attr.name, attr.value);
        });
        try {
            if (newScript.hasAttribute('src') && is_virtual(newScript.getAttribute('src'))) {
                var src = newScript.getAttribute('src');
                let [path, get_parameters, anchor] = split_url(src);
                path = normalize_path(path);
                var src = retrieve_file(path) + ' //# sourceMap=' + path;
                newScript.appendChild(document.createTextNode(src));
                newScript.removeAttribute('src');
                oldScript.parentNode.replaceChild(newScript, oldScript);
            }
        } catch (e) {
            // Make sure all scripts are loaded
            console.error("Caught error in " + oldScript.getAttribute("src"), e);
        }
    });
};


var split_url = function(url) {
    // Return a list of three elements: path, GET parameters, anchor
    var anchor = url.split('#')[1] || "";
    var get_parameters = url.split('#')[0].split('?')[1] || "";
    var path = url.split('#')[0];
    path = path.split('?')[0];
    let result = [path, get_parameters, anchor];
    // console.log("Split URL", url, result);
    return result;
}


var virtual_click = function(evnt) {
    // Handle GET parameters and anchors
    // console.log("Virtual click", evnt);

    var el = evnt.currentTarget;
    var name = el.tagName.toLowerCase();

    if (name == 'a') {
        var [path, get_parameters, anchor] = split_url(el.getAttribute('href'));
    } else if (name == 'form') {
        var [path, get_parameters, anchor] = split_url(el.getAttribute('action'));
        const formData = new FormData(el);
        get_parameters = new URLSearchParams(formData).toString();
    } else {
        console.error("Invalid element", el);
    }

    path = normalize_path(path);

    window.parent.postMessage({
        action: "virtual_click",
        argument: {
            path: path,
            get_parameters: get_parameters,
            anchor: anchor,
        }
    }, '*');
    evnt.preventDefault();
    evnt.stopPropagation();
    return false;
};

var fix_links = function() {
    Array.from(document.querySelectorAll("a")).forEach( a => {
        fix_link(a);
    });
};

var fix_link = function(a) {
    if (is_virtual(a.getAttribute('href'))) {
        a.addEventListener('click', virtual_click);
    } else if (a.getAttribute('href').startsWith('#')) {
        a.setAttribute('href', "about:srcdoc" + a.getAttribute('href'))
    } else {
        // External links should open in a new tab. Browsers block links to
        // sites of different origin within an iframe for security reasons.
        a.setAttribute('target', "_blank");
    }
};

var fix_form = function(form) {
    var href = form.getAttribute('action');
    if (is_virtual(href) && form.getAttribute('method').toLowerCase() == 'get') {
        form.addEventListener('submit', virtual_click);
    }
};


var fix_forms = function() {
    Array.from(document.querySelectorAll("form")).forEach( form => {
        fix_form(form);
    });
};


var embed_img = function(img) {
    if (img.hasAttribute('src')) {
        const src = img.getAttribute('src');
        if (is_virtual(src)) {
            var path = normalize_path(src);
            const file = retrieve_file(path);
            const mime_type = window.global_context.file_tree[path].mime_type;
            if (mime_type == 'image/svg+xml') {
                img.setAttribute('src', "data:image/svg+xml;charset=utf-8;base64, " + btoa(file));
            } else {
                img.setAttribute('src', `data:${mime_type};base64, ${file}`);
            }
        };
    };
};

var embed_imgs = function() {
    Array.from(document.querySelectorAll("img")).forEach( img => {
        embed_img(img);
    });
};

var is_virtual = function(url) {
    // Return true if the url should be retrieved from the virtual file tree
    var _url = url.toString().toLowerCase();
    return (! (
        _url == "" ||
        _url[0] == "#" ||
        _url.startsWith('https://') ||
        _url.startsWith('http://') ||
        _url.startsWith('data:') ||
        _url.startsWith('blob:')
    ));
};

var retrieve_file = function(path) {
    // console.log("Retrieving file: " + path);
    var file_tree = window.global_context.file_tree;
    var file = file_tree[path];
    if (!file) {
        console.warn("File not found: " + path);
        return "";
    } else {
        return file.data;
    }
};

var normalize_path = function(path) {
    // make relative paths absolute in context of our virtual file tree

    while (path && path[0] == '/') {
        path = path.substr(1);
    }

    var result = window.global_context.current_path;
    result = result.split('/');
    result.pop();
    result = result.concat(path.split('/'));

    // resolve relative directories
    var array = [];
    Array.from(result).forEach( component => {
        if (component == '..') {
            if (array) {
                array.pop();
            }
        } else if (component == '.') {
        } else {
            if (component) { array.push(component); }
        }
    });

    result = array.join('/');
    // console.log(`Normalized path: ${path} -> ${result} (@${window.global_context.current_path})`);
    return result;
};


var fix_document = function() {
    embed_js(); // This might change the DOM, so do this first
    monkey_patch();
    embed_css();
    embed_imgs();
    fix_links();
    fix_forms();
};


var on_set_data = function(argument) {
    window.global_context = argument;
    console.log("Received data from parent", window.global_context);
    // dynamically fix elements on this page
    try {
        fix_document();
        // Trigger DOMContentLoaded again, some scripts that have just
        // been executed expect it.
        window.document.dispatchEvent(new Event("DOMContentLoaded", {
            bubbles: true,
            cancelable: true
        }));
    } finally {
        observer.observe(window.document.body, {subtree: true, childList: true});
        window.parent.postMessage({
            action: "show_iframe",
            argument: "",
        }, '*');
    }
}


var on_scroll_to_anchor = function(argument) {
    if (window.global_context.anchor) {
        document.location.replace("about:srcdoc#" + window.global_context.anchor);
    }
}


const observer = new MutationObserver((mutationList) => {
    // console.log("Fix mutated elements...", mutationList);
    mutationList.forEach((mutation) => {
        if (mutation.type == 'childList') {
            Array.from(mutation.target.querySelectorAll("a")).forEach( a => {
                fix_link(a);
            });
            Array.from(mutation.target.querySelectorAll("img")).forEach( img => {
                embed_img(img);
            });
            Array.from(mutation.target.querySelectorAll("form")).forEach( form => {
                fix_form(form);
            });
        }
    });
});


var monkey_patch = function() {
    if (typeof jQuery === 'undefined') {return;} // Only for jQuery at the moment
    /**
     * Monkey patch getQueryParameters
     * This function is defined in Sphinx' (v4) doctools.js and incompatible with our
     * approach.
     * This is a copy with effectively only the third line changed.
     * See: https://github.com/sphinx-doc/sphinx/blob/2329fdef8c20c6c75194f5d842b8f62ebad5c79d/sphinx/themes/basic/static/doctools.js#L54
     */
    jQuery._getQueryParameters = jQuery.getQueryParameters;
    jQuery.getQueryParameters = function(s) {
      if (typeof s === 'undefined')
        s = '?' + window.global_context.get_parameters;
      return jQuery._getQueryParameters(s);
    };

    /**
     * Monkey patch jQuery.ajax
     * Only settings.url and settings.complete are supported for virtual
     * URLs.
     */
    jQuery._ajax = jQuery.ajax;
    jQuery.ajax = function(settings) {
        url = normalize_path(settings.url);
        if (is_virtual(url)) {
            var result;
            var data;
            data = retrieve_file(url);
            result = settings.complete({responseText: data}, "");
            return; // Return value not actually needed in searchtools.js
        } else {
            return jQuery.ajax(settings);
        };
    };
}


var on_load = function() {
    // Set up message listener
    window.addEventListener("message", (evnt) => {
        console.log("Received message in iframe", evnt);
        if (evnt.data.action == 'set_data') {
            on_set_data(evnt.data.argument);
        } else if (evnt.data.action == 'scroll_to_anchor') {
            on_scroll_to_anchor(evnt.data.argument);
        }
    }, false);

    // Set parent window title and trigger data transmission
    var favicon = window.document.querySelector("link[rel*='icon']");
    if (favicon) { favicon = favicon.getAttribute('href'); }
    var title = window.document.querySelector('head>title');
    if (title) { title = title.innerText; }

    window.parent.postMessage({
        action: "set_title",
        argument: {
            title: title,
            favicon: favicon
        }
    }, '*');

};


window.addEventListener('load', on_load);
//# sourceURL=inject_post.js</script></body>
</html>