import{d as B,h as f,o as l,b as u,e as t,i,w as _,f as r,t as c,c as E,j as $,r as y,a as N,k as Z,u as D,l as A,p as ee,m as te,_ as q,n as z,F as H,q as F,s as ne,v as j,x as W,y as O,z as le,g as oe,A as se}from"./index-emI0GJfG.js";import{a as P,b as K,c as ie,d as J,e as re,f as ae}from"./chat-UiPlG9Pb.js";/* empty css                                                                          *//* empty css                                                                       */import{_ as ce}from"./IndexView.vue_vue_type_script_setup_true_lang-2tcodoFI.js";const de={key:0,style:{"max-width":"560px"}},ue=t("br",null,null,-1),_e=t("br",null,null,-1),fe=t("br",null,null,-1),he=t("br",null,null,-1),me=t("br",null,null,-1),ve=t("br",null,null,-1),pe=t("br",null,null,-1),xe=t("br",null,null,-1),ye=t("br",null,null,-1),we=t("br",null,null,-1),ge=t("br",null,null,-1),$e=t("br",null,null,-1),be=t("br",null,null,-1),ke=t("br",null,null,-1),Ee=t("span",null,[r("朋友圈背景："),t("br")],-1),Se={key:1,style:{"max-width":"560px"}},Ue=t("br",null,null,-1),Be=t("br",null,null,-1),Ve=t("br",null,null,-1),Ce={key:0},Me=t("br",null,null,-1),Ie={key:1},Le=t("br",null,null,-1),ze={key:2},Te=t("br",null,null,-1),qe={key:3},De=t("br",null,null,-1),Ne={key:4},je=t("br",null,null,-1),He={key:5},Re=t("br",null,null,-1),Oe={key:6},Fe=t("br",null,null,-1),Pe={key:7},Ae=t("br",null,null,-1),We={key:8},Ke=t("br",null,null,-1),Je={key:9},Xe=t("br",null,null,-1),Ge={key:10},Qe=t("br",null,null,-1),Ye={key:11},Ze=t("br",null,null,-1),X=B({__name:"UserInfoShow",props:{userinfo:{type:Object,default:()=>({})},show_all:{type:Boolean,default:!0,required:!1}},setup(e){return(a,n)=>{const s=f("el-divider"),o=f("el-image");return e.show_all?(l(),u("div",de,[t("div",null,[i(s,{"content-position":"center"},{default:_(()=>[r("基本信息")]),_:1}),t("span",null,[r("wxid："+c(e.userinfo.wxid),1),ue]),t("span",null,[r("账号："+c(e.userinfo.account),1),_e]),t("span",null,[r("昵称："+c(e.userinfo.nickname),1),fe]),t("span",null,[r("备注："+c(e.userinfo.remark),1),he])]),t("div",null,[i(s,{"content-position":"center"},{default:_(()=>[r("个人信息")]),_:1}),t("span",null,[r("性别："+c(e.userinfo.ExtraBuf["性别[1男2女]"]==1?"男":e.userinfo.ExtraBuf["性别[1男2女]"]==2?"女":""),1),me]),t("span",null,[r("手机："+c(e.userinfo.ExtraBuf.手机号),1),ve]),t("span",null,[r("标签："+c(e.userinfo.LabelIDList.join("/")),1),pe]),t("span",null,[r("描述："+c(e.userinfo.describe),1),xe]),t("span",null,[r("个签："+c(e.userinfo.ExtraBuf.个性签名),1),ye]),t("span",null,[r("国家："+c(e.userinfo.ExtraBuf.国),1),we]),t("span",null,[r("省份："+c(e.userinfo.ExtraBuf.省),1),ge]),t("span",null,[r("市名："+c(e.userinfo.ExtraBuf.市),1),$e])]),t("div",null,[i(s,{"content-position":"center"},{default:_(()=>[r("其他信息")]),_:1}),t("span",null,[r("公司："+c(e.userinfo.ExtraBuf.公司名称),1),be]),t("span",null,[r("企微："+c(e.userinfo.ExtraBuf.企微属性),1),ke]),Ee,e.userinfo.ExtraBuf.朋友圈背景?(l(),E(o,{key:0,src:"/api/rs/imgsrc/"+e.userinfo.ExtraBuf.朋友圈背景,style:{"max-width":"200px","max-height":"200px"},alt:"朋友圈背景"},null,8,["src"])):$("",!0)])])):(l(),u("div",Se,[t("span",null,[r("wxid："+c(e.userinfo.wxid),1),Ue]),t("span",null,[r("账号："+c(e.userinfo.account),1),Be]),t("span",null,[r("昵称："+c(e.userinfo.nickname),1),Ve]),e.userinfo.remark?(l(),u("span",Ce,[r("备注："+c(e.userinfo.remark),1),Me])):$("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf["性别[1男2女]"]?(l(),u("span",Ie,[r("性别："+c(e.userinfo.ExtraBuf["性别[1男2女]"]==1?"男":e.userinfo.ExtraBuf["性别[1男2女]"]==2?"女":""),1),Le])):$("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.手机号?(l(),u("span",ze,[r("手机："+c(e.userinfo.ExtraBuf.手机号),1),Te])):$("",!0),e.userinfo.LabelIDList&&e.userinfo.LabelIDList.length>0?(l(),u("span",qe,[r("标签："+c(e.userinfo.LabelIDList.join("/")),1),De])):$("",!0),e.userinfo.describe?(l(),u("span",Ne,[r("描述："+c(e.userinfo.describe),1),je])):$("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.个性签名?(l(),u("span",He,[r("个签："+c(e.userinfo.ExtraBuf.个性签名),1),Re])):$("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.国?(l(),u("span",Oe,[r("国家："+c(e.userinfo.ExtraBuf.国),1),Fe])):$("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.省?(l(),u("span",Pe,[r("省份："+c(e.userinfo.ExtraBuf.省),1),Ae])):$("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.市?(l(),u("span",We,[r("市名："+c(e.userinfo.ExtraBuf.市),1),Ke])):$("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.公司名称?(l(),u("span",Je,[r("公司："+c(e.userinfo.ExtraBuf.公司名称),1),Xe])):$("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.企微属性?(l(),u("span",Ge,[r("企微："+c(e.userinfo.ExtraBuf.企微属性),1),Qe])):$("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.朋友圈背景?(l(),u("span",Ye,[r("朋友圈背景："),Ze])):$("",!0),e.userinfo.ExtraBuf&&e.userinfo.ExtraBuf.朋友圈背景?(l(),E(o,{key:12,src:"/api/rs/imgsrc/"+e.userinfo.ExtraBuf.朋友圈背景,style:{"max-width":"200px","max-height":"200px"},alt:"朋友圈背景"},null,8,["src"])):$("",!0)]))}}}),et=e=>(ee("data-v-b736fd3e"),e=e(),te(),e),tt={style:{padding:"10px 10px"}},nt={slot:"content",class:"tips"},lt=et(()=>t("br",null,null,-1)),ot={key:0,style:{color:"#909399","font-size":"12px"}},st=B({__name:"ContactsList",emits:["wxid"],setup(e,{emit:a}){const n=y([]);N(async()=>{try{n.value=await P()}catch(v){return console.error("Error fetching data:",v),[]}});const o=y(""),d=async()=>{try{if(o.value===""){n.value=await P();return}console.log(o.value),n.value=[];const v=await K(o.value);v!==null&&typeof v=="object"&&Object.entries(v).forEach(([g,V])=>{n.value.push(V)})}catch(v){return console.error("Error fetching data:",v),[]}},h=a,m=v=>{v!==void 0&&v.wxid!==void 0&&(console.log("wxid:",v.wxid),h("wxid",v.wxid))};return(v,g)=>{const V=f("el-input"),k=f("el-button"),I=f("el-avatar"),T=f("el-table-column"),S=f("el-tooltip"),M=f("el-table");return l(),u("div",null,[t("div",tt,[i(V,{placeholder:"请输入关键字",modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=b=>o.value=b),onKeyup:Z(d,["enter"]),style:{width:"170px","margin-left":"15px"}},null,8,["modelValue"]),i(k,{type:"primary",onClick:d,style:{width:"50px"}},{default:_(()=>[r("搜索")]),_:1})]),i(M,{data:n.value,stripe:"",style:{width:"100%"},"max-height":"100%",height:"100%","highlight-current-row":"",onCurrentChange:m},{default:_(()=>[i(T,{width:"57"},{default:_(({row:b})=>[b.headImgUrl!==""?(l(),E(I,{key:0,size:33,src:"/api/rs/imgsrc/"+b.headImgUrl},null,8,["src"])):(l(),E(I,{key:1,size:33},{default:_(()=>[r(" 群")]),_:1}))]),_:1}),i(T,{width:"190"},{default:_(({row:b})=>[i(S,{class:"item",effect:"light",placement:"right"},{content:_(()=>[i(X,{userinfo:b,show_all:!1,style:{"max-width":"600px"}},null,8,["userinfo"])]),default:_(()=>[t("div",nt,[t("span",null,c(D(A)(b)),1),r(),lt,b.nTime?(l(),u("span",ot,c(b.nTime),1)):$("",!0)])]),_:2},1024)]),_:1})]),_:1},8,["data"])])}}}),it=q(st,[["__scopeId","data-v-b736fd3e"]]),rt=B({__name:"ChatRecprdsHeader",props:{wxid:{type:String,required:!0}},emits:["exporting"],setup(e,{emit:a}){const n=e,s=y(0),o=y({wxid:"",nOrder:0,nUnReadCount:0,strNickName:"",nStatus:0,nIsSend:0,strContent:"",nMsgLocalID:0,nMsgStatus:0,nTime:"",nMsgType:0,nMsgSubType:0,nickname:"",remark:"",account:"",describe:"",headImgUrl:"",ExtraBuf:{个性签名:"",企微属性:"",公司名称:"",国:"",备注图片:"",备注图片2:"",市:"","性别[1男2女]":0,手机号:"",朋友圈背景:"",省:""},LabelIDList:[]}),d=async()=>{var S,M,b,L,x,U,C;try{const w=await K("",[n.wxid]);return o.value.wxid=n.wxid,o.value.remark=(S=w[n.wxid])==null?void 0:S.remark,o.value.account=(M=w[n.wxid])==null?void 0:M.account,o.value.describe=(b=w[n.wxid])==null?void 0:b.describe,o.value.headImgUrl=(L=w[n.wxid])==null?void 0:L.headImgUrl,o.value.nickname=(x=w[n.wxid])==null?void 0:x.nickname,o.value.LabelIDList=(U=w[n.wxid])==null?void 0:U.LabelIDList,o.value.ExtraBuf=(C=w[n.wxid])==null?void 0:C.ExtraBuf,w}catch(w){return console.error("Error fetching data wxid2user :",w),[]}},h=async()=>{try{s.value=0;const S=await J(n.wxid);return s.value=S||0,S}catch(S){return console.error("Error fetching data msg_count:",S),[]}},m=()=>{k.value=!1,d(),h()};N(()=>{console.log("ChatRecprdsHeader onMounted",n.wxid),m()}),z(()=>n.wxid,async(S,M)=>{S!==M&&m()});const v=y(!1),g=y(!1),V=async()=>{if(g.value){console.log("正在获取实时消息，请稍后再试!");return}g.value=!0;try{const S=await ie();return g.value=!1,S}catch{return g.value=!1,[]}},k=y(!1),I=a,T=S=>{I("exporting",S),k.value=S};return(S,M)=>{const b=f("el-text"),L=f("el-col"),x=f("el-row"),U=f("el-dialog");return l(),u(H,null,[i(x,{gutter:5,style:{width:"100%"}},{default:_(()=>[i(L,{span:6,style:{"white-space":"nowrap"}},{default:_(()=>{var C;return[i(b,{class:"label_color mx-1",truncated:""},{default:_(()=>[r("wxid:")]),_:1}),r("  "),i(b,{class:"data_color mx-1",truncated:"",title:(C=o.value)==null?void 0:C.wxid},{default:_(()=>{var w;return[r(c((w=o.value)==null?void 0:w.wxid),1)]}),_:1},8,["title"])]}),_:1}),i(L,{span:6,style:{"white-space":"nowrap"}},{default:_(()=>[i(b,{class:"label_color mx-1",truncated:""},{default:_(()=>[r("名称:")]),_:1}),r("  "),i(b,{class:"data_color mx-1",truncated:"",title:"show_name"},{default:_(()=>[r(c(D(A)(o.value)),1)]),_:1})]),_:1}),i(L,{span:5,style:{"white-space":"nowrap"}},{default:_(()=>[i(b,{class:"label_color mx-1",truncated:""},{default:_(()=>[r("数量:")]),_:1}),r("  "),i(b,{class:"data_color mx-1",truncated:"",title:s.value},{default:_(()=>[r(c(s.value),1)]),_:1},8,["title"])]),_:1}),i(L,{span:2,style:{"white-space":"nowrap"}},{default:_(()=>[i(b,{class:"button_color mx-1 underline",truncated:"",onClick:M[0]||(M[0]=C=>v.value=!v.value)},{default:_(()=>[r(" 详细信息")]),_:1})]),_:1}),i(L,{span:2,style:{"white-space":"nowrap"}},{default:_(()=>[k.value?$("",!0):(l(),E(b,{key:0,class:"button_color mx-1 underline",truncated:"",onClick:M[1]||(M[1]=C=>{T(!0)})},{default:_(()=>[r("导出备份 ")]),_:1})),k.value?(l(),E(b,{key:1,class:"button_color mx-1 underline",truncated:"",onClick:M[2]||(M[2]=C=>{T(!1)})},{default:_(()=>[r("聊天查看 ")]),_:1})):$("",!0)]),_:1}),i(L,{span:3,style:{"white-space":"nowrap"}},{default:_(()=>[i(b,{class:"button_color mx-1 underline",truncated:"",onClick:M[3]||(M[3]=C=>{V()})},{default:_(()=>[r("实时消息 "),g.value?(l(),u(H,{key:0},[r("...")],64)):$("",!0)]),_:1})]),_:1})]),_:1}),i(U,{modelValue:v.value,"onUpdate:modelValue":M[4]||(M[4]=C=>v.value=C),title:"详细信息",width:"600",center:""},{default:_(()=>[i(X,{userinfo:o.value,show_all:!0},null,8,["userinfo"])]),_:1},8,["modelValue"])],64)}}}),at=q(rt,[["__scopeId","data-v-6d9df34e"]]),ct={class:"chat-content"},dt={key:0,class:"word"},ut=["src"],_t={class:"info"},ft={class:"time"},ht=["innerHTML"],mt={key:1,class:"word-my"},vt={class:"info"},pt={class:"time"},xt=["innerHTML"],yt=["src"],wt=B({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(e){const a=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,s)=>(l(),u("div",ct,[e.is_sender?(l(),u("div",mt,[t("div",vt,[t("p",pt,c(e.direction),1),t("div",{class:"info-content",innerHTML:a(e.content)},null,8,xt)]),t("img",{src:e.headUrl},null,8,yt)])):(l(),u("div",dt,[t("img",{src:e.headUrl},null,8,ut),t("div",_t,[t("p",ft,c(e.direction),1),t("div",{class:"info-content",innerHTML:a(e.content)},null,8,ht)])]))]))}}),gt=q(wt,[["__scopeId","data-v-522a25d5"]]),$t={class:"chat-content"},bt={key:0,class:"word"},kt=["src"],Et={class:"info"},St={class:"time"},Ut={class:"demo-image__preview"},Bt={key:1,class:"word-my"},Vt={class:"info"},Ct={class:"time"},Mt={class:"demo-image__preview"},It=["src"],Lt=B({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(a,n)=>{const s=f("el-image");return l(),u("div",$t,[e.is_sender?(l(),u("div",Bt,[t("div",Vt,[t("p",Ct,c(e.direction),1),t("div",Mt,[i(s,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,"hide-on-click-modal":!0,fit:"cover"},null,8,["src","preview-src-list"])])]),t("img",{src:e.headUrl},null,8,It)])):(l(),u("div",bt,[t("img",{src:e.headUrl},null,8,kt),t("div",Et,[t("p",St,c(e.direction),1),t("div",Ut,[i(s,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,"hide-on-click-modal":!0,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),zt=q(Lt,[["__scopeId","data-v-50919614"]]),Tt={class:"chat-content"},qt={key:0,class:"word"},Dt=["src"],Nt={class:"info"},jt={class:"time"},Ht={class:"demo-video__preview"},Rt={controls:"",width:"30%"},Ot=["src"],Ft={key:1,class:"word-my"},Pt={class:"info"},At={class:"time"},Wt={class:"demo-video__preview"},Kt={controls:"",width:"50%"},Jt=["src"],Xt=["src"],Gt=B({__name:"MessageVideo",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(a,n)=>(l(),u("div",Tt,[e.is_sender?(l(),u("div",Ft,[t("div",Pt,[t("p",At,c(e.direction),1),t("div",Wt,[t("video",Kt,[t("source",{src:e.src,type:"video/mp4"},null,8,Jt)])])]),t("img",{src:e.headUrl},null,8,Xt)])):(l(),u("div",qt,[t("img",{src:e.headUrl},null,8,Dt),t("div",Nt,[t("p",jt,c(e.direction),1),t("div",Ht,[t("video",Rt,[t("source",{src:e.src,type:"video/mp4"},null,8,Ot)])])])]))]))}}),Qt=q(Gt,[["__scopeId","data-v-aa7dcebf"]]),Yt={class:"chat-content"},Zt={key:0,class:"word"},en=["src"],tn={class:"info"},nn={class:"time"},ln={controls:"",style:{"background-color":"#fff"}},on=["src"],sn={key:1,class:"word-my"},rn={class:"info"},an={class:"time"},cn={controls:"",style:{"background-color":"#95EC69"}},dn=["src"],un=["src"],_n=B({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(e){return(a,n)=>(l(),u("div",Yt,[e.is_sender?(l(),u("div",sn,[t("div",rn,[t("p",an,c(e.direction),1),t("audio",cn,[t("source",{src:e.src,type:"audio/wav"},null,8,dn)]),i(D(F),{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])]),t("img",{src:e.headUrl},null,8,un)])):(l(),u("div",Zt,[t("img",{src:e.headUrl},null,8,en),t("div",tn,[t("p",nn,c(e.direction),1),t("audio",ln,[t("source",{src:e.src,type:"audio/wav"},null,8,on)]),i(D(F),{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),fn=q(_n,[["__scopeId","data-v-c9969dce"]]),hn={class:"chat-content"},mn={key:0,class:"word"},vn=["src"],pn={class:"info"},xn={class:"time"},yn={style:{float:"left"}},wn=["href"],gn={key:1,class:"word-my"},$n={class:"info"},bn={class:"time"},kn={style:{float:"right"}},En=["href"],Sn=["src"],Un=B({__name:"MessageFile",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){const a=e,n=y(""),s=ne({file_name:String,file_size:Number,file_size_unit:String});N(async()=>{console.log("文件加载中");const d=await o(a.src);s.file_name=d.file_name,s.file_size=Number(d.file_size)/1024,s.file_size<1024?s.file_size_unit="kb":(s.file_size=s.file_size/1024,s.file_size_unit="mb"),s.file_size=Number(d.file_size)/1024,n.value=`/api/file/${a.src}`});const o=async d=>{try{return await j.post("/api/rs/file_info",{file_path:d})}catch(h){return console.error("Error fetching file_info:",h),""}};return(d,h)=>{const m=f("el-card");return l(),u("div",hn,[e.is_sender?(l(),u("div",gn,[t("div",$n,[t("p",bn,c(e.direction),1),t("div",kn,[i(m,{shadow:"hover",style:{width:"fit-content"}},{default:_(()=>[r("文件 ： "),t("a",{href:n.value,download:""},c(s.file_name),9,En),t("div",null,[r(" 文件大小："),t("span",null,c(s.file_size)+c(s.file_size_unit),1)])]),_:1})])]),t("img",{src:e.headUrl},null,8,Sn)])):(l(),u("div",mn,[t("img",{src:e.headUrl},null,8,vn),t("div",pn,[t("p",xn,c(e.direction),1),t("div",yn,[i(m,{shadow:"hover",style:{width:"fit-content"}},{default:_(()=>[r("文件 ： "),t("a",{href:n.value,download:""},c(s.file_name),9,wn),t("div",null,[r(" 文件大小："),t("span",null,c(s.file_size)+c(s.file_size_unit),1)])]),_:1})])])]))])}}}),Bn=q(Un,[["__scopeId","data-v-d3aaee81"]]),Vn={class:"chat-content"},Cn={key:0,class:"word"},Mn=["src"],In={class:"info"},Ln={class:"time"},zn={class:"demo-image__preview"},Tn={key:1,class:"word-my"},qn={class:"info"},Dn={class:"time"},Nn={class:"demo-image__preview"},jn=["src"],Hn=B({__name:"MessageEmoji",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){return(a,n)=>{const s=f("el-image");return l(),u("div",Vn,[e.is_sender?(l(),u("div",Tn,[t("div",qn,[t("p",Dn,c(e.direction),1),t("div",Nn,[i(s,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),t("img",{src:e.headUrl},null,8,jn)])):(l(),u("div",Cn,[t("img",{src:e.headUrl},null,8,Mn),t("div",In,[t("p",Ln,c(e.direction),1),t("div",zn,[i(s,{style:{"max-width":"150px","max-height":"150px"},src:e.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[e.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Rn=q(Hn,[["__scopeId","data-v-4f39fede"]]),On={class:"chat-content"},Fn={key:0,class:"word"},Pn=["src"],An={class:"info"},Wn={class:"time"},Kn=["innerHTML"],Jn={key:1,class:"word-my"},Xn={class:"info"},Gn={class:"time"},Qn=["innerHTML"],Yn=["src"],Zn=B({__name:"MessageOther",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(e){const a=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,s)=>(l(),u("div",On,[e.is_sender?(l(),u("div",Jn,[t("div",Xn,[t("p",Gn,c(e.direction),1),t("div",{class:"info-content",innerHTML:a(e.content)},null,8,Qn)]),t("img",{src:e.headUrl},null,8,Yn)])):(l(),u("div",Fn,[t("img",{src:e.headUrl},null,8,Pn),t("div",An,[t("p",Wn,c(e.direction),1),t("div",{class:"info-content",innerHTML:a(e.content)},null,8,Kn)])]))]))}}),el=q(Zn,[["__scopeId","data-v-d66a86fc"]]),tl={key:0,id:"chat"},nl=["id"],ll=B({__name:"ChatRecordsMain",props:{wxid:{type:String,required:!0}},setup(e){const a=e,n=y([]),s=y({}),o=y(!1),d=y(""),h=y(0),m=y(100),v=y(0),g=y(0),V=y(0),k=x=>(x.talker=="我"&&(x.talker=d.value),`${(C=>{const w=s.value[C.talker];return(w==null?void 0:w.remark)||(w==null?void 0:w.nickname)||(w==null?void 0:w.account)||C.talker})(x)} [${x.type_name}] ${x.CreateTime}`),I=x=>(x.talker=="我"&&(x.talker=d.value),s.value.hasOwnProperty(x.talker)?O(s.value[x.talker].headImgUrl):""),T=async(x="")=>{if(o.value){console.log("正在获取消息，请稍后再试!");return}if(a.wxid==""){console.log("wxid 为空, 请检查!");return}try{o.value=!0,h.value<0&&(h.value=0),console.log("fetchData",a.wxid,h.value,m.value);const U=await ae(a.wxid,h.value,m.value);return n.value=U.msg_list,n.value.length==0?(o.value=!1,U):(s.value=Object.assign(s.value,U.user_list),n.value=n.value.filter((C,w,R)=>w===0||C.id!==R[w-1].id),n.value.sort((C,w)=>C.id-w.id),v.value=n.value[0].id,g.value=n.value[n.value.length-1].id,x=="top"?L(n.value[0].id):x=="bottom"&&L(n.value[n.value.length-1].id),o.value=!1,U)}catch(U){return o.value=!1,console.error("Error fetching data:",U),[]}},S=async()=>{try{n.value=[],s.value={},o.value=!1,h.value=0,m.value=m.value||100,v.value=0,g.value=0,d.value=await re(),V.value=await J(a.wxid),await T()}catch(x){return console.error("Error fetching data:",x),[]}};z(()=>a.wxid,(x,U)=>{console.log("username changed： ",U,x),S()}),z(()=>h.value,(x,U)=>{console.log("msg start changed： ",U,x),x>U?T("top"):T("bottom")}),N(()=>{S()});const M=x=>{m.value=x,T()},b=x=>{h.value=(x-1)*m.value},L=x=>{le(()=>{const U=document.getElementById(`message-${x}`);console.log(`scrollToId： message-${x}`),U&&U.scrollIntoView({behavior:"instant",block:"center"})})};return(x,U)=>{const C=f("el-main"),w=f("el-pagination"),R=f("el-footer"),G=f("el-container"),Q=f("el-empty");return n.value.length>0?(l(),u("div",tl,[i(G,{class:"chat-records-main-container"},{default:_(()=>[i(C,{class:"chat-records-main-main"},{default:_(()=>[(l(!0),u(H,null,W(n.value,(p,Y)=>(l(),u("div",{class:"message",key:Y,id:`message-${p.id}`},[p.type_name=="文本"?(l(),E(gt,{key:0,is_sender:p.is_sender,direction:k(p),headUrl:I(p),content:p.msg},null,8,["is_sender","direction","headUrl","content"])):p.type_name=="图片"?(l(),E(zt,{key:1,is_sender:p.is_sender,direction:k(p),headUrl:I(p),src:D(O)(p.src)},null,8,["is_sender","direction","headUrl","src"])):p.type_name=="动画表情"?(l(),E(Rn,{key:2,is_sender:p.is_sender,direction:k(p),headUrl:I(p),src:D(O)(p.src)},null,8,["is_sender","direction","headUrl","src"])):p.type_name=="视频"?(l(),E(Qt,{key:3,is_sender:p.is_sender,direction:k(p),headUrl:I(p),src:"/api/rs/video/"+p.src},null,8,["is_sender","direction","headUrl","src"])):p.type_name=="文件"?(l(),E(Bn,{key:4,is_sender:p.is_sender,direction:k(p),headUrl:I(p),src:p.src},null,8,["is_sender","direction","headUrl","src"])):p.type_name=="语音"?(l(),E(fn,{key:5,is_sender:p.is_sender,direction:k(p),headUrl:I(p),src:"/api/rs/"+p.src,msg:p.msg},null,8,["is_sender","direction","headUrl","src","msg"])):(l(),E(el,{key:6,is_sender:p.is_sender,direction:k(p),headUrl:I(p),content:p.msg},null,8,["is_sender","direction","headUrl","content"]))],8,nl))),128))]),_:1}),i(R,{height:"20px",class:"chat-records-main-footer"},{default:_(()=>[i(w,{background:"",small:"",layout:"sizes, prev, pager, next, jumper",total:V.value,"page-size":m.value,"page-sizes":[50,100,200,300,500],onSizeChange:M,"current-page":Math.floor(h.value/m.value+1),onCurrentChange:b},null,8,["total","page-size","current-page"])]),_:1})]),_:1})])):(l(),E(Q,{key:1,description:"无记录"}))}}}),ol=q(ll,[["__scopeId","data-v-73a20ec8"]]),sl=t("br",null,null,-1),il=t("br",null,null,-1),rl={style:{position:"relative"}},al=B({__name:"ExportENDB",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(d,h)=>{console.log(d)});const n=y(""),s=y(""),o=async()=>{s.value="请求中...";try{s.value=await j.post("/api/rs/export_endb",{wx_path:n.value})}catch(d){return console.error("Error fetching data msg_count:",d),s.value=`请求失败
`+d,[]}};return(d,h)=>{const m=f("el-input"),v=f("el-button"),g=f("el-divider");return l(),u("div",null,[r(" 微信文件夹路径(可选)： "),i(m,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":h[0]||(h[0]=V=>n.value=V),style:{width:"70%"}},null,8,["modelValue"]),sl,il,t("div",rl,[i(v,{type:"primary",onClick:h[1]||(h[1]=V=>o())},{default:_(()=>[r("导出")]),_:1})]),i(g),i(m,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:s.value,"onUpdate:modelValue":h[2]||(h[2]=V=>s.value=V),style:{width:"100%"}},null,8,["modelValue"])])}}}),cl=t("br",null,null,-1),dl=t("br",null,null,-1),ul=t("br",null,null,-1),_l=t("br",null,null,-1),fl={style:{position:"relative"}},hl=B({__name:"ExportDEDB",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(h,m)=>{console.log(h)});const n=y(""),s=y(""),o=y(""),d=async()=>{o.value="正在处理中...";try{o.value=await j.post("/api/rs/export_dedb",{key:s.value,wx_path:n.value})}catch(h){return console.error("Error fetching data msg_count:",h),o.value=`请求失败
`+h,[]}};return(h,m)=>{const v=f("el-input"),g=f("el-button"),V=f("el-divider");return l(),u("div",null,[r(" 密钥(可选)： "),i(v,{placeholder:"密钥[可为空,空表示使用默认的，无默认会报错]",modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=k=>s.value=k),style:{width:"75%"}},null,8,["modelValue"]),cl,dl,r(" 微信文件夹路径(可选)： "),i(v,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":m[1]||(m[1]=k=>n.value=k),style:{width:"70%"}},null,8,["modelValue"]),ul,_l,t("div",fl,[i(g,{type:"primary",onClick:m[2]||(m[2]=k=>d())},{default:_(()=>[r("导出")]),_:1})]),i(V),i(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:o.value,"onUpdate:modelValue":m[3]||(m[3]=k=>o.value=k),style:{width:"100%"}},null,8,["modelValue"])])}}}),ml={style:{position:"relative"}},vl=B({__name:"ExportCSV",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(o,d)=>{console.log(o)});const n=y(""),s=async()=>{n.value="正在处理中...";try{n.value=await j.post("/api/rs/export_csv",{wxid:a.wxid})}catch(o){return console.error("Error fetching data msg_count:",o),n.value=`请求失败
`+o,[]}};return(o,d)=>{const h=f("el-button"),m=f("el-divider"),v=f("el-input");return l(),u("div",null,[t("div",ml,[i(h,{type:"primary",onClick:d[0]||(d[0]=g=>s())},{default:_(()=>[r("导出")]),_:1})]),i(m),i(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=g=>n.value=g),style:{width:"100%"}},null,8,["modelValue"])])}}}),pl={style:{position:"relative"}},xl=B({__name:"ExportJSON",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(o,d)=>{console.log(o)}),y([]);const n=y(""),s=async()=>{n.value="正在处理中...";try{n.value=await j.post("/api/rs/export_json",{wxid:a.wxid})}catch(o){return console.error("Error fetching data msg_count:",o),n.value=`请求失败
`+o,[]}};return(o,d)=>{const h=f("el-button"),m=f("el-divider"),v=f("el-input");return l(),u("div",null,[t("div",pl,[i(h,{type:"primary",onClick:d[0]||(d[0]=g=>s())},{default:_(()=>[r("导出")]),_:1})]),i(m),i(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=g=>n.value=g),style:{width:"100%"}},null,8,["modelValue"])])}}}),yl={style:{position:"relative"}},wl=B({__name:"ExportHTML",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(o,d)=>{console.log(o)}),y([]);const n=y(""),s=async()=>{n.value="正在处理中...";try{n.value=await j.post("/api/rs/export_html",{wxid:a.wxid})}catch(o){return console.error("Error fetching data msg_count:",o),n.value=`请求失败
`+o,[]}};return(o,d)=>{const h=f("el-button"),m=f("el-divider"),v=f("el-input");return l(),u("div",null,[t("div",yl,[i(h,{type:"primary",onClick:d[0]||(d[0]=g=>s())},{default:_(()=>[r("导出")]),_:1})]),i(m),i(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=g=>n.value=g),style:{width:"100%"}},null,8,["modelValue"])])}}}),gl=t("br",null,null,-1),$l=B({__name:"ExportPDF",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(s,o)=>{console.log(s)});const n=()=>{console.log("requestExport")};return(s,o)=>{const d=f("el-button");return l(),u("div",null,[t("span",null,c(a.wxid),1),gl,i(d,{type:"primary",onClick:o[0]||(o[0]=h=>n())},{default:_(()=>[r("导出")]),_:1})])}}}),bl=t("br",null,null,-1),kl=B({__name:"ExportDOCX",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(s,o)=>{console.log(s)});const n=()=>{console.log("requestExport")};return(s,o)=>{const d=f("el-button");return l(),u("div",null,[t("span",null,c(a.wxid),1),bl,i(d,{type:"primary",onClick:o[0]||(o[0]=h=>n())},{default:_(()=>[r("导出")]),_:1})])}}}),El={id:"chat_export",style:{"background-color":"#d2d2fa",padding:"0"}},Sl={style:{"background-color":"#d2d2fa",height:"calc(100vh - 65px)",display:"grid","place-items":"center"}},Ul={style:{"background-color":"#fff",width:"70%",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},Bl=t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("div",{style:{"font-size":"20px","font-weight":"bold"}},"导出与备份(未完待续...）"),t("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),Vl={style:{"margin-top":"20px"}},Cl=t("br",null,null,-1),Ml=t("br",null,null,-1),Il={key:0},Ll=B({__name:"ChatExportMain",props:{wxid:{type:String,required:!0}},setup(e){const a=e;z(()=>a.wxid,(o,d)=>{console.log(o)});const n=y("");y("");const s={endb:{brief:"加密文件",detail:"导出的内容为微信加密数据库。可还原回微信,但会覆盖微信后续消息。(全程不解密，所以数据安全)"},dedb:{brief:"解密文件",detail:"导出的文件为解密后的sqlite数据库，并且会自动合并msg和media数据库为同一个，但是无法还原回微信。"},csv:{brief:"csv",detail:"只包含文本，但是可以用excel软件（wps，office）打开。"},json:{brief:"json",detail:"只包含文本，可用于数据分析，情感分析等方面。"},html:{brief:"html-开发中",detail:"主要用于浏览器可视化查看。"},pdf:{brief:"pdf-开发中",detail:"pdf版本。"},docx:{brief:"docx-开发中",detail:"docx版本。"}};return(o,d)=>{const h=f("el-option"),m=f("el-select"),v=f("el-divider"),g=f("el-main");return l(),u("div",El,[i(g,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:_(()=>[t("div",Sl,[t("div",Ul,[Bl,t("div",Vl,[r(" 导出类型: "),i(m,{placeholder:"请选择导出类型",style:{width:"50%"},modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=V=>n.value=V)},{default:_(()=>[(l(),u(H,null,W(s,(V,k)=>i(h,{label:V.brief,value:k,key:k},{default:_(()=>[r(c(V.brief),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"]),Cl,Ml,n.value?(l(),u("span",Il,c(s[n.value].detail),1)):$("",!0)]),i(v),n.value=="endb"?(l(),E(al,{key:0,wxid:a.wxid},null,8,["wxid"])):$("",!0),n.value=="dedb"?(l(),E(hl,{key:1,wxid:a.wxid},null,8,["wxid"])):$("",!0),n.value=="csv"?(l(),E(vl,{key:2,wxid:a.wxid},null,8,["wxid"])):$("",!0),n.value=="json"?(l(),E(xl,{key:3,wxid:a.wxid},null,8,["wxid"])):$("",!0),n.value=="html"?(l(),E(wl,{key:4,wxid:a.wxid},null,8,["wxid"])):$("",!0),n.value=="pdf"?(l(),E($l,{key:5,wxid:a.wxid},null,8,["wxid"])):$("",!0),n.value=="docx"?(l(),E(kl,{key:6,wxid:a.wxid},null,8,["wxid"])):$("",!0)])])]),_:1})])}}}),zl=B({__name:"ChatRecords",props:{wxid:{type:String,required:!0}},setup(e){const a=e,n=y(!1),s=d=>{n.value=d},o=()=>{n.value=!1};return z(()=>a.wxid,async(d,h)=>{d!==h&&o()}),N(()=>{o()}),(d,h)=>{const m=f("el-header"),v=f("el-main"),g=f("el-container");return l(),E(g,null,{default:_(()=>[i(m,{style:{height:"40px","max-height":"40px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:_(()=>[i(at,{wxid:e.wxid,onExporting:s},null,8,["wxid"])]),_:1}),i(v,{style:{height:"calc(100vh - 40px)",padding:"0",margin:"0","background-color":"#f5f5f5"}},{default:_(()=>[n.value?(l(),E(Ll,{key:0,wxid:e.wxid},null,8,["wxid"])):(l(),E(ol,{key:1,wxid:e.wxid},null,8,["wxid"]))]),_:1})]),_:1})}}}),Tl={id:"chat_view",class:"common-layout"},ql={key:0,style:{height:"calc(100vh)",width:"100%"}},Dl={key:1,style:{width:"100%",height:"100%"}},Fl=B({__name:"ChatView",setup(e){const a=y("");return N(()=>{oe().then(n=>{console.log("API version: "+n)}).catch(n=>{console.error("Error fetching API version:",n)}),se()}),(n,s)=>{const o=f("el-aside"),d=f("el-container");return l(),u("div",Tl,[t("div",null,[i(d,null,{default:_(()=>[i(o,{width:"auto",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:_(()=>[i(it,{onWxid:s[0]||(s[0]=h=>{a.value=h})})]),_:1}),a.value!=""?(l(),u("div",ql,[i(zl,{wxid:a.value},null,8,["wxid"])])):(l(),u("div",Dl,[i(ce)]))]),_:1})])])}}});export{Fl as default};
