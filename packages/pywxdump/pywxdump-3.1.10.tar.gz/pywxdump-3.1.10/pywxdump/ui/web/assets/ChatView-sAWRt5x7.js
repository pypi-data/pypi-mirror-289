import{d as S,h as f,o as l,b as u,e,i as s,w as _,f as i,t as c,c as k,j as g,r as x,a as N,k as Y,u as D,l as A,p as Z,m as ee,_ as T,n as z,F as H,q as F,s as te,v as j,x as W,y as O,z as ne,g as le,A as oe}from"./index-ePeAEpZg.js";import{a as P,b as K,c as se,d as J,e as ie,f as re}from"./chat-ppi-GoCG.js";/* empty css                                                                          *//* empty css                                                                       */import{_ as ae}from"./IndexView.vue_vue_type_script_setup_true_lang-xEb0Ck4F.js";const ce={key:0,style:{"max-width":"560px"}},de=e("br",null,null,-1),ue=e("br",null,null,-1),_e=e("br",null,null,-1),he=e("br",null,null,-1),fe=e("br",null,null,-1),me=e("br",null,null,-1),pe=e("br",null,null,-1),ve=e("br",null,null,-1),xe=e("br",null,null,-1),ye=e("br",null,null,-1),we=e("br",null,null,-1),ge=e("br",null,null,-1),$e=e("br",null,null,-1),be=e("br",null,null,-1),ke=e("span",null,[i("朋友圈背景："),e("br")],-1),Ee={key:1,style:{"max-width":"560px"}},Se=e("br",null,null,-1),Ue=e("br",null,null,-1),Ve=e("br",null,null,-1),Ce={key:0},Me=e("br",null,null,-1),Be={key:1},Ie=e("br",null,null,-1),ze={key:2},Le=e("br",null,null,-1),Te={key:3},qe=e("br",null,null,-1),De={key:4},Ne=e("br",null,null,-1),je={key:5},He=e("br",null,null,-1),Re={key:6},Oe=e("br",null,null,-1),Fe={key:7},Pe=e("br",null,null,-1),Ae={key:8},We=e("br",null,null,-1),Ke={key:9},Je=e("br",null,null,-1),Xe={key:10},Ge=e("br",null,null,-1),Qe={key:11},Ye=e("br",null,null,-1),X=S({__name:"UserInfoShow",props:{userinfo:{type:Object,default:()=>({})},show_all:{type:Boolean,default:!0,required:!1}},setup(t){return(a,n)=>{const o=f("el-divider"),r=f("el-image");return t.show_all?(l(),u("div",ce,[e("div",null,[s(o,{"content-position":"center"},{default:_(()=>[i("基本信息")]),_:1}),e("span",null,[i("wxid："+c(t.userinfo.wxid),1),de]),e("span",null,[i("账号："+c(t.userinfo.account),1),ue]),e("span",null,[i("昵称："+c(t.userinfo.nickname),1),_e]),e("span",null,[i("备注："+c(t.userinfo.remark),1),he])]),e("div",null,[s(o,{"content-position":"center"},{default:_(()=>[i("个人信息")]),_:1}),e("span",null,[i("性别："+c(t.userinfo.ExtraBuf["性别[1男2女]"]==1?"男":t.userinfo.ExtraBuf["性别[1男2女]"]==2?"女":""),1),fe]),e("span",null,[i("手机："+c(t.userinfo.ExtraBuf.手机号),1),me]),e("span",null,[i("标签："+c(t.userinfo.LabelIDList.join("/")),1),pe]),e("span",null,[i("描述："+c(t.userinfo.describe),1),ve]),e("span",null,[i("个签："+c(t.userinfo.ExtraBuf.个性签名),1),xe]),e("span",null,[i("国家："+c(t.userinfo.ExtraBuf.国),1),ye]),e("span",null,[i("省份："+c(t.userinfo.ExtraBuf.省),1),we]),e("span",null,[i("市名："+c(t.userinfo.ExtraBuf.市),1),ge])]),e("div",null,[s(o,{"content-position":"center"},{default:_(()=>[i("其他信息")]),_:1}),e("span",null,[i("公司："+c(t.userinfo.ExtraBuf.公司名称),1),$e]),e("span",null,[i("企微："+c(t.userinfo.ExtraBuf.企微属性),1),be]),ke,t.userinfo.ExtraBuf.朋友圈背景?(l(),k(r,{key:0,src:"/api/rs/imgsrc/"+t.userinfo.ExtraBuf.朋友圈背景,style:{"max-width":"200px","max-height":"200px"},alt:"朋友圈背景"},null,8,["src"])):g("",!0)])])):(l(),u("div",Ee,[e("span",null,[i("wxid："+c(t.userinfo.wxid),1),Se]),e("span",null,[i("账号："+c(t.userinfo.account),1),Ue]),e("span",null,[i("昵称："+c(t.userinfo.nickname),1),Ve]),t.userinfo.remark?(l(),u("span",Ce,[i("备注："+c(t.userinfo.remark),1),Me])):g("",!0),t.userinfo.ExtraBuf["性别[1男2女]"]?(l(),u("span",Be,[i("性别："+c(t.userinfo.ExtraBuf["性别[1男2女]"]==1?"男":t.userinfo.ExtraBuf["性别[1男2女]"]==2?"女":""),1),Ie])):g("",!0),t.userinfo.ExtraBuf.手机号?(l(),u("span",ze,[i("手机："+c(t.userinfo.ExtraBuf.手机号),1),Le])):g("",!0),t.userinfo.LabelIDList&&t.userinfo.LabelIDList.length>0?(l(),u("span",Te,[i("标签："+c(t.userinfo.LabelIDList.join("/")),1),qe])):g("",!0),t.userinfo.describe?(l(),u("span",De,[i("描述："+c(t.userinfo.describe),1),Ne])):g("",!0),t.userinfo.ExtraBuf.个性签名?(l(),u("span",je,[i("个签："+c(t.userinfo.ExtraBuf.个性签名),1),He])):g("",!0),t.userinfo.ExtraBuf.国?(l(),u("span",Re,[i("国家："+c(t.userinfo.ExtraBuf.国),1),Oe])):g("",!0),t.userinfo.ExtraBuf.省?(l(),u("span",Fe,[i("省份："+c(t.userinfo.ExtraBuf.省),1),Pe])):g("",!0),t.userinfo.ExtraBuf.市?(l(),u("span",Ae,[i("市名："+c(t.userinfo.ExtraBuf.市),1),We])):g("",!0),t.userinfo.ExtraBuf.公司名称?(l(),u("span",Ke,[i("公司："+c(t.userinfo.ExtraBuf.公司名称),1),Je])):g("",!0),t.userinfo.ExtraBuf.企微属性?(l(),u("span",Xe,[i("企微："+c(t.userinfo.ExtraBuf.企微属性),1),Ge])):g("",!0),t.userinfo.ExtraBuf.朋友圈背景?(l(),u("span",Qe,[i("朋友圈背景："),Ye])):g("",!0),t.userinfo.ExtraBuf.朋友圈背景?(l(),k(r,{key:12,src:"/api/rs/imgsrc/"+t.userinfo.ExtraBuf.朋友圈背景,style:{"max-width":"200px","max-height":"200px"},alt:"朋友圈背景"},null,8,["src"])):g("",!0)]))}}}),Ze=t=>(Z("data-v-a26d5cf5"),t=t(),ee(),t),et={style:{padding:"10px 10px"}},tt={slot:"content",class:"tips"},nt=Ze(()=>e("br",null,null,-1)),lt={key:0,style:{color:"#909399","font-size":"12px"}},ot=S({__name:"ContactsList",emits:["wxid"],setup(t,{emit:a}){const n=x([]);N(async()=>{try{n.value=await P()}catch(p){return console.error("Error fetching data:",p),[]}});const r=x(""),d=async()=>{try{if(r.value===""){n.value=await P();return}console.log(r.value),n.value=[];const p=await K(r.value);p!==null&&typeof p=="object"&&Object.entries(p).forEach(([w,U])=>{n.value.push(U)})}catch(p){return console.error("Error fetching data:",p),[]}},h=a,m=p=>{p!==void 0&&p.wxid!==void 0&&h("wxid",p.wxid)};return(p,w)=>{const U=f("el-input"),$=f("el-button"),I=f("el-avatar"),L=f("el-table-column"),b=f("el-tooltip"),C=f("el-table");return l(),u("div",null,[e("div",et,[s(U,{placeholder:"请输入关键字",modelValue:r.value,"onUpdate:modelValue":w[0]||(w[0]=E=>r.value=E),onKeyup:Y(d,["enter"]),style:{width:"170px","margin-left":"15px"}},null,8,["modelValue"]),s($,{type:"primary",onClick:d,style:{width:"50px"}},{default:_(()=>[i("搜索")]),_:1})]),s(C,{data:n.value,stripe:"",style:{width:"100%"},"max-height":"100%",height:"100%","highlight-current-row":"",onCurrentChange:m},{default:_(()=>[s(L,{width:"57"},{default:_(({row:E})=>[E.headImgUrl!==""?(l(),k(I,{key:0,size:33,src:"/api/rs/imgsrc/"+E.headImgUrl},null,8,["src"])):(l(),k(I,{key:1,size:33},{default:_(()=>[i(" 群")]),_:1}))]),_:1}),s(L,{width:"190"},{default:_(({row:E})=>[s(b,{class:"item",effect:"light",placement:"right"},{content:_(()=>[s(X,{userinfo:E,show_all:!1,style:{"max-width":"600px"}},null,8,["userinfo"])]),default:_(()=>[e("div",tt,[e("span",null,c(D(A)(E)),1),i(),nt,E.nTime?(l(),u("span",lt,c(E.nTime),1)):g("",!0)])]),_:2},1024)]),_:1})]),_:1},8,["data"])])}}}),st=T(ot,[["__scopeId","data-v-a26d5cf5"]]),it=S({__name:"ChatRecprdsHeader",props:{wxid:{type:String,required:!0}},emits:["exporting"],setup(t,{emit:a}){const n=t,o=x(0),r=x({wxid:"",nOrder:0,nUnReadCount:0,strNickName:"",nStatus:0,nIsSend:0,strContent:"",nMsgLocalID:0,nMsgStatus:0,nTime:"",nMsgType:0,nMsgSubType:0,nickname:"",remark:"",account:"",describe:"",headImgUrl:"",ExtraBuf:{个性签名:"",企微属性:"",公司名称:"",国:"",备注图片:"",备注图片2:"",市:"","性别[1男2女]":0,手机号:"",朋友圈背景:"",省:""},LabelIDList:[]}),d=async()=>{try{const b=await K("",[n.wxid]);return r.value=b[n.wxid],r.value.wxid=n.wxid,b}catch(b){return console.error("Error fetching data wxid2user :",b),[]}},h=async()=>{try{o.value=0;const b=await J(n.wxid);return o.value=b,b}catch(b){return console.error("Error fetching data msg_count:",b),[]}},m=()=>{$.value=!1,d(),h()};N(()=>{m()}),z(()=>n.wxid,async(b,C)=>{b!==C&&m()});const p=x(!1),w=x(!1),U=async()=>{if(w.value){console.log("正在获取实时消息，请稍后再试!");return}w.value=!0;try{const b=await se();return w.value=!1,b}catch{return w.value=!1,[]}},$=x(!1),I=a,L=b=>{I("exporting",b),$.value=b};return(b,C)=>{const E=f("el-text"),q=f("el-col"),y=f("el-row"),V=f("el-dialog");return l(),u(H,null,[s(y,{gutter:5,style:{width:"100%"}},{default:_(()=>[s(q,{span:6,style:{"white-space":"nowrap"}},{default:_(()=>[s(E,{class:"label_color mx-1",truncated:""},{default:_(()=>[i("wxid:")]),_:1}),i("  "),s(E,{class:"data_color mx-1",truncated:"",title:r.value.wxid},{default:_(()=>[i(c(r.value.wxid),1)]),_:1},8,["title"])]),_:1}),s(q,{span:6,style:{"white-space":"nowrap"}},{default:_(()=>[s(E,{class:"label_color mx-1",truncated:""},{default:_(()=>[i("名称:")]),_:1}),i("  "),s(E,{class:"data_color mx-1",truncated:"",title:"show_name"},{default:_(()=>[i(c(D(A)(r.value)),1)]),_:1})]),_:1}),s(q,{span:5,style:{"white-space":"nowrap"}},{default:_(()=>[s(E,{class:"label_color mx-1",truncated:""},{default:_(()=>[i("数量:")]),_:1}),i("  "),s(E,{class:"data_color mx-1",truncated:"",title:o.value},{default:_(()=>[i(c(o.value),1)]),_:1},8,["title"])]),_:1}),s(q,{span:2,style:{"white-space":"nowrap"}},{default:_(()=>[s(E,{class:"button_color mx-1 underline",truncated:"",onClick:C[0]||(C[0]=B=>p.value=!p.value)},{default:_(()=>[i(" 详细信息")]),_:1})]),_:1}),s(q,{span:2,style:{"white-space":"nowrap"}},{default:_(()=>[$.value?g("",!0):(l(),k(E,{key:0,class:"button_color mx-1 underline",truncated:"",onClick:C[1]||(C[1]=B=>{L(!0)})},{default:_(()=>[i("导出备份 ")]),_:1})),$.value?(l(),k(E,{key:1,class:"button_color mx-1 underline",truncated:"",onClick:C[2]||(C[2]=B=>{L(!1)})},{default:_(()=>[i("聊天查看 ")]),_:1})):g("",!0)]),_:1}),s(q,{span:3,style:{"white-space":"nowrap"}},{default:_(()=>[s(E,{class:"button_color mx-1 underline",truncated:"",onClick:C[3]||(C[3]=B=>{U()})},{default:_(()=>[i("实时消息 "),w.value?(l(),u(H,{key:0},[i("...")],64)):g("",!0)]),_:1})]),_:1})]),_:1}),s(V,{modelValue:p.value,"onUpdate:modelValue":C[4]||(C[4]=B=>p.value=B),title:"详细信息",width:"600",center:""},{default:_(()=>[s(X,{userinfo:r.value,show_all:!0},null,8,["userinfo"])]),_:1},8,["modelValue"])],64)}}}),rt=T(it,[["__scopeId","data-v-51a93461"]]),at={class:"chat-content"},ct={key:0,class:"word"},dt=["src"],ut={class:"info"},_t={class:"time"},ht=["innerHTML"],ft={key:1,class:"word-my"},mt={class:"info"},pt={class:"time"},vt=["innerHTML"],xt=["src"],yt=S({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const a=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,o)=>(l(),u("div",at,[t.is_sender?(l(),u("div",ft,[e("div",mt,[e("p",pt,c(t.direction),1),e("div",{class:"info-content",innerHTML:a(t.content)},null,8,vt)]),e("img",{src:t.headUrl},null,8,xt)])):(l(),u("div",ct,[e("img",{src:t.headUrl},null,8,dt),e("div",ut,[e("p",_t,c(t.direction),1),e("div",{class:"info-content",innerHTML:a(t.content)},null,8,ht)])]))]))}}),wt=T(yt,[["__scopeId","data-v-522a25d5"]]),gt={class:"chat-content"},$t={key:0,class:"word"},bt=["src"],kt={class:"info"},Et={class:"time"},St={class:"demo-image__preview"},Ut={key:1,class:"word-my"},Vt={class:"info"},Ct={class:"time"},Mt={class:"demo-image__preview"},Bt=["src"],It=S({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(a,n)=>{const o=f("el-image");return l(),u("div",gt,[t.is_sender?(l(),u("div",Ut,[e("div",Vt,[e("p",Ct,c(t.direction),1),e("div",Mt,[s(o,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,"hide-on-click-modal":!0,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:t.headUrl},null,8,Bt)])):(l(),u("div",$t,[e("img",{src:t.headUrl},null,8,bt),e("div",kt,[e("p",Et,c(t.direction),1),e("div",St,[s(o,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,"hide-on-click-modal":!0,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),zt=T(It,[["__scopeId","data-v-50919614"]]),Lt={class:"chat-content"},Tt={key:0,class:"word"},qt=["src"],Dt={class:"info"},Nt={class:"time"},jt={class:"demo-video__preview"},Ht={controls:"",width:"30%"},Rt=["src"],Ot={key:1,class:"word-my"},Ft={class:"info"},Pt={class:"time"},At={class:"demo-video__preview"},Wt={controls:"",width:"50%"},Kt=["src"],Jt=["src"],Xt=S({__name:"MessageVideo",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(a,n)=>(l(),u("div",Lt,[t.is_sender?(l(),u("div",Ot,[e("div",Ft,[e("p",Pt,c(t.direction),1),e("div",At,[e("video",Wt,[e("source",{src:t.src,type:"video/mp4"},null,8,Kt)])])]),e("img",{src:t.headUrl},null,8,Jt)])):(l(),u("div",Tt,[e("img",{src:t.headUrl},null,8,qt),e("div",Dt,[e("p",Nt,c(t.direction),1),e("div",jt,[e("video",Ht,[e("source",{src:t.src,type:"video/mp4"},null,8,Rt)])])])]))]))}}),Gt=T(Xt,[["__scopeId","data-v-aa7dcebf"]]),Qt={class:"chat-content"},Yt={key:0,class:"word"},Zt=["src"],en={class:"info"},tn={class:"time"},nn={controls:"",style:{"background-color":"#fff"}},ln=["src"],on={key:1,class:"word-my"},sn={class:"info"},rn={class:"time"},an={controls:"",style:{"background-color":"#95EC69"}},cn=["src"],dn=["src"],un=S({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(t){return(a,n)=>(l(),u("div",Qt,[t.is_sender?(l(),u("div",on,[e("div",sn,[e("p",rn,c(t.direction),1),e("audio",an,[e("source",{src:t.src,type:"audio/wav"},null,8,cn)]),s(D(F),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])]),e("img",{src:t.headUrl},null,8,dn)])):(l(),u("div",Yt,[e("img",{src:t.headUrl},null,8,Zt),e("div",en,[e("p",tn,c(t.direction),1),e("audio",nn,[e("source",{src:t.src,type:"audio/wav"},null,8,ln)]),s(D(F),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),_n=T(un,[["__scopeId","data-v-c9969dce"]]),hn={class:"chat-content"},fn={key:0,class:"word"},mn=["src"],pn={class:"info"},vn={class:"time"},xn={style:{float:"left"}},yn=["href"],wn={key:1,class:"word-my"},gn={class:"info"},$n={class:"time"},bn={style:{float:"right"}},kn=["href"],En=["src"],Sn=S({__name:"MessageFile",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){const a=t,n=x(""),o=te({file_name:String,file_size:Number,file_size_unit:String});N(async()=>{console.log("文件加载中");const d=await r(a.src);o.file_name=d.file_name,o.file_size=Number(d.file_size)/1024,o.file_size<1024?o.file_size_unit="kb":(o.file_size=o.file_size/1024,o.file_size_unit="mb"),o.file_size=Number(d.file_size)/1024,n.value=`/api/file/${a.src}`});const r=async d=>{try{return await j.post("/api/rs/file_info",{file_path:d})}catch(h){return console.error("Error fetching file_info:",h),""}};return(d,h)=>{const m=f("el-card");return l(),u("div",hn,[t.is_sender?(l(),u("div",wn,[e("div",gn,[e("p",$n,c(t.direction),1),e("div",bn,[s(m,{shadow:"hover",style:{width:"fit-content"}},{default:_(()=>[i("文件 ： "),e("a",{href:n.value,download:""},c(o.file_name),9,kn),e("div",null,[i(" 文件大小："),e("span",null,c(o.file_size)+c(o.file_size_unit),1)])]),_:1})])]),e("img",{src:t.headUrl},null,8,En)])):(l(),u("div",fn,[e("img",{src:t.headUrl},null,8,mn),e("div",pn,[e("p",vn,c(t.direction),1),e("div",xn,[s(m,{shadow:"hover",style:{width:"fit-content"}},{default:_(()=>[i("文件 ： "),e("a",{href:n.value,download:""},c(o.file_name),9,yn),e("div",null,[i(" 文件大小："),e("span",null,c(o.file_size)+c(o.file_size_unit),1)])]),_:1})])])]))])}}}),Un=T(Sn,[["__scopeId","data-v-d3aaee81"]]),Vn={class:"chat-content"},Cn={key:0,class:"word"},Mn=["src"],Bn={class:"info"},In={class:"time"},zn={class:"demo-image__preview"},Ln={key:1,class:"word-my"},Tn={class:"info"},qn={class:"time"},Dn={class:"demo-image__preview"},Nn=["src"],jn=S({__name:"MessageEmoji",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(a,n)=>{const o=f("el-image");return l(),u("div",Vn,[t.is_sender?(l(),u("div",Ln,[e("div",Tn,[e("p",qn,c(t.direction),1),e("div",Dn,[s(o,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:t.headUrl},null,8,Nn)])):(l(),u("div",Cn,[e("img",{src:t.headUrl},null,8,Mn),e("div",Bn,[e("p",In,c(t.direction),1),e("div",zn,[s(o,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Hn=T(jn,[["__scopeId","data-v-4f39fede"]]),Rn={class:"chat-content"},On={key:0,class:"word"},Fn=["src"],Pn={class:"info"},An={class:"time"},Wn=["innerHTML"],Kn={key:1,class:"word-my"},Jn={class:"info"},Xn={class:"time"},Gn=["innerHTML"],Qn=["src"],Yn=S({__name:"MessageOther",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const a=n=>(n=n.replace(/\n/g,"<br>"),new DOMParser().parseFromString(n,"text/html").body.innerHTML);return(n,o)=>(l(),u("div",Rn,[t.is_sender?(l(),u("div",Kn,[e("div",Jn,[e("p",Xn,c(t.direction),1),e("div",{class:"info-content",innerHTML:a(t.content)},null,8,Gn)]),e("img",{src:t.headUrl},null,8,Qn)])):(l(),u("div",On,[e("img",{src:t.headUrl},null,8,Fn),e("div",Pn,[e("p",An,c(t.direction),1),e("div",{class:"info-content",innerHTML:a(t.content)},null,8,Wn)])]))]))}}),Zn=T(Yn,[["__scopeId","data-v-d66a86fc"]]),el={id:"chat"},tl=["id"],nl=S({__name:"ChatRecordsMain",props:{wxid:{type:String,required:!0}},setup(t){const a=t,n=x([]),o=x({}),r=x(!1),d=x(""),h=x(0),m=x(100),p=x(0),w=x(0),U=x(0),$=y=>(y.talker=="我"&&(y.talker=d.value),`${(B=>{const M=o.value[B.talker];return(M==null?void 0:M.remark)||(M==null?void 0:M.nickname)||(M==null?void 0:M.account)||B.talker})(y)} [${y.type_name}] ${y.CreateTime}`),I=y=>(y.talker=="我"&&(y.talker=d.value),o.value.hasOwnProperty(y.talker)?O(o.value[y.talker].headImgUrl):""),L=async(y="")=>{if(r.value){console.log("正在获取消息，请稍后再试!");return}if(a.wxid==""){console.log("wxid 为空, 请检查!");return}try{r.value=!0,h.value<0&&(h.value=0),console.log("fetchData",a.wxid,h.value,m.value);const V=await re(a.wxid,h.value,m.value);return n.value=V.msg_list,o.value=Object.assign(o.value,V.user_list),n.value=n.value.filter((B,M,R)=>M===0||B.id!==R[M-1].id),n.value.sort((B,M)=>B.id-M.id),p.value=n.value[0].id,w.value=n.value[n.value.length-1].id,y=="top"?q(n.value[0].id):y=="bottom"&&q(n.value[n.value.length-1].id),r.value=!1,V}catch(V){return r.value=!1,console.error("Error fetching data:",V),[]}},b=async()=>{try{n.value=[],o.value={},r.value=!1,h.value=0,m.value=m.value||100,p.value=0,w.value=0,d.value=await ie(),U.value=await J(a.wxid),await L()}catch(y){return console.error("Error fetching data:",y),[]}};z(()=>a.wxid,(y,V)=>{console.log("username changed： ",V,y),b()}),z(()=>h.value,(y,V)=>{console.log("msg start changed： ",V,y),y>V?L("top"):L("bottom")}),N(()=>{b()});const C=y=>{m.value=y,L()},E=y=>{h.value=(y-1)*m.value},q=y=>{ne(()=>{const V=document.getElementById(`message-${y}`);console.log(`scrollToId： message-${y}`),V&&V.scrollIntoView({behavior:"instant",block:"center"})})};return(y,V)=>{const B=f("el-main"),M=f("el-pagination"),R=f("el-footer"),G=f("el-container");return l(),u("div",el,[s(G,{class:"chat-records-main-container"},{default:_(()=>[s(B,{class:"chat-records-main-main"},{default:_(()=>[(l(!0),u(H,null,W(n.value,(v,Q)=>(l(),u("div",{class:"message",key:Q,id:`message-${v.id}`},[v.type_name=="文本"?(l(),k(wt,{key:0,is_sender:v.is_sender,direction:$(v),headUrl:I(v),content:v.msg},null,8,["is_sender","direction","headUrl","content"])):v.type_name=="图片"?(l(),k(zt,{key:1,is_sender:v.is_sender,direction:$(v),headUrl:I(v),src:D(O)(v.src)},null,8,["is_sender","direction","headUrl","src"])):v.type_name=="动画表情"?(l(),k(Hn,{key:2,is_sender:v.is_sender,direction:$(v),headUrl:I(v),src:D(O)(v.src)},null,8,["is_sender","direction","headUrl","src"])):v.type_name=="视频"?(l(),k(Gt,{key:3,is_sender:v.is_sender,direction:$(v),headUrl:I(v),src:"/api/rs/video/"+v.src},null,8,["is_sender","direction","headUrl","src"])):v.type_name=="文件"?(l(),k(Un,{key:4,is_sender:v.is_sender,direction:$(v),headUrl:I(v),src:v.src},null,8,["is_sender","direction","headUrl","src"])):v.type_name=="语音"?(l(),k(_n,{key:5,is_sender:v.is_sender,direction:$(v),headUrl:I(v),src:"/api/rs/"+v.src,msg:v.msg},null,8,["is_sender","direction","headUrl","src","msg"])):(l(),k(Zn,{key:6,is_sender:v.is_sender,direction:$(v),headUrl:I(v),content:v.msg},null,8,["is_sender","direction","headUrl","content"]))],8,tl))),128))]),_:1}),s(R,{height:"20px",class:"chat-records-main-footer"},{default:_(()=>[s(M,{background:"",small:"",layout:"sizes, prev, pager, next, jumper",total:U.value,"page-size":m.value,"page-sizes":[50,100,200,300,500],onSizeChange:C,"current-page":Math.floor(h.value/m.value+1),onCurrentChange:E},null,8,["total","page-size","current-page"])]),_:1})]),_:1})])}}}),ll=T(nl,[["__scopeId","data-v-55806267"]]),ol=e("br",null,null,-1),sl=e("br",null,null,-1),il={style:{position:"relative"}},rl=S({__name:"ExportENDB",props:{wxid:{type:String,required:!0}},setup(t){const a=t;z(()=>a.wxid,(d,h)=>{console.log(d)});const n=x(""),o=x(""),r=async()=>{o.value="请求中...";try{o.value=await j.post("/api/rs/export_endb",{wx_path:n.value})}catch(d){return console.error("Error fetching data msg_count:",d),o.value=`请求失败
`+d,[]}};return(d,h)=>{const m=f("el-input"),p=f("el-button"),w=f("el-divider");return l(),u("div",null,[i(" 微信文件夹路径(可选)： "),s(m,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":h[0]||(h[0]=U=>n.value=U),style:{width:"70%"}},null,8,["modelValue"]),ol,sl,e("div",il,[s(p,{type:"primary",onClick:h[1]||(h[1]=U=>r())},{default:_(()=>[i("导出")]),_:1})]),s(w),s(m,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:o.value,"onUpdate:modelValue":h[2]||(h[2]=U=>o.value=U),style:{width:"100%"}},null,8,["modelValue"])])}}}),al=e("br",null,null,-1),cl=e("br",null,null,-1),dl=e("br",null,null,-1),ul=e("br",null,null,-1),_l={style:{position:"relative"}},hl=S({__name:"ExportDEDB",props:{wxid:{type:String,required:!0}},setup(t){const a=t;z(()=>a.wxid,(h,m)=>{console.log(h)});const n=x(""),o=x(""),r=x(""),d=async()=>{r.value="正在处理中...";try{r.value=await j.post("/api/rs/export_dedb",{key:o.value,wx_path:n.value})}catch(h){return console.error("Error fetching data msg_count:",h),r.value=`请求失败
`+h,[]}};return(h,m)=>{const p=f("el-input"),w=f("el-button"),U=f("el-divider");return l(),u("div",null,[i(" 密钥(可选)： "),s(p,{placeholder:"密钥[可为空,空表示使用默认的，无默认会报错]",modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=$=>o.value=$),style:{width:"75%"}},null,8,["modelValue"]),al,cl,i(" 微信文件夹路径(可选)： "),s(p,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:n.value,"onUpdate:modelValue":m[1]||(m[1]=$=>n.value=$),style:{width:"70%"}},null,8,["modelValue"]),dl,ul,e("div",_l,[s(w,{type:"primary",onClick:m[2]||(m[2]=$=>d())},{default:_(()=>[i("导出")]),_:1})]),s(U),s(p,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:r.value,"onUpdate:modelValue":m[3]||(m[3]=$=>r.value=$),style:{width:"100%"}},null,8,["modelValue"])])}}}),fl={style:{position:"relative"}},ml=S({__name:"ExportCSV",props:{wxid:{type:String,required:!0}},setup(t){const a=t;z(()=>a.wxid,(r,d)=>{console.log(r)});const n=x(""),o=async()=>{n.value="正在处理中...";try{n.value=await j.post("/api/rs/export_csv",{wxid:a.wxid})}catch(r){return console.error("Error fetching data msg_count:",r),n.value=`请求失败
`+r,[]}};return(r,d)=>{const h=f("el-button"),m=f("el-divider"),p=f("el-input");return l(),u("div",null,[e("div",fl,[s(h,{type:"primary",onClick:d[0]||(d[0]=w=>o())},{default:_(()=>[i("导出")]),_:1})]),s(m),s(p,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=w=>n.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),pl={style:{position:"relative"}},vl=S({__name:"ExportJSON",props:{wxid:{type:String,required:!0}},setup(t){const a=t;z(()=>a.wxid,(r,d)=>{console.log(r)}),x([]);const n=x(""),o=async()=>{n.value="正在处理中...";try{n.value=await j.post("/api/rs/export_json",{wxid:a.wxid})}catch(r){return console.error("Error fetching data msg_count:",r),n.value=`请求失败
`+r,[]}};return(r,d)=>{const h=f("el-button"),m=f("el-divider"),p=f("el-input");return l(),u("div",null,[e("div",pl,[s(h,{type:"primary",onClick:d[0]||(d[0]=w=>o())},{default:_(()=>[i("导出")]),_:1})]),s(m),s(p,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=w=>n.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),xl={style:{position:"relative"}},yl=S({__name:"ExportHTML",props:{wxid:{type:String,required:!0}},setup(t){const a=t;z(()=>a.wxid,(r,d)=>{console.log(r)}),x([]);const n=x(""),o=async()=>{n.value="正在处理中...";try{n.value=await j.post("/api/rs/export_html",{wxid:a.wxid})}catch(r){return console.error("Error fetching data msg_count:",r),n.value=`请求失败
`+r,[]}};return(r,d)=>{const h=f("el-button"),m=f("el-divider"),p=f("el-input");return l(),u("div",null,[e("div",xl,[s(h,{type:"primary",onClick:d[0]||(d[0]=w=>o())},{default:_(()=>[i("导出")]),_:1})]),s(m),s(p,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=w=>n.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),wl=e("br",null,null,-1),gl=S({__name:"ExportPDF",props:{wxid:{type:String,required:!0}},setup(t){const a=t;z(()=>a.wxid,(o,r)=>{console.log(o)});const n=()=>{console.log("requestExport")};return(o,r)=>{const d=f("el-button");return l(),u("div",null,[e("span",null,c(a.wxid),1),wl,s(d,{type:"primary",onClick:r[0]||(r[0]=h=>n())},{default:_(()=>[i("导出")]),_:1})])}}}),$l=e("br",null,null,-1),bl=S({__name:"ExportDOCX",props:{wxid:{type:String,required:!0}},setup(t){const a=t;z(()=>a.wxid,(o,r)=>{console.log(o)});const n=()=>{console.log("requestExport")};return(o,r)=>{const d=f("el-button");return l(),u("div",null,[e("span",null,c(a.wxid),1),$l,s(d,{type:"primary",onClick:r[0]||(r[0]=h=>n())},{default:_(()=>[i("导出")]),_:1})])}}}),kl={id:"chat_export",style:{"background-color":"#d2d2fa",padding:"0"}},El={style:{"background-color":"#d2d2fa",height:"calc(100vh - 65px)",display:"grid","place-items":"center"}},Sl={style:{"background-color":"#fff",width:"70%",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},Ul=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"导出与备份(未完待续...）"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),Vl={style:{"margin-top":"20px"}},Cl=e("br",null,null,-1),Ml=e("br",null,null,-1),Bl={key:0},Il=S({__name:"ChatExportMain",props:{wxid:{type:String,required:!0}},setup(t){const a=t;z(()=>a.wxid,(r,d)=>{console.log(r)});const n=x("");x("");const o={endb:{brief:"加密文件",detail:"导出的内容为微信加密数据库。可还原回微信,但会覆盖微信后续消息。(全程不解密，所以数据安全)"},dedb:{brief:"解密文件",detail:"导出的文件为解密后的sqlite数据库，并且会自动合并msg和media数据库为同一个，但是无法还原回微信。"},csv:{brief:"csv",detail:"只包含文本，但是可以用excel软件（wps，office）打开。"},json:{brief:"json",detail:"只包含文本，可用于数据分析，情感分析等方面。"},html:{brief:"html-开发中",detail:"主要用于浏览器可视化查看。"},pdf:{brief:"pdf-开发中",detail:"pdf版本。"},docx:{brief:"docx-开发中",detail:"docx版本。"}};return(r,d)=>{const h=f("el-option"),m=f("el-select"),p=f("el-divider"),w=f("el-main");return l(),u("div",kl,[s(w,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:_(()=>[e("div",El,[e("div",Sl,[Ul,e("div",Vl,[i(" 导出类型: "),s(m,{placeholder:"请选择导出类型",style:{width:"50%"},modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=U=>n.value=U)},{default:_(()=>[(l(),u(H,null,W(o,(U,$)=>s(h,{label:U.brief,value:$,key:$},{default:_(()=>[i(c(U.brief),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"]),Cl,Ml,n.value?(l(),u("span",Bl,c(o[n.value].detail),1)):g("",!0)]),s(p),n.value=="endb"?(l(),k(rl,{key:0,wxid:a.wxid},null,8,["wxid"])):g("",!0),n.value=="dedb"?(l(),k(hl,{key:1,wxid:a.wxid},null,8,["wxid"])):g("",!0),n.value=="csv"?(l(),k(ml,{key:2,wxid:a.wxid},null,8,["wxid"])):g("",!0),n.value=="json"?(l(),k(vl,{key:3,wxid:a.wxid},null,8,["wxid"])):g("",!0),n.value=="html"?(l(),k(yl,{key:4,wxid:a.wxid},null,8,["wxid"])):g("",!0),n.value=="pdf"?(l(),k(gl,{key:5,wxid:a.wxid},null,8,["wxid"])):g("",!0),n.value=="docx"?(l(),k(bl,{key:6,wxid:a.wxid},null,8,["wxid"])):g("",!0)])])]),_:1})])}}}),zl=S({__name:"ChatRecords",props:{wxid:{type:String,required:!0}},setup(t){const a=t,n=x(!1),o=d=>{n.value=d},r=()=>{n.value=!1};return z(()=>a.wxid,async(d,h)=>{d!==h&&r()}),N(()=>{r()}),(d,h)=>{const m=f("el-header"),p=f("el-main"),w=f("el-container");return l(),k(w,null,{default:_(()=>[s(m,{style:{height:"40px","max-height":"40px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:_(()=>[s(rt,{wxid:t.wxid,onExporting:o},null,8,["wxid"])]),_:1}),s(p,{style:{height:"calc(100vh - 40px)",padding:"0",margin:"0","background-color":"#f5f5f5"}},{default:_(()=>[n.value?(l(),k(Il,{key:0,wxid:t.wxid},null,8,["wxid"])):(l(),k(ll,{key:1,wxid:t.wxid},null,8,["wxid"]))]),_:1})]),_:1})}}}),Ll={id:"chat_view",class:"common-layout"},Tl={key:0,style:{height:"calc(100vh)",width:"100%"}},ql={key:1,style:{width:"100%",height:"100%"}},Ol=S({__name:"ChatView",setup(t){const a=x(""),n=o=>{a.value=o};return N(()=>{le().then(o=>{console.log("API version: "+o)}).catch(o=>{console.error("Error fetching API version:",o)}),oe()}),(o,r)=>{const d=f("el-aside"),h=f("el-container");return l(),u("div",Ll,[e("div",null,[s(h,null,{default:_(()=>[s(d,{width:"auto",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:_(()=>[s(st,{onWxid:n})]),_:1}),a.value!=""?(l(),u("div",Tl,[s(zl,{wxid:a.value},null,8,["wxid"])])):(l(),u("div",ql,[s(ae)]))]),_:1})])])}}});export{Ol as default};
