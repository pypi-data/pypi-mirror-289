# 当场景为二、三时，不允许装docker
- name: check scenario
  fail:
    msg: "Docker installation is not allowed in Scenario 2 and Scenario 3"
  when:
    - SCENE_NUM in NO_DOCKER_K8S_SCENES
    - "DOCKER_COMPONENT in (SCENES[SCENE_NUM] + EXTRA_COMPONENT.split(','))"

- name: check docker service
  shell: docker info 2>/dev/null | wc -l
  register: docker_status
  changed_when: false

- name: set docker service status
  set_fact:
    docker_installed: "{{ docker_status.stdout != '0' }}"
  changed_when: false

- name: message
  debug:
    msg: "docker is running already. The script won't install docker."
  when: docker_installed
  changed_when: false

- name: failed when skip sys_pkg but docker not ok
  fail:
    msg: "docker is not ok and we can not install sys_pkg under this OS!"
  when: not docker_installed and skip_sys_pkg

- name: message
  debug:
    msg: "*************************start install docker***************************"
  when: not docker_installed

- name: message
  debug:
    msg: "containerd need reinstall, the script will install containerd."
  when: not use_old_k8s_version and not skip_sys_pkg

- name: message
  debug:
    msg: "************************start install containerd**********************"
  when: not use_old_k8s_version and not skip_sys_pkg

- name: include copy task
  include_tasks: copy.yml
  when: not skip_sys_pkg


