# 创建K8s镜像目录
- name: create k8s image directory
  file:
    path: "{{ k8s_image_dir }}"
    state: directory
    mode: 0750
  when:
    - no_copy_flag != "true"

- name: clean image dir
  file:
    path: "{{ k8s_image_dir }}/{{ ansible_architecture }}"
    state: absent


# 复制k8s镜像包到远端并解压
- name: unarchive k8s base images on remote for k8s 1.19.16
  ansible.builtin.unarchive:
    src: "{{ k8s_image_dir }}/{{ ansible_architecture }}.tar.gz"
    dest: "{{ k8s_image_dir }}"
    remote_src: no
  when:
    - no_copy_flag != "true"
    - use_old_k8s_version

- name: unarchive k8s base images on remote k8s 1.25.3
  ansible.builtin.unarchive:
    src: "{{ k8s_image_dir }}/{{ ansible_architecture }}_125.tar.gz"
    dest: "{{ k8s_image_dir }}"
    remote_src: no
  when:
    - no_copy_flag != "true"
    - not use_old_k8s_version

- name: list k8s images
  shell: "ls {{ k8s_image_dir }}/{{ ansible_architecture }}"
  register: k8s_image

- name: load k8s images
  shell: "{{import_cmd}} {{ k8s_image_dir }}/{{ ansible_architecture }}/{{ item }}"
  loop: "{{ k8s_image.stdout_lines }}"
