"use strict";(self.webpackChunklearninghouse=self.webpackChunklearninghouse||[]).push([[12],{2012:(tt,F,a)=>{a.r(F),a.d(F,{BrainsModule:()=>_});var A=a(177),$=a(6526),t=a(3953),f=a(8498),R=a(1336),p=a(2918),X=a(9159),B=a(1413),g=a(6977),o=a(6354),r=a(9417),T=a(5351),j=a(4412),G=a(9437),E=a(5752),y=a(3141),V=a(8274);let N=(()=>{class e{static#t=this.INTEGER_PATTERN=/^[1-9]+\d*$/;static IntegerValidator(n){let i=null;return n.value&&!e.INTEGER_PATTERN.test(n.value)&&(i={integer:!0}),i}}return e})();var L=a(7554);let D=(()=>{class e{constructor(n){this.api=n}getBrains(){return this.api.get("/brains/info").pipe((0,o.T)(n=>{const i=[];for(const s of Object.values(n))i.push(s);return i}))}getBrainInfo(n){return this.api.get(`/brain/${n}/info`)}createBrain(n){return this.api.post("/brain/configuration",n)}updateBrain(n){return this.api.put("/brain/"+n.name+"/configuration",n)}deleteBrainConfiguration(n){return this.api.delete("/brain/"+n.name+"/configuration")}retrainBrain(n){return this.api.post("/brain/"+n.name+"/training",{})}static#t=this.\u0275fac=function(i){return new(i||e)(t.KVO(L.W))};static#n=this.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var z=a(1435),P=a(1573),Q=a(2619),M=a(9454),b=a(3955);class d extends V.m{static#t=this.ADD_DIALOG_CONFIG={title:"pages.brains.common.add_dialog_title",submitButton:y.H.ADD,responseConfig:{successMessage:"pages.brains.common.success",errorPrefix:"pages.brains.errors"}};static#n=this.EDIT_DIALOG_CONFIG={...d.ADD_DIALOG_CONFIG,title:"pages.brains.common.edit_dialog_title",submitButton:y.H.EDIT};constructor(l,n,i,s,c){super(),this.dialogRef=l,this.data=n,this.fb=i,this.brainsService=s,this.dialogActions=c,this.destroyed=new B.B,this.typedOptions=[{value:E.p.CLASSIFIER,label:"common.enums.estimatortype.classifier"},{value:E.p.REGRESSOR,label:"common.enums.estimatortype.regressor"}],this.encodeOptions=[{value:!0,label:"common.buttons.yes"},{value:!1,label:"common.buttons.no"}],this.dialogConfig$=new j.t(d.ADD_DIALOG_CONFIG),this.dialogRef.disableClose=!0,this.form=this.fb.group({name:this.fb.control("",[r.k0.required]),estimator:this.fb.group({typed:this.fb.control(E.p.CLASSIFIER,[r.k0.required]),estimators:this.fb.control(100,[N.IntegerValidator,r.k0.min(100),r.k0.max(1e3)]),max_depth:this.fb.control(5,[N.IntegerValidator,r.k0.min(4),r.k0.max(10)])}),dependent_encode:this.fb.control(!1,[r.k0.required]),test_size:this.fb.control(.2,[r.k0.required,r.k0.min(.1)])}),this.data?(this.isEdit=!0,this.dialogConfig$.next(d.EDIT_DIALOG_CONFIG)):this.isEdit=!1,this.dialogActions.onSubmit.pipe((0,g.Q)(this.destroyed),(0,o.T)(()=>this.onSubmit())).subscribe(),this.dialogActions.onClose.pipe((0,g.Q)(this.destroyed),(0,o.T)(()=>this.onClose())).subscribe()}ngOnInit(){this.isEdit&&(this.form.patchValue(this.data),this.form.controls.name.disable())}ngOnDestroy(){this.destroyed.next(),this.destroyed.complete()}onSubmit(){this.isEdit?this.brainsService.updateBrain(this.form.getRawValue()).pipe((0,o.T)(()=>{this.handleSuccess()}),(0,G.W)(l=>this.handleError(l))).subscribe():this.brainsService.createBrain(this.form.getRawValue()).pipe((0,o.T)(l=>{this.isEdit=!0,this.data=l,this.form.controls.name.disable(),this.dialogConfig$.next(d.EDIT_DIALOG_CONFIG),this.handleSuccess()}),(0,G.W)(l=>this.handleError(l))).subscribe()}onClose(){this.dialogRef.close(this.isSuccess?this.form.value:null)}static#i=this.\u0275fac=function(n){return new(n||d)(t.rXU(T.CP),t.rXU(T.Vh),t.rXU(r.Qk),t.rXU(D),t.rXU(z.r))};static#e=this.\u0275cmp=t.VBU({type:d,selectors:[["app-add-edit-brain-dialog"]],features:[t.Vt3],decls:13,vars:18,consts:[[3,"config","state","form"],["name","pages.brains.fields.name",3,"control"],["name","pages.brains.fields.typed",3,"control","options"],["name","pages.brains.fields.dependent_encode",3,"control","options"],["name","pages.brains.fields.test_size",3,"control"],[1,"mat-elevation-z0"],["name","pages.brains.fields.estimators",3,"control"],["name","pages.brains.fields.max_depth",3,"control"]],template:function(n,i){1&n&&(t.j41(0,"learninghouse-edit-dialog",0),t.nI1(1,"async"),t.nI1(2,"async"),t.nrm(3,"learninghouse-input",1)(4,"learninghouse-select",2)(5,"learninghouse-select",3)(6,"learninghouse-input",4),t.j41(7,"mat-expansion-panel",5)(8,"mat-expansion-panel-header"),t.EFF(9),t.nI1(10,"translate"),t.k0s(),t.nrm(11,"learninghouse-input",6)(12,"learninghouse-input",7),t.k0s()()),2&n&&(t.Y8G("config",t.bMT(1,12,i.dialogConfig$))("state",t.bMT(2,14,i.state$))("form",i.form),t.R7$(3),t.Y8G("control",i.form.controls.name),t.R7$(),t.Y8G("control",i.form.controls.estimator.controls.typed)("options",i.typedOptions),t.R7$(),t.Y8G("control",i.form.controls.dependent_encode)("options",i.encodeOptions),t.R7$(),t.Y8G("control",i.form.controls.test_size),t.R7$(3),t.SpI(" ",t.bMT(10,16,"pages.brains.common.advanced_configuration")," "),t.R7$(2),t.Y8G("control",i.form.controls.estimator.controls.estimators),t.R7$(),t.Y8G("control",i.form.controls.estimator.controls.max_depth))},dependencies:[y.w,P.S,Q.w,M.GK,M.Z2,A.Jj,b.D9],styles:["mat-expansion-panel[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]{padding:0}mat-expansion-panel[_ngcontent-%COMP%]     .mat-expansion-panel-body{padding:0!important}"]})}var m=a(238),W=a(6163),Y=a(3128),J=a(2042);const k=["sort"];let w=(()=>{class e{static#t=this.RETRAIN_BUTTON={id:"retrain",label:"pages.brains.actions.retrain_row_description",icon:"refresh",conditionFlag:"needsRetraining"};static#n=this.TRAINING_BUTTON={id:"training",label:"pages.brains.actions.training_row_description",icon:"tips_and_updates"};static#i=this.PREDICTION_BUTTON={id:"prediction",label:"pages.brains.actions.prediction_row_description",svg:"learninghouse",conditionFlag:"isTrained"};constructor(n,i,s,c,v,S){this.dialog=n,this.router=i,this.brainsService=s,this.authService=c,this.translateService=v,this.tableActions=S,this.dataSource=new X.I6,this.tableConfig={title:"pages.brains.common.title",columns:[{attr:"name",label:"pages.brains.fields.name"},{attr:"estimatorTypedTranslated",label:"pages.brains.fields.typed"},{attr:"training_data_size",label:"pages.brains.fields.training_data_size",icon:"warning",iconTooltip:"pages.brains.common.not_enough_training_data",iconConditionFlag:"hasNotEnoughData"}],rowActions:[]},this.destroyed=new B.B;const C=this.authService.role$.getValue();C&&(C.isMinimumRole(p.X.TRAINER)&&this.tableConfig.rowActions.push(e.RETRAIN_BUTTON),C.isMinimumRole(p.X.ADMIN)&&(this.tableConfig.actions=[m.b.ADD],this.tableConfig.rowActions.push(m.b.EDIT_ROW,m.b.DELETE_ROW))),this.tableActions.onTableAction.pipe((0,g.Q)(this.destroyed),(0,o.T)(()=>this.onAddEdit(null))).subscribe(),this.tableActions.onTableRowAction.pipe((0,g.Q)(this.destroyed),(0,o.T)(u=>{switch(u.actionId){case e.RETRAIN_BUTTON.id:this.onRefresh(u.row);break;case m.b.EDIT_ROW.id:this.onAddEdit(u.row.configuration);break;case m.b.DELETE_ROW.id:this.onDelete(u.row.configuration);break;case e.TRAINING_BUTTON.id:this.router.navigate(["/brains/training/"+u.row.name]).catch(O=>console.error(O));break;case e.PREDICTION_BUTTON.id:this.router.navigate(["/brains/prediction/"+u.row.name]).catch(O=>console.error(O))}})).subscribe()}ngOnDestroy(){this.destroyed.next(),this.destroyed.complete()}ngAfterViewInit(){this.loadData(),this.dataSource.sort=this.sort}onAddEdit(n){this.dialog.open(d,{width:"480px",data:n}).afterClosed().subscribe(s=>{s&&this.loadData()})}onDelete(n){this.brainsService.deleteBrainConfiguration(n).pipe((0,o.T)(()=>{this.loadData()})).subscribe()}onRefresh(n){this.brainsService.retrainBrain(n).pipe((0,o.T)(()=>{this.loadData()})).subscribe()}loadData(){this.brainsService.getBrains().pipe((0,o.T)(n=>{const i=[];n.forEach(s=>{let c=null!=s.trained_at&&s.actual_versions,v=s.training_data_size>=10,S=!c&&v;i.push({...s,estimatorTypedTranslated:this.translateService.instant("common.enums.estimatortype."+s.configuration.estimator.typed),needsRetraining:S,isTrained:c,hasNotEnoughData:!v})}),this.dataSource.data=i})).subscribe()}static#e=this.\u0275fac=function(i){return new(i||e)(t.rXU(T.bZ),t.rXU(f.Ix),t.rXU(D),t.rXU(W.u),t.rXU(b.c$),t.rXU(Y.z))};static#s=this.\u0275cmp=t.VBU({type:e,selectors:[["app-brains"]],viewQuery:function(i,s){if(1&i&&t.GBs(k,5),2&i){let c;t.mGM(c=t.lsd())&&(s.sort=c.first)}},decls:2,vars:2,consts:[["sort","matSort"],["matSort","","matSortActive","description","matSortDirection","asc","matSortDisableClear","",3,"config","dataSource"]],template:function(i,s){1&i&&t.nrm(0,"learninghouse-table",1,0),2&i&&t.Y8G("config",s.tableConfig)("dataSource",s.dataSource)},dependencies:[m.O,J.B4],encapsulation:2})}return e})(),H=(()=>{class e{static#t=this.\u0275fac=function(i){return new(i||e)};static#n=this.\u0275cmp=t.VBU({type:e,selectors:[["app-prediction"]],decls:2,vars:0,template:function(i,s){1&i&&(t.j41(0,"p"),t.EFF(1,"prediction works!"),t.k0s())},encapsulation:2})}return e})();var h=a(5596),I=a(3902);let K=(()=>{class e{static#t=this.\u0275fac=function(i){return new(i||e)};static#n=this.\u0275cmp=t.VBU({type:e,selectors:[["learninghouse-braininfo"]],inputs:{brainInfo:"brainInfo"},decls:25,vars:15,consts:[[1,"mat-elevation-z8"],["matListItemTitle",""],["matListItemLine",""]],template:function(i,s){1&i&&(t.j41(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),t.EFF(3),t.k0s()(),t.j41(4,"mat-card-content")(5,"mat-list")(6,"mat-list-item")(7,"h3",1),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"span",2),t.EFF(11),t.nI1(12,"translate"),t.k0s()(),t.j41(13,"mat-list-item")(14,"h3",1),t.EFF(15),t.nI1(16,"translate"),t.k0s(),t.j41(17,"span",2),t.EFF(18),t.k0s()(),t.j41(19,"mat-list-item")(20,"h3",1),t.EFF(21),t.nI1(22,"translate"),t.k0s(),t.j41(23,"span",2),t.EFF(24),t.k0s()()()()()),2&i&&(t.R7$(3),t.JRh(null==s.brainInfo?null:s.brainInfo.name),t.R7$(5),t.JRh(t.bMT(9,7,"pages.brains.fields.typed")),t.R7$(3),t.JRh(t.bMT(12,9,"common.enums.estimatortype."+(null==s.brainInfo||null==s.brainInfo.configuration||null==s.brainInfo.configuration.estimator?null:s.brainInfo.configuration.estimator.typed))),t.R7$(4),t.JRh(t.bMT(16,11,"pages.brains.fields.dependent_encode")),t.R7$(3),t.JRh(null==s.brainInfo||null==s.brainInfo.configuration?null:s.brainInfo.configuration.dependent_encode),t.R7$(3),t.JRh(t.bMT(22,13,"pages.brains.fields.training_data_size")),t.R7$(3),t.JRh(null==s.brainInfo?null:s.brainInfo.training_data_size))},dependencies:[h.RN,h.m2,h.MM,h.dh,I.jt,I.YE,I.C_,I.yE,b.D9],encapsulation:2})}return e})(),Z=(()=>{class e{constructor(n){this.route=n}ngOnInit(){this.route.data.subscribe(n=>{this.brainInfo=n.brainInfo})}static#t=this.\u0275fac=function(i){return new(i||e)(t.rXU(f.nX))};static#n=this.\u0275cmp=t.VBU({type:e,selectors:[["app-training"]],decls:7,vars:4,consts:[[3,"brainInfo"]],template:function(i,s){1&i&&(t.nrm(0,"learninghouse-braininfo",0),t.j41(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.nrm(6,"mat-card-content"),t.k0s()),2&i&&(t.Y8G("brainInfo",s.brainInfo),t.R7$(4),t.JRh(t.bMT(5,2,"pages.brains.common.dependent")))},dependencies:[h.RN,h.m2,h.MM,h.dh,K,b.D9]})}return e})(),U=(()=>{class e{constructor(n){this.brainsService=n}getBrainInfo(n){return this.brainsService.getBrainInfo(n.params.name)}static#t=this.\u0275fac=function(i){return new(i||e)(t.KVO(D))};static#n=this.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const x=[{path:"",pathMatch:"full",component:w,canActivate:[()=>(0,t.WQX)(R.q).checkMinimumRole(p.X.USER)]},{path:"prediction/:name",component:H,canActivate:[()=>(0,t.WQX)(R.q).checkMinimumRole(p.X.USER)]},{path:"training/:name",component:Z,canActivate:[()=>(0,t.WQX)(R.q).checkMinimumRole(p.X.TRAINER)],resolve:{brainInfo:e=>(0,t.WQX)(U).getBrainInfo(e)}}];let q=(()=>{class e{static#t=this.\u0275fac=function(i){return new(i||e)};static#n=this.\u0275mod=t.$C({type:e});static#i=this.\u0275inj=t.G2t({providers:[U],imports:[f.iI.forChild(x),f.iI]})}return e})(),_=(()=>{class e{static#t=this.\u0275fac=function(i){return new(i||e)};static#n=this.\u0275mod=t.$C({type:e});static#i=this.\u0275inj=t.G2t({imports:[A.MD,$.G,q]})}return e})()}}]);