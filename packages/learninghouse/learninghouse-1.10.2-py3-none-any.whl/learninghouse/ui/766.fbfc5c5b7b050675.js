"use strict";(self.webpackChunklearninghouse=self.webpackChunklearninghouse||[]).push([[766],{8766:(st,A,n)=>{n.r(A),n.d(A,{AuthModule:()=>tt});var m=n(177),j=n(6526),t=n(3953),T=n(8498),S=n(1336),g=n(2918),E=n(9159),G=n(1413),f=n(6977),l=n(6354),w=n(238),i=n(9417),Y=n(4412),d=n(9437),b=n(4605),D=n(3141),I=n(8274);class C{static MatchValidator(r,s){return o=>{const e=o.get(r),c=o.get(s),u=e&&c&&e.value!==c.value?{confirmMismatch:"pages.auth.password.errors.confirmMismatch"}:null;return c?.setErrors(u),u}}static APIKeyDescriptionValidator(r){const o=r.value;let e=null;return o&&(o.length<3?e={apikeyDescriptionShort:"pages.auth.apikeys.errors.apikeyDescriptionShort"}:/^[A-Za-z]\w{1,13}[A-Za-z0-9]$/.test(o)||(e={apikeyDescriptionPattern:"pages.auth.apikeys.errors.apikeyDescriptionPattern"})),e}}var $=n(5351),y=n(6163),P=n(1435),F=n(1573),B=n(2619),R=n(8834),O=n(9213),V=n(4823),x=n(3801),v=n(3955);const X=a=>({apikey:a});function N(a,r){if(1&a&&(t.j41(0,"learninghouse-alert",4)(1,"div",5)(2,"span"),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"button",6),t.nI1(6,"translate"),t.j41(7,"mat-icon"),t.EFF(8,"content_copy"),t.k0s()()()()),2&a){const s=t.XpG();t.Y8G("alertType",s.AlertType.warning),t.R7$(3),t.JRh(t.i5U(4,4,"pages.auth.apikeys.messages.newapikey",t.eq3(9,X,null==s.apikey?null:s.apikey.key))),t.R7$(2),t.Y8G("matTooltip",t.bMT(6,7,"common.buttons.copy_to_clipboard"))("cdkCopyToClipboard",s.copyToClipboard())}}class h extends I.m{static#t=this.NO_ADD_DIALOG_CONFIG={title:"pages.auth.apikeys.common.dialog_title",responseConfig:{successMessage:"pages.auth.apikeys.common.success"}};static#s=this.ADD_DIALOG_CONFIG={...h.NO_ADD_DIALOG_CONFIG,submitButton:D.H.ADD};constructor(r,s,o,e){super(),this.dialogRef=r,this.fb=s,this.authService=o,this.dialogActions=e,this.AlertType=b.v,this.destroyed=new G.B,this.roleOptions=[{value:g.y.USER,label:"common.enums.role.user"},{value:g.y.TRAINER,label:"common.enums.role.trainer"}],this.dialogConfig$=new Y.t(h.ADD_DIALOG_CONFIG),this.dialogRef.disableClose=!0,this.form=this.fb.group({description:this.fb.control("",[i.k0.required,C.APIKeyDescriptionValidator]),role:this.fb.control(g.y.USER,[i.k0.required])}),this.dialogActions.onSubmit.pipe((0,f.Q)(this.destroyed),(0,l.T)(()=>this.onAdd())).subscribe(),this.dialogActions.onClose.pipe((0,f.Q)(this.destroyed),(0,l.T)(()=>this.onClose())).subscribe()}ngOnDestroy(){this.destroyed.next(),this.destroyed.complete()}onAdd(){this.authService.addAPIKey(this.form.getRawValue()).pipe((0,l.T)(r=>{this.apikey=r,this.dialogConfig$.next(h.NO_ADD_DIALOG_CONFIG),this.form.disable(),this.handleSuccess()}),(0,d.W)(r=>this.handleError(r))).subscribe()}onClose(){this.dialogRef.close(this.isSuccess?this.form.value:null)}copyToClipboard(){let r="";return this.apikey?.key&&(r=this.apikey.key),r}static#o=this.\u0275fac=function(s){return new(s||h)(t.rXU($.CP),t.rXU(i.Qk),t.rXU(y.u),t.rXU(P.r))};static#e=this.\u0275cmp=t.VBU({type:h,selectors:[["learninghouse-add-apikey"]],features:[t.Vt3],decls:6,vars:14,consts:[[3,"config","state","form"],[3,"alertType",4,"ngIf"],[3,"name","control","maxlength"],[3,"name","control","options"],[3,"alertType"],[1,"flex","flex-row","border-box","justify-center","items-start","content-start"],["type","button","mat-icon-button","",1,"flex","flex-icon",3,"matTooltip","cdkCopyToClipboard"]],template:function(s,o){1&s&&(t.j41(0,"learninghouse-edit-dialog",0),t.nI1(1,"async"),t.nI1(2,"async"),t.DNE(3,N,9,11,"learninghouse-alert",1),t.nrm(4,"learninghouse-input",2)(5,"learninghouse-select",3),t.k0s()),2&s&&(t.Y8G("config",t.bMT(1,10,o.dialogConfig$))("state",t.bMT(2,12,o.state$))("form",o.form),t.R7$(3),t.Y8G("ngIf",o.isSuccess),t.R7$(),t.Y8G("name","pages.auth.apikeys.columns.description")("control",o.form.controls.description)("maxlength",15),t.R7$(),t.Y8G("name","pages.auth.apikeys.columns.role")("control",o.form.controls.role)("options",o.roleOptions))},dependencies:[m.bT,b.C,D.w,F.S,B.w,R.iY,O.An,V.oV,x.dF,m.Jj,v.D9],encapsulation:2})}var L=n(3128),U=n(2042);const W=["sort"];let K=(()=>{class a{constructor(s,o,e,c){this.dialog=s,this.authService=o,this.translateService=e,this.tableActions=c,this.dataSource=new E.I6,this.tableConfig={title:"pages.auth.apikeys.common.title",columns:[{attr:"description",label:"pages.auth.apikeys.columns.description"},{attr:"roleTranslated",label:"pages.auth.apikeys.columns.role"}],actions:[w.b.ADD],rowActions:[w.b.DELETE_ROW]},this.destroyed=new G.B,this.tableActions.onTableAction.pipe((0,f.Q)(this.destroyed),(0,l.T)(()=>this.onAdd())).subscribe(),this.tableActions.onTableRowAction.pipe((0,f.Q)(this.destroyed),(0,l.T)(u=>u.row),(0,l.T)(u=>this.onDelete(u))).subscribe()}ngOnDestroy(){this.destroyed.next(),this.destroyed.complete()}ngAfterViewInit(){this.loadData(),this.dataSource.sort=this.sort}loadData(){this.authService.getAPIKeys().pipe((0,l.T)(s=>{const o=[];s.forEach(e=>{o.push({...e,roleTranslated:this.translateService.instant("common.enums.role."+e.role)})}),this.dataSource.data=o})).subscribe()}onAdd(){this.dialog.open(h,{width:"480px"}).afterClosed().subscribe(o=>{o&&this.loadData()})}onDelete(s){this.authService.deleteAPIKey(s.description).pipe((0,l.T)(()=>{this.loadData()})).subscribe()}static#t=this.\u0275fac=function(o){return new(o||a)(t.rXU($.bZ),t.rXU(y.u),t.rXU(v.c$),t.rXU(L.z))};static#s=this.\u0275cmp=t.VBU({type:a,selectors:[["learninghouse-apikeys"]],viewQuery:function(o,e){if(1&o&&t.GBs(W,5),2&o){let c;t.mGM(c=t.lsd())&&(e.sort=c.first)}},decls:2,vars:2,consts:[["sort","matSort"],["matSort","","matSortActive","description","matSortDirection","asc","matSortDisableClear","",3,"config","dataSource"]],template:function(o,e){1&o&&t.nrm(0,"learninghouse-table",1,0),2&o&&t.Y8G("config",e.tableConfig)("dataSource",e.dataSource)},dependencies:[w.O,U.B4],encapsulation:2})}return a})();var M=n(3469),k=n(6325),p=n(5596);let Q=(()=>{class a extends I.m{constructor(s,o){super(),this.formBuilder=s,this.authService=o,this.responseConfig={successMessage:"pages.auth.password.common.success"},this.form=this.formBuilder.group({api:this.formBuilder.group({old_password:this.formBuilder.control("",[i.k0.required]),new_password:this.formBuilder.control("",[i.k0.required])}),confirm_password:this.formBuilder.control("",[i.k0.required])},{validators:[C.MatchValidator("api.new_password","confirm_password")]})}submitChangePassword(){this.authService.changePassword(this.form.controls.api.getRawValue()).pipe((0,l.T)(()=>{this.authService.loginAdmin({password:this.form.controls.api.controls.new_password.value}).pipe((0,l.T)(()=>{this.handleSuccess()}),(0,d.W)(s=>this.handleError(s))).subscribe()}),(0,d.W)(s=>this.handleError(s))).subscribe()}static#t=this.\u0275fac=function(o){return new(o||a)(t.rXU(i.Qk),t.rXU(y.u))};static#s=this.\u0275cmp=t.VBU({type:a,selectors:[["learninghouse-change-password"]],features:[t.Vt3],decls:15,vars:17,consts:[[3,"ngSubmit"],[3,"state","config"],[3,"name","control"],["align","end"],["type","submit","mat-raised-button","","color","primary",3,"disabled"]],template:function(o,e){1&o&&(t.j41(0,"mat-card")(1,"mat-card-title"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"form",0),t.bIt("ngSubmit",function(){return e.submitChangePassword()}),t.j41(5,"mat-card-content"),t.nrm(6,"learninghouse-form-response",1),t.nI1(7,"async"),t.nrm(8,"learninghouse-password",2)(9,"learninghouse-password",2)(10,"learninghouse-password",2),t.k0s(),t.j41(11,"mat-card-actions",3)(12,"button",4),t.EFF(13),t.nI1(14,"translate"),t.k0s()()()()),2&o&&(t.R7$(2),t.JRh(t.bMT(3,11,"pages.auth.password.common.title")),t.R7$(4),t.Y8G("state",t.bMT(7,13,e.state$))("config",e.responseConfig),t.R7$(2),t.Y8G("name","pages.auth.password.fields.old_password")("control",e.form.controls.api.controls.old_password),t.R7$(),t.Y8G("name","pages.auth.password.fields.new_password")("control",e.form.controls.api.controls.new_password),t.R7$(),t.Y8G("name","pages.auth.password.fields.confirm_password")("control",e.form.controls.confirm_password),t.R7$(2),t.Y8G("disabled",!e.form.valid),t.R7$(),t.JRh(t.bMT(14,15,"pages.auth.password.buttons.change")))},dependencies:[M.R,k.n,i.qT,i.cb,i.cV,R.$z,p.RN,p.YY,p.m2,p.dh,m.Jj,v.D9],styles:["mat-card[_ngcontent-%COMP%]{padding:32px}mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding-top:10px;flex-direction:column;box-sizing:border-box;display:flex;place-content:stretch center;align-items:stretch;max-width:100%}"]})}return a})();var J=n(7918),z=n(7554);function H(a,r){if(1&a){const s=t.RV6();t.j41(0,"form",2),t.bIt("ngSubmit",function(){t.eBV(s);const e=t.XpG();return t.Njj(e.submitInitial())}),t.j41(1,"mat-card-content",3)(2,"learninghouse-alert",4),t.nrm(3,"span",5),t.nI1(4,"translate"),t.k0s(),t.nrm(5,"learninghouse-form-response",6),t.nI1(6,"async"),t.nrm(7,"learninghouse-password",7)(8,"learninghouse-password",7)(9,"learninghouse-password",7),t.k0s(),t.j41(10,"mat-card-actions",8)(11,"button",9),t.EFF(12),t.nI1(13,"translate"),t.k0s()()()}if(2&a){const s=t.XpG();t.R7$(2),t.Y8G("alertType",s.AlertType.warning),t.R7$(),t.Y8G("innerHTML",t.bMT(4,12,"pages.auth.login.common.fallback_warning"),t.npT),t.R7$(2),t.Y8G("state",t.bMT(6,14,s.state$))("config",s.responseConfig),t.R7$(2),t.Y8G("name","pages.auth.password.fields.old_password")("control",s.initial.controls.api.controls.old_password),t.R7$(),t.Y8G("name","pages.auth.password.fields.new_password")("control",s.initial.controls.api.controls.new_password),t.R7$(),t.Y8G("name","pages.auth.password.fields.confirm_password")("control",s.initial.controls.confirm_password),t.R7$(2),t.Y8G("disabled",!s.initial.valid),t.R7$(),t.JRh(t.bMT(13,16,"pages.auth.login.buttons.change"))}}function Z(a,r){if(1&a){const s=t.RV6();t.j41(0,"form",2),t.bIt("ngSubmit",function(){t.eBV(s);const e=t.XpG();return t.Njj(e.submitLoginAdmin())}),t.j41(1,"mat-card-content",3),t.nrm(2,"learninghouse-form-response",6),t.nI1(3,"async"),t.nrm(4,"learninghouse-password",7),t.k0s(),t.j41(5,"mat-card-actions",8)(6,"button",10),t.bIt("click",function(){t.eBV(s);const e=t.XpG();return t.Njj(e.submitLoginAPIKey())}),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.j41(9,"button",9),t.EFF(10),t.nI1(11,"translate"),t.k0s()()()}if(2&a){const s=t.XpG();t.R7$(2),t.Y8G("state",t.bMT(3,8,s.state$))("config",s.responseConfig),t.R7$(2),t.Y8G("name","pages.auth.login.fields.password")("control",s.normal.controls.password),t.R7$(2),t.Y8G("disabled",!s.normal.valid),t.R7$(),t.JRh(t.bMT(8,10,"pages.auth.login.buttons.apikey")),t.R7$(2),t.Y8G("disabled",!s.normal.valid),t.R7$(),t.JRh(t.bMT(11,12,"pages.auth.login.buttons.admin"))}}const q=[{path:"",component:(()=>{class a extends I.m{constructor(s,o,e,c){super(),this.formBuilder=s,this.api=o,this.authService=e,this.router=c,this.AlertType=b.v,this.ServiceMode=J.h,this.responseConfig={successMessage:"pages.auth.login.common.success"},this.normal=this.formBuilder.group({password:this.formBuilder.control("",[i.k0.required])}),this.initial=this.formBuilder.group({api:this.formBuilder.group({old_password:this.formBuilder.control("",[i.k0.required]),new_password:this.formBuilder.control("",[i.k0.required])}),confirm_password:this.formBuilder.control("",[i.k0.required])},{validators:[C.MatchValidator("api.new_password","confirm_password")]})}ngOnInit(){this.api.update_mode()}submitLoginAdmin(){this.authService.loginAdmin(this.normal.getRawValue()).pipe((0,l.T)(()=>{this.router.navigate(["/brains"]).catch(s=>console.error(s))}),(0,d.W)(s=>this.handleError(s))).subscribe()}submitLoginAPIKey(){this.authService.loginAPIKey(this.normal.controls.password.value).pipe((0,l.T)(()=>{this.router.navigate(["/brains"]).catch(s=>console.error(s))}),(0,d.W)(s=>this.handleError(s))).subscribe()}submitInitial(){this.authService.loginAdmin({password:this.initial.controls.api.controls.old_password.value}).pipe((0,l.T)(()=>{this.authService.changePassword(this.initial.controls.api.getRawValue()).pipe((0,l.T)(()=>{this.authService.loginAdmin({password:this.initial.controls.api.controls.new_password.value}).pipe((0,l.T)(()=>{this.handleSuccess(),this.router.navigate(["/brains"]).catch(s=>console.error(s))}),(0,d.W)(s=>this.handleError(s))).subscribe()}),(0,d.W)(s=>this.handleError(s))).subscribe()}),(0,d.W)(s=>this.handleError(s))).subscribe()}static#t=this.\u0275fac=function(o){return new(o||a)(t.rXU(i.Qk),t.rXU(z.W),t.rXU(y.u),t.rXU(T.Ix))};static#s=this.\u0275cmp=t.VBU({type:a,selectors:[["learninghouse-login"]],features:[t.Vt3],decls:9,vars:9,consts:[[1,"flex","flex-row","justify-center","items-center","box-border","login-wrapper"],[3,"ngSubmit",4,"ngIf"],[3,"ngSubmit"],[1,"flex","flex-col","justify-stretch","items-stretch","box-border"],[3,"alertType"],[3,"innerHTML"],[3,"state","config"],[3,"name","control"],[1,"flex","flex-row","justify-between","gap-4"],["type","submit","mat-raised-button","","color","primary",3,"disabled"],["type","button","mat-stroked-button","",3,"click","disabled"]],template:function(o,e){1&o&&(t.j41(0,"div",0)(1,"mat-card")(2,"mat-card-title"),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.DNE(5,H,14,18,"form",1),t.nI1(6,"async"),t.DNE(7,Z,12,14,"form",1),t.nI1(8,"async"),t.k0s()()),2&o&&(t.R7$(3),t.JRh(t.bMT(4,3,"pages.auth.login.common.title")),t.R7$(2),t.Y8G("ngIf",t.bMT(6,5,e.api.mode$)===e.ServiceMode.INITIAL),t.R7$(2),t.Y8G("ngIf",t.bMT(8,7,e.api.mode$)!==e.ServiceMode.INITIAL))},dependencies:[m.bT,b.C,M.R,k.n,i.qT,i.cb,i.cV,R.$z,p.RN,p.YY,p.m2,p.dh,m.Jj,v.D9],styles:["div.login-wrapper[_ngcontent-%COMP%]{height:100%}div.login-wrapper[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{padding:32px}"]})}return a})()},{path:"apikeys",component:K,canActivate:[()=>(0,t.WQX)(S.q).checkMinimumRole(g.X.ADMIN)]},{path:"change_password",component:Q,canActivate:[()=>(0,t.WQX)(S.q).checkMinimumRole(g.X.ADMIN)]}];let _=(()=>{class a{static#t=this.\u0275fac=function(o){return new(o||a)};static#s=this.\u0275mod=t.$C({type:a});static#o=this.\u0275inj=t.G2t({imports:[T.iI.forChild(q),T.iI]})}return a})(),tt=(()=>{class a{static#t=this.\u0275fac=function(o){return new(o||a)};static#s=this.\u0275mod=t.$C({type:a});static#o=this.\u0275inj=t.G2t({imports:[m.MD,j.G,_]})}return a})()}}]);