"use strict";(self.webpackChunklearninghouse=self.webpackChunklearninghouse||[]).push([[247],{9247:(H,v,e)=>{e.r(v),e.d(v,{ConfigurationModule:()=>W});var f=e(177),D=e(6526),t=e(3953),C=e(8498),A=e(1336),T=e(2918),G=e(9159),S=e(1413),u=e(6977),r=e(6354),h=e(238),m=e(9417),p=e(5351),E=e(4412),I=e(9437),g=e(3141),O=e(8274),l=e(5752),R=e(7554);let b=(()=>{class n{constructor(s){this.api=s}getSensors(){return this.api.get("/sensors/configuration")}createSensor(s){return this.api.post("/sensor/configuration",s)}updateSensor(s){return this.api.put("/sensor/"+s.name+"/configuration",s)}deleteSensor(s){return this.api.delete("/sensor/"+s.name+"/configuration")}static#t=this.\u0275fac=function(o){return new(o||n)(t.KVO(R.W))};static#s=this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var $=e(1435),V=e(1573),L=e(2619),M=e(445);function U(n,i){if(1&n&&t.nrm(0,"learninghouse-input",1),2&n){const s=t.XpG();t.Y8G("name","pages.configuration.sensors.columns.cycles")("control",s.form.controls.cycles)}}function X(n,i){if(1&n&&t.nrm(0,"learninghouse-yes-no",1),2&n){const s=t.XpG();t.Y8G("name","pages.configuration.sensors.columns.calc_sun_position")("control",s.form.controls.calc_sun_position)}}class c extends O.m{static#t=this.ADD_DIALOG_CONFIG={title:"pages.configuration.sensors.common.add_dialog_title",submitButton:g.H.ADD,responseConfig:{successMessage:"pages.configuration.sensors.common.success",errorPrefix:"pages.configuration.sensors.errors"}};static#s=this.EDIT_DIALOG_CONFIG={...c.ADD_DIALOG_CONFIG,title:"pages.configuration.sensors.common.edit_dialog_title",submitButton:g.H.EDIT};constructor(i,s,o,a,d){super(),this.dialogRef=i,this.data=s,this.fb=o,this.configService=a,this.dialogActions=d,this.SensorType=l.$,this.destroyed=new S.B,this.typedOptions=[{value:l.$.NUMERICAL,label:"common.enums.sensortype.numerical"},{value:l.$.CATEGORICAL,label:"common.enums.sensortype.categorical"},{value:l.$.CYCLICAL,label:"common.enums.sensortype.cyclical"},{value:l.$.TIME,label:"common.enums.sensortype.time"}],this.dialogConfig$=new E.t(c.ADD_DIALOG_CONFIG),this.dialogRef.disableClose=!0,this.form=this.fb.group({name:this.fb.control("",[m.k0.required]),typed:this.fb.control(l.$.NUMERICAL,[m.k0.required]),cycles:this.fb.control(0),calc_sun_position:this.fb.control(!1)}),this.data?(this.isEdit=!0,this.dialogConfig$.next(c.EDIT_DIALOG_CONFIG)):this.isEdit=!1,this.dialogActions.onSubmit.pipe((0,u.Q)(this.destroyed),(0,r.T)(()=>this.onSubmit())).subscribe(),this.dialogActions.onClose.pipe((0,u.Q)(this.destroyed),(0,r.T)(()=>this.onClose())).subscribe()}ngOnInit(){this.isEdit&&(this.form.patchValue(this.data),this.form.controls.name.disable()),this.form.controls.typed.valueChanges.pipe((0,u.Q)(this.destroyed)).subscribe(i=>{this.setConditionalValidators(i)}),this.setConditionalValidators(this.form.controls.typed.value)}ngOnDestroy(){this.destroyed.next(),this.destroyed.complete()}setConditionalValidators(i){const s=this.form.controls.cycles,o=this.form.controls.calc_sun_position;s.clearValidators(),o.clearValidators(),i===l.$.CYCLICAL?s.setValidators([m.k0.required]):i===l.$.TIME&&o.setValidators([m.k0.required]),s.updateValueAndValidity(),o.updateValueAndValidity()}onSubmit(){this.isEdit?this.configService.updateSensor({name:this.data.name,typed:this.form.controls.typed.value,cycles:this.form.controls.cycles.value,calc_sun_position:this.form.controls.calc_sun_position.value}).pipe((0,r.T)(()=>{this.handleSuccess()}),(0,I.W)(i=>this.handleError(i))).subscribe():this.configService.createSensor(this.form.getRawValue()).pipe((0,r.T)(i=>{this.isEdit=!0,this.data=i,this.form.controls.name.disable(),this.dialogConfig$.next(c.EDIT_DIALOG_CONFIG),this.handleSuccess()}),(0,I.W)(i=>this.handleError(i))).subscribe()}onClose(){this.dialogRef.close(this.isSuccess?this.form.value:null)}static#o=this.\u0275fac=function(s){return new(s||c)(t.rXU(p.CP),t.rXU(p.Vh),t.rXU(m.Qk),t.rXU(b),t.rXU($.r))};static#e=this.\u0275cmp=t.VBU({type:c,selectors:[["app-add-edit-sensor-dialog"]],features:[t.Vt3],decls:7,vars:14,consts:[[3,"config","state","form"],[3,"name","control"],[3,"name","control","options"],[3,"name","control",4,"ngIf"]],template:function(s,o){1&s&&(t.j41(0,"learninghouse-edit-dialog",0),t.nI1(1,"async"),t.nI1(2,"async"),t.nrm(3,"learninghouse-input",1)(4,"learninghouse-select",2),t.DNE(5,U,1,2,"learninghouse-input",3)(6,X,1,2,"learninghouse-yes-no",3),t.k0s()),2&s&&(t.Y8G("config",t.bMT(1,10,o.dialogConfig$))("state",t.bMT(2,12,o.state$))("form",o.form),t.R7$(3),t.Y8G("name","pages.configuration.sensors.columns.name")("control",o.form.controls.name),t.R7$(),t.Y8G("name","pages.configuration.sensors.columns.typed")("control",o.form.controls.typed)("options",o.typedOptions),t.R7$(),t.Y8G("ngIf",o.form.controls.typed.value===o.SensorType.CYCLICAL),t.R7$(),t.Y8G("ngIf",o.form.controls.typed.value===o.SensorType.TIME))},dependencies:[f.bT,g.w,V.S,L.w,M.U,f.Jj],encapsulation:2})}var F=e(3955),Y=e(3128),N=e(2042);const B=["sort"],Q=[{path:"sensors",component:(()=>{class n{constructor(s,o,a,d){this.dialog=s,this.configService=o,this.translateService=a,this.tableActions=d,this.dataSource=new G.I6,this.tableConfig={title:"pages.configuration.sensors.common.title",columns:[{attr:"name",label:"pages.configuration.sensors.columns.name"},{attr:"typedTranslated",label:"pages.configuration.sensors.columns.typed"}],actions:[h.b.ADD],rowActions:[h.b.EDIT_ROW,h.b.DELETE_ROW]},this.destroyed=new S.B,this.tableActions.onTableAction.pipe((0,u.Q)(this.destroyed),(0,r.T)(()=>this.onAddEdit(null))).subscribe(),this.tableActions.onTableRowAction.pipe((0,u.Q)(this.destroyed),(0,r.T)(y=>{y.actionId===h.b.EDIT_ROW.id?this.onAddEdit(y.row):this.onDelete(y.row)})).subscribe()}ngOnDestroy(){this.destroyed.next(),this.destroyed.complete()}ngAfterViewInit(){this.loadData(),this.dataSource.sort=this.sort}onAddEdit(s){this.dialog.open(c,{width:"480px",data:s}).afterClosed().subscribe(a=>{a&&this.loadData()})}onDelete(s){this.configService.deleteSensor(s).pipe((0,r.T)(()=>{this.loadData()})).subscribe()}loadData(){this.configService.getSensors().pipe((0,r.T)(s=>{const o=[];s.forEach(a=>{o.push({...a,typedTranslated:this.translateService.instant("common.enums.sensortype."+a.typed)})}),this.dataSource.data=o})).subscribe()}static#t=this.\u0275fac=function(o){return new(o||n)(t.rXU(p.bZ),t.rXU(b),t.rXU(F.c$),t.rXU(Y.z))};static#s=this.\u0275cmp=t.VBU({type:n,selectors:[["app-sensors"]],viewQuery:function(o,a){if(1&o&&t.GBs(B,5),2&o){let d;t.mGM(d=t.lsd())&&(a.sort=d.first)}},decls:2,vars:2,consts:[["sort","matSort"],["matSort","","matSortActive","description","matSortDirection","asc","matSortDisableClear","",3,"config","dataSource"]],template:function(o,a){1&o&&t.nrm(0,"learninghouse-table",1,0),2&o&&t.Y8G("config",a.tableConfig)("dataSource",a.dataSource)},dependencies:[h.O,N.B4],encapsulation:2})}return n})(),canActivate:[()=>(0,t.WQX)(A.q).checkMinimumRole(T.X.ADMIN)]}];let j=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#s=this.\u0275mod=t.$C({type:n});static#o=this.\u0275inj=t.G2t({imports:[C.iI.forChild(Q),C.iI]})}return n})(),W=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#s=this.\u0275mod=t.$C({type:n});static#o=this.\u0275inj=t.G2t({imports:[f.MD,D.G,j]})}return n})()}}]);